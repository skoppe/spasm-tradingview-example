<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <title>Spasm Todomcv</title>
    </head>
    <body>
        <div id="root"></div>
    <script type="text/javascript">!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var r={};i.r(r),i.d(r,"spasm",function(){return f}),i.d(r,"encoders",function(){return m}),i.d(r,"decoders",function(){return v}),i.d(r,"jsExports",function(){return g});var n={};i.r(n),i.d(n,"nodes",function(){return b}),i.d(n,"addPtr",function(){return S}),i.d(n,"jsExports",function(){return P});var s={};i.r(s),i.d(s,"jsExports",function(){return Wr});var o=arguments;const a=(t,e,i)=>{throw"ABORT: $what @ $file:$line"},h=new TextDecoder("utf-8"),l=new TextEncoder;let c={1:document,2:window},u=[],p=t=>{if(null===t||null==t)return 0;let e=u.pop()||++f.lastPtr;return c[e]=t,e},d=t=>c[t];const _=t=>{f.memory=t,f.buffer=t.buffer},f={lastPtr:2,instance:null,init:t=>{if(window.spasm=f,!f.exports){var e={};t.map(t=>t.jsExports).filter(t=>!!t).map(t=>Object.entries(t).forEach(t=>e[t[0]]=Object.assign.apply(null,[e[t[0]]||{},t[1]]))),f.exports=e}void 0===WebAssembly.instantiateStreaming?fetch("spasm-tradingview.wasm").then(t=>t.arrayBuffer()).then(t=>WebAssembly.compile(t)).then(t=>{let e=new WebAssembly.Instance(t,f.exports);f.instance=e,_(e.exports.memory),e.exports._start(e.exports.__heap_base)}):WebAssembly.instantiateStreaming(fetch("spasm-tradingview.wasm"),f.exports).then(t=>{let e=t.instance;f.instance=e,_(e.exports.memory),e.exports._start(e.exports.__heap_base)})},objects:c,addObject:p};let m={string:(t,e)=>{const i=l.encode(e),r=f.instance.exports.allocString(i.length),n=new Uint8Array(f.memory.buffer,r,i.length),s=new Uint32Array(f.memory.buffer);return s[t/4]=i.length,s[t/4+1]=r,n.set(i),t}},v={string:(t,e)=>{if(null==e){const i=new Uint32Array(f.memory.buffer);e=i[(t+4)/4],t=i[t/4]}return h.decode(new DataView(f.memory.buffer,e,t))}},g={env:{onOutOfMemoryError:()=>a("Out of memory exception"),_d_assert:(t,e)=>a("assert",t,e),doLog:t=>console.log(t),memory:f.memory,__assert:()=>{},_Unwind_Resume:()=>{console.log(o)},_d_dynamic_cast:()=>{console.log(o)},spasm_add__bool:t=>p(!!t),spasm_add__int:p,spasm_add__uint:p,spasm_add__long:p,spasm_add__ulong:p,spasm_add__short:p,spasm_add__ushort:p,spasm_add__byte:p,spasm_add__ubyte:p,spasm_add__float:p,spasm_add__double:p,spasm_add__object:()=>p({}),spasm_add__string:(t,e)=>p(v.string(t,e)),spasm_get__field:(t,e,i)=>p(d(t)[v.string(e,i)]),spasm_get__int:d,spasm_get__uint:d,spasm_get__long:d,spasm_get__ulong:d,spasm_get__short:d,spasm_get__ushort:d,spasm_get__float:d,spasm_get__double:d,spasm_get__byte:d,spasm_get__ubyte:d,spasm_get__string:(t,e)=>{m.string(t,d(e))},spasm_removeObject:t=>{u.push(t),delete c[t]},DataView_Create:(t,e)=>p(new DataView(f.memory.buffer,e,t)),Float32Array_Create:(t,e)=>p(new Float32Array(f.memory.buffer,e,t)),Uint8Array_Create:(t,e)=>p(new Uint8Array(f.memory.buffer,e,t))}},y=f;const b=y.objects,S=y.addObject;let w=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];const x=t=>w[t];let C=["click","change","input","keydown","keyup","dblclick","blur","mousemove","mouseup","mousedown","keypress"],T=null;const M=t=>{const e=t.currentTarget.wasmId,i=t.currentTarget.wasmEvents[t.type],r=i.cbs;T=t,r.forEach(t=>y.instance.exports.domEvent(e,t.ctx,t.fun,i.eventType)),T=null};let P={env:{appendChild:(t,e)=>{b[t].appendChild(b[e])},insertBefore:(t,e,i)=>{b[t].insertBefore(b[e],b[i])},addCss:(t,e)=>{var i=document.createElement("style");i.type="text/css",i.innerHTML=v.string(t,e),document.getElementsByTagName("head")[0].appendChild(i),S(i)},addClass:(t,e,i)=>{b[t].classList.add(v.string(e,i))},removeClass:(t,e,i)=>{b[t].classList.remove(v.string(e,i))},changeClass:(t,e,i,r)=>{r?b[t].classList.add(v.string(e,i)):b[t].classList.remove(v.string(e,i))},unmount:t=>{var e=b[t];e.parentNode.removeChild(e)},removeChild:t=>{var e=b[t];e.parentNode.removeChild(e)},getRoot:()=>S(document.querySelector("#root")),createElement:t=>S(document.createElement(x(t))),setSelectionRange:(t,e,i)=>{b[t].setSelectionRange(e,i)},innerText:(t,e,i)=>{b[t].innerText=v.string(e,i)},setAttributeInt:(t,e,i,r)=>{const n=v.string(e,i);b[t].setAttribute(n,r)},setAttribute:(t,e,i,r,n)=>{const s=v.string(e,i),o=v.string(r,n);b[t].setAttribute(s,o)},addEventListener:(t,e,i,r,n)=>{var s=C[e],o=b[t];if(void 0===o.wasmEvents)var a=o.wasmEvents={};else a=b[t].wasmEvents;a[s]&&a[s].cbs.length>0?a[s].cbs.push({ctx:i,fun:r}):(a[s]={cbs:[{ctx:i,fun:r}],eventType:n},o.addEventListener(s,M))},removeEventListener:(t,e,i,r,n)=>{var s=C[e];if(void 0!==b[t].wasmEvents){var o=b[t].wasmEvents;o[s]&&o[s].cbs.length>0&&(o[s].cbs=o[s].cbs.filter(t=>!(t.ctx==i&&t.fun==r)))}},getEventBool:(t,e)=>!!T[v.string(t,e)],getEventInt:(t,e)=>0+T[v.string(t,e)],getEventString:(t,e,i)=>m.string(t,T[v.string(e,i)]),setPropertyBool:(t,e,i,r)=>{const n=b[t],s=v.string(e,i);n&&void 0!==n[s]&&(n[s]=r)},setPropertyInt:(t,e,i,r)=>{P.env.setPropertyBool(t,e,i,r)},setProperty:(t,e,i,r,n)=>{const s=b[t],o=v.string(e,i);s&&void 0!==s[o]&&(s[o]=v.string(r,n))},getPropertyInt:(t,e,i)=>{const r=b[t],n=v.string(e,i);return!(!r||void 0===r[n])&&+r[n]},getPropertyBool:(t,e,i)=>{const r=b[t],n=v.string(e,i);return!(!r||void 0===r[n])&&!!r[n]},getProperty:(t,e,i,r)=>{const n=b[e],s=v.string(i,r);return n&&void 0!==n[s]?m.string(t,n[s]):m.string(t,"")}}};
/*!
 * @license
 * TradingView Lightweight Charts v1.0.0
 * Copyright (c) 2019 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
var k,E;function D(t,e,i,r,n,s){isFinite(e)&&isFinite(r)&&isFinite(i)&&isFinite(n)&&(t.save(),R(t,s),t.beginPath(),t.moveTo(e,i),t.lineTo(r,n),t.stroke(),t.restore())}function R(t,e){var i,r=((i={})[0]=[],i[1]=[t.lineWidth,2*t.lineWidth],i[2]=[5*t.lineWidth,6*t.lineWidth],i[3]=[6*t.lineWidth,6*t.lineWidth],i[4]=[t.lineWidth,4*t.lineWidth],i)[e];t.setLineDash(r)}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps"}(k||(k={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(E||(E={}));var I=function(t,e){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function A(t,e){function i(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var V=function(){return(V=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function O(t,e){if(!t)throw new Error("Assertion failed"+(e?": "+e:""))}function L(t){if(void 0===t)throw new Error("Value is undefined");return t}function z(t){if(null===t)throw new Error("Value is null");return t}function B(t){return z(L(t))}function W(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var r=0,n=e;r<n.length;r++){var s=n[r];for(var o in s)void 0!==s[o]&&("object"!=typeof s[o]||void 0===t[o]?t[o]=s[o]:W(t[o],s[o]))}return t}function F(t){return"number"==typeof t&&isFinite(t)}function N(t){return"number"==typeof t&&t%1==0}function H(t){return"string"==typeof t}function U(t){return!(t<=0||t>0)}function Y(t){var e,i,r,n=t;if(!n||"object"!=typeof n)return n;for(i in e=Array.isArray(n)?[]:{},n)n.hasOwnProperty(i)&&(r=n[i],e[i]=r&&"object"==typeof r?Y(r):r);return e}function j(t){return null!==t}function X(t){return null===t?void 0:t}var q,G,Z,K,$=function(){function t(){this._renderers=[]}return t.prototype.setRenderers=function(t){this._renderers=t},t.prototype.draw=function(t,e){this._renderers.forEach(function(i){t.save(),i.draw(t,e),t.restore()})},t}(),J=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data&&null!==this._data.visibleRange){var e=this._data.visibleRange,i=this._data,r=function(r){t.beginPath();for(var n=e.to-1;n>=e.from;--n){var s=i.items[n];t.moveTo(s.x,s.y),t.arc(s.x,s.y,r,0,2*Math.PI)}t.fill()};t.fillStyle=i.backColor,r(i.radius+2),t.fillStyle=i.lineColor,r(i.radius)}},t}(),Q={from:0,to:1},tt=function(){function t(t,e){this._compositeRenderer=new $,this._markersRenderers=[],this._markersData=[],this._invalidated=!0,this._chartModel=t,this._crosshair=e,this._compositeRenderer.setRenderers(this._markersRenderers)}return t.prototype.update=function(t){var e=this,i=this._chartModel.serieses();i.length!==this._markersRenderers.length&&(this._markersData=i.map(function(){return{items:[{x:0,y:0,time:0,price:0}],lineColor:"",backColor:e._chartModel.options().layout.backgroundColor,radius:0,visibleRange:null}}),this._markersRenderers=this._markersData.map(function(t){var e=new J;return e.setData(t),e}),this._compositeRenderer.setRenderers(this._markersRenderers)),this._invalidated=!0},t.prototype.renderer=function(t,e,i){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._compositeRenderer},t.prototype._updateImpl=function(){var t=this,e=this._chartModel.serieses(),i=this._crosshair.appliedIndex(),r=this._chartModel.timeScale();e.forEach(function(e,n){var s=t._markersData[n],o=e.markerDataAtIndex(i);if(null===o)s.visibleRange=null;else{var a=z(e.firstValue());s.lineColor=e.barColorer().barStyle(i).barColor,s.backColor=t._chartModel.options().layout.backgroundColor,s.radius=o.radius,s.items[0].price=o.price,s.items[0].y=e.priceScale().priceToCoordinate(o.price,a),s.items[0].time=i,s.items[0].x=r.indexToCoordinate(i),s.visibleRange=Q}})},t}(),et=function(){function t(t){this._data=t}return t.prototype.draw=function(t){if(null!==this._data){var e=this._data.vertLine.visible,i=this._data.horzLine.visible;if(e||i){var r=this._data.vertLine.lineWidth%2==0?.5:0,n=this._data.horzLine.lineWidth%2==0?.5:0,s=this._data.x+1+n,o=this._data.y+r,a=this._data.w,h=this._data.h;e&&s>=0&&(t.lineWidth=this._data.vertLine.lineWidth,t.strokeStyle=this._data.vertLine.color,t.fillStyle=this._data.vertLine.color,D(t,s,0,s,h,this._data.vertLine.lineStyle)),i&&o>=0&&(t.lineWidth=this._data.horzLine.lineWidth,t.strokeStyle=this._data.horzLine.color,t.fillStyle=this._data.horzLine.color,D(t,0,o,a,o,this._data.horzLine.lineStyle))}}},t}(),it=function(){function t(t){this._invalidated=!0,this._rendererData={vertLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},horzLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},w:0,h:0,x:0,y:0},this._renderer=new et(this._rendererData),this._source=t}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(t,e){return this._invalidated&&this._updateImpl(),this._renderer},t.prototype._updateImpl=function(){var t=this._source.visible(),e=z(this._source.pane()),i=e.model().options().crosshair,r=this._rendererData;r.horzLine.visible=t&&this._source.horzLineVisible(e),r.vertLine.visible=t&&this._source.vertLineVisible(),r.horzLine.lineWidth=i.horzLine.width,r.horzLine.lineStyle=i.horzLine.style,r.horzLine.color=i.horzLine.color,r.vertLine.lineWidth=i.vertLine.width,r.vertLine.lineStyle=i.vertLine.style,r.vertLine.color=i.vertLine.color,r.w=e.width(),r.h=e.height(),r.x=this._source.appliedX(),r.y=this._source.appliedY()},t}(),rt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",feldspar:"#d19275",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslateblue:"#8470ff",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",violetred:"#d02090",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function nt(t){return function(t,e,i){return U(e)?0:e<0?0:e>255?255:Math.round(e)}(0,t)}function st(t){return function(t,e,i){return U(e)?0:e<0?0:e>1?1:Math.round(1e4*e)/1e4}(0,t)}function ot(t){(t=t.toLowerCase())in rt&&(t=rt[t]);var e,i,r=(e=t,null!==(i=Z.re.exec(e))?Z.parse(i):null);if(null!==r)return r;var n=function(t){var e=G.re.exec(t);return null!==e?G.parse(e):null}(t);if(null!==n)return n;var s=function(t){var e=q.re.exec(t);return null!==e?q.parse(e):null}(t);if(null!==s)return s;var o=function(t){var e=K.re.exec(t);return null!==e?K.parse(e):null}(t);return null!==o?[o[0],o[1],o[2]]:null}function at(t){var e=ot(t);if(null!==e)return e;throw new Error("Passed color string "+t+" does not match any of the known color representations")}function ht(t,e){if(e<0||e>255)throw new Error("invalid threshold value, valid values are [0, 255]");return function(t){return.199*t[0]+.687*t[1]+.114*t[2]}(t)>=e?"white":"black"}function lt(t){return function(t){return 0===t.indexOf("#")}(t)?t:(1,"rgba("+(e=[(i=at(t))[0],i[1],i[2],st(1)])[0]+", "+e[1]+", "+e[2]+", "+e[3]+")");var e,i}function ct(t){return"black"===ht(at(t),160)?"white":"black"}!function(t){t.re=/^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/,t.parse=function(t){return[nt(parseInt(t[1]+t[1],16)),nt(parseInt(t[2]+t[2],16)),nt(parseInt(t[3]+t[3],16))]}}(q||(q={})),function(t){t.re=/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,t.parse=function(t){return[nt(parseInt(t[1],16)),nt(parseInt(t[2],16)),nt(parseInt(t[3],16))]}}(G||(G={})),function(t){t.re=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,t.parse=function(t){return[nt(parseInt(t[1],10)),nt(parseInt(t[2],10)),nt(parseInt(t[3],10))]}}(Z||(Z={})),function(t){t.re=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/,t.parse=function(t){return[nt(parseInt(t[1],10)),nt(parseInt(t[2],10)),nt(parseInt(t[3],10)),st(parseFloat(t[4]))]}}(K||(K={}));var ut,pt=function(){function t(t,e){this.setData(t,e)}return t.prototype.setData=function(t,e){this._data=t,this._commonData=e},t.prototype.draw=function(t,e,i,r,n){if(this._data.visible){var s=e.fontSize;t.font=e.font;var o=this._data.tickVisible?e.tickLength:0,a=this._data.borderVisible?e.borderSize:0,h=e.paddingTop,l=e.paddingBottom,c=e.paddingInner,u=e.paddingOuter,p=this._data.text,d=Math.ceil(i.measureText(t,p)),_=e.baselineOffset,f=e.fontSize+h+l,m=a+d+c+u+o,v=this._commonData.coordinate;this._commonData.fixedCoordinate&&(v=this._commonData.fixedCoordinate);var g,y,b=v-Math.floor(s/2)-h-.5,S=b+f,w="right"===n,x=w?r-a-.5:.5,C=x;t.fillStyle=lt(this._commonData.background),t.lineWidth=1,t.lineCap="butt",p&&(w?(g=x-o,y=(C=x-m)+u):(C=x+m,g=x+o,y=x+a+o+c),t.beginPath(),t.moveTo(x,b),t.lineTo(C,b),t.lineTo(C,S),t.lineTo(x,S),t.fill(),this._data.tickVisible&&(t.beginPath(),t.strokeStyle=this._commonData.color,t.moveTo(x,v),t.lineTo(g,v),t.stroke()),t.textAlign="left",t.fillStyle=this._commonData.color,t.fillText(p,y,S-l-_))}},t.prototype.height=function(t,e){return this._data.visible?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),dt=function(){function t(t){this._commonRendererData={coordinate:0,color:"#FFF",background:"#000"},this._axisRendererData={text:"",visible:!1,tickVisible:!0,borderVisible:!0,lineStyle:1},this._paneRendererData={text:"",visible:!1,tickVisible:!1,borderVisible:!1,lineStyle:1},this._invalidated=!0,this._axisRenderer=new(t||pt)(this._axisRendererData,this._commonRendererData),this._paneRenderer=new(t||pt)(this._paneRendererData,this._commonRendererData)}return t.prototype.text=function(){return this._axisRendererData.text},t.prototype.background=function(){return this._commonRendererData.background},t.prototype.color=function(){return ct(this.background())},t.prototype.coordinate=function(){return this._updateRendererDataIfNeeded(),this._commonRendererData.coordinate},t.prototype.floatCoordinate=function(){return this._updateRendererDataIfNeeded(),this._commonRendererData.floatCoordinate||this._commonRendererData.coordinate},t.prototype.update=function(){this._invalidated=!0},t.prototype.height=function(t,e){return void 0===e&&(e=!1),Math.max(this._axisRenderer.height(t,e),this._paneRenderer.height(t,e))},t.prototype.getFixedCoordinate=function(){return this._commonRendererData.fixedCoordinate||0},t.prototype.setFixedCoordinate=function(t){this._commonRendererData.fixedCoordinate=t},t.prototype.isVisible=function(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible||this._paneRendererData.visible},t.prototype.isAxisLabelVisible=function(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible},t.prototype.isPaneLabelVisible=function(){return this._updateRendererDataIfNeeded(),this._paneRendererData.visible},t.prototype.renderer=function(){return this._updateRendererDataIfNeeded(),this._axisRenderer.setData(this._axisRendererData,this._commonRendererData),this._paneRenderer.setData(this._paneRendererData,this._commonRendererData),this._axisRenderer},t.prototype.paneRenderer=function(){return this._updateRendererDataIfNeeded(),this._axisRenderer.setData(this._axisRendererData,this._commonRendererData),this._paneRenderer.setData(this._paneRendererData,this._commonRendererData),this._paneRenderer},t.prototype._updateRendererDataIfNeeded=function(){this._invalidated&&(this._updateRendererData(this._axisRendererData,this._paneRendererData,this._commonRendererData),this._invalidated=!1)},t}(),_t=function(t){function e(e,i,r){var n=t.call(this)||this;return n._source=e,n._priceScale=i,n._valueProvider=r,n}return A(e,t),e.prototype._updateRendererData=function(t,e,i){t.visible=!1;var r=this._source.options().horzLine;if(r.labelVisible){var n=this._priceScale.mainSource(),s=null!==n?n.firstValue():null;if(this._source.visible()&&!this._priceScale.isEmpty()&&null!==s){i.background=r.labelBackgroundColor,i.color=ct(r.labelBackgroundColor);var o=this._valueProvider(this._priceScale);i.coordinate=o.coordinate,t.text=this._priceScale.formatPrice(o.price,s),t.visible=!0}}},e}(dt),ft=/[1-9]/g,mt=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t,e){if(null!==this._data&&!1!==this._data.visible&&0!==this._data.text.length){t.font=e.font;var i=Math.round(e.widthCache.measureText(t,this._data.text,ft));if(!(i<=0)){var r=e.paddingHorizontal,n=i+2*r,s=n/2,o=this._data.width,a=this._data.coordinate,h=Math.floor(a-s)+.5;h<0?(a+=Math.abs(0-h),h=Math.floor(a-s)+.5):h+n>o&&(a-=Math.abs(o-(h+n)),h=Math.floor(a-s)+.5);var l=h+n,c=-.5+e.borderSize+e.paddingTop+e.fontSize+e.paddingBottom;t.fillStyle=this._data.background,t.lineWidth=1,function(t,e,i,r,n,s){t.beginPath(),t.moveTo(e+1,i),t.lineTo(e+r-1,i),t.arcTo(e+r,i,e+r,.5,1),t.lineTo(e+r,i+n-1),t.arcTo(e+r,i+n,e+r-1,i+n,1),t.lineTo(e+1,i+n),t.arcTo(e,i+n,e,i+n-1,1),t.lineTo(e,.5),t.arcTo(e,i,e+1,i,1)}(t,h,-.5,l-h,c- -.5),t.fill();var u=Math.round(this._data.coordinate+1),p=-.5+e.borderSize+e.tickLength;t.strokeStyle=this._data.color,t.beginPath(),t.moveTo(u,-.5),t.lineTo(u,p),t.stroke();var d=c-e.baselineOffset-e.paddingBottom;t.textAlign="left",t.fillStyle=this._data.color,t.fillText(this._data.text,h+r,d)}}},t}(),vt=function(t){function e(e,i,r){var n=t.call(this)||this;return n._invalidated=!0,n._renderer=new mt,n._rendererData={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},n._crosshair=e,n._model=i,n._valueProvider=r,n}return A(e,t),e.prototype.update=function(){this._invalidated=!0},e.prototype.renderer=function(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer.setData(this._rendererData),this._renderer},e.prototype._updateImpl=function(){var t=this._rendererData;t.visible=!1;var e=this._crosshair.options().vertLine;if(e.labelVisible){var i=this._model.timeScale();if(!i.isEmpty()){var r=i.indexToUserTime(this._crosshair.appliedIndex());t.width=i.width();var n=this._valueProvider();n.time&&(t.coordinate=n.coordinate,t.text=i.formatDateTime(z(r)),t.visible=!0,t.background=e.labelBackgroundColor,t.color=ct(e.labelBackgroundColor))}}},e}(function(){function t(){this._text="",this._background="#585858",this._coordinate=0}return t.prototype.text=function(){return this._text},t.prototype.background=function(){return this._background},t.prototype.color=function(){return"black"===ht(at(this._background),150)?"white":"black"},t.prototype.coordinate=function(){return this._coordinate},t}()),gt=function(){function t(){this._priceScale=null,this._zorder=0}return t.prototype.zorder=function(){return this._zorder},t.prototype.setZorder=function(t){this._zorder=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.priceAxisViews=function(t,e){return[]},t.prototype.paneViews=function(t){return[]},t.prototype.timeAxisViews=function(){return[]},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(ut||(ut={}));var yt=function(t){function e(e,i){var r,n,s=t.call(this)||this;s._pane=null,s._price=NaN,s._index=0,s._visible=!0,s._priceAxisViews=new Map,s._subscribed=!1,s._x=NaN,s._y=NaN,s._originX=NaN,s._originY=NaN,s._model=e,s._options=i,s._markersPaneView=new tt(e,s),s._currentPosPriceProvider=(r=function(){return s._price},n=function(){return s._y},function(t){var e=n(),i=r();if(t===z(s._pane).defaultPriceScale())return{price:i,coordinate:e};var o=z(t.mainSource()),a=z(o.firstValue());return{price:t.coordinateToPrice(e,a),coordinate:e}});var o=function(){return{time:s._model.timeScale().indexToUserTime(s._index),coordinate:s.appliedX()}};return s._timeAxisView=new vt(s,e,o),s._paneView=new it(s),s}return A(e,t),e.prototype.index=function(){return this._index},e.prototype.options=function(){return this._options},e.prototype.saveOriginCoord=function(t,e){this._originX=t,this._originY=e},e.prototype.clearOriginCoord=function(){this._originX=NaN,this._originY=NaN},e.prototype.originCoordX=function(){return this._originX},e.prototype.originCoordY=function(){return this._originY},e.prototype.setPosition=function(t,e,i){this._subscribed||(this._subscribed=!0),this._visible=!0,this._tryToUpdateViews(t,e,i)},e.prototype.appliedIndex=function(){return this._index},e.prototype.appliedX=function(){return this._x},e.prototype.appliedY=function(){return this._y},e.prototype.visible=function(){return this._visible},e.prototype.clearPosition=function(){this._visible=!1,this._setIndexToLastSeriesBarIndex(),this._price=NaN,this._x=NaN,this._y=NaN,this._pane=null,this.clearOriginCoord()},e.prototype.paneViews=function(t){return null!==this._pane?[this._paneView,this._markersPaneView]:[]},e.prototype.horzLineVisible=function(t){return t===this._pane&&this._options.horzLine.visible},e.prototype.vertLineVisible=function(){return this._options.vertLine.visible},e.prototype.priceAxisViews=function(t,e){this._visible&&this._pane===t||this._priceAxisViews.clear();var i=[];return this._pane===t&&i.push(this._createPriceAxisViewOnDemand(this._priceAxisViews,e,this._currentPosPriceProvider)),i},e.prototype.timeAxisViews=function(){return this._visible?[this._timeAxisView]:[]},e.prototype.pane=function(){return this._pane},e.prototype.updateAllViews=function(){this._priceAxisViews.forEach(function(t){return t.update()}),this._timeAxisView.update(),this._markersPaneView.update()},e.prototype._priceScaleByPane=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},e.prototype._tryToUpdateViews=function(t,e,i){this._tryToUpdateData(t,e,i)&&this.updateAllViews()},e.prototype._tryToUpdateData=function(t,e,i){var r=this._x,n=this._y,s=this._price,o=this._index,a=this._pane,h=this._priceScaleByPane(i);this._index=t,this._x=isNaN(t)?NaN:this._model.timeScale().indexToCoordinate(t);var l=i.mainDataSource(),c=null!==l?l.firstValue():null;return null!==h&&null!==c?(this._pane=i,this._price=e,this._y=h.priceToCoordinate(e,c)):(this._pane=null,this._price=NaN,this._y=NaN),r!==this._x||n!==this._y||o!==this._index||s!==this._price||a!==this._pane},e.prototype._setIndexToLastSeriesBarIndex=function(){var t=this._model.serieses().map(function(t){return t.bars().lastIndex()}).filter(j),e=0===t.length?null:Math.max.apply(Math,t);this._index=null!==e?e:NaN},e.prototype._createPriceAxisViewOnDemand=function(t,e,i){var r=t.get(e);return void 0===r&&(r=new _t(this,e,i),t.set(e,r)),r},e}(gt),bt=".",St="'";function wt(t,e){if(!F(t))return"n/a";if(!N(e))throw new TypeError("invalid length");if(e<0||e>16)throw new TypeError("invalid length");return 0===e?t.toString():("0000000000000000"+t.toString()).slice(-e)}var xt,Ct=function(){function t(t,e,i,r){if(e||(e=1),F(t)&&N(t)||(t=100),t<0)throw new TypeError("invalid base");this._priceScale=t,this._minMove=e,this._minMove2=r,i&&void 0!==r&&r>0&&2!==r&&4!==r&&8!==r||(this._fractional=i,this._calculateDecimal())}return t.prototype.format=function(t,e,i,r){void 0===r&&(r=!0);var n="";return t<0?(n=!0===e?"−":!1===r?"":"−",t=-t):t&&!0===e&&(n="+"),this._fractional?n+this._formatAsFractional(t,i):n+this._formatAsDecimal(t,i)},t.prototype._calculateDecimal=function(){if(this._fractionalLength=0,this._priceScale>0&&this._minMove>0){var t=this._priceScale;for(this._fractional&&this._minMove2&&(t/=this._minMove2);t>1;)t/=10,this._fractionalLength++}},t.prototype._formatAsDecimal=function(t,e){var i;e=e||0,i=this._fractional?Math.pow(10,this._fractionalLength||0):Math.pow(10,e)*this._priceScale/this._minMove;var r=Math.floor(t),n="",s=void 0!==this._fractionalLength?this._fractionalLength:NaN;if(i>1){var o=+(Math.round(t*i)-r*i).toFixed(this._fractionalLength);o>=i&&(o-=i,r+=1),n=bt+wt(+o.toFixed(this._fractionalLength)*this._minMove,s+e),n=this._removeEndingZeros(n,e)}else r=Math.round(r*i)/i,s>0&&(n=bt+wt(0,s+e));return r.toFixed(0)+n},t.prototype._formatAsFractional=function(t,e){var i=this._priceScale/this._minMove,r=Math.floor(t),n=e?Math.floor(t*i)-r*i:Math.round(t*i)-r*i;n===i&&(n=0,r+=1);var s="";if(e){var o=(t-r-n/i)*i;s=wt(o=Math.round(o*Math.pow(10,e)),e),s=this._removeEndingZeros(s,e)}if(!this._fractionalLength)throw new Error("_fractionalLength is not calculated");var a="";if(this._minMove2){var h=n%this._minMove2,l=wt(n=(n-h)/this._minMove2,this._fractionalLength),c=2===this._minMove2?["0","5"][h]:8===this._minMove2?["0","1","2","3","4","5","6","7"][h]:["0","2","5","7"][h];a=l+St+c}else a=wt(n*this._minMove,this._fractionalLength);return r.toString()+St+a+s},t.prototype._removeEndingZeros=function(t,e){for(var i=0;i<e&&"0"===t[t.length-1];i++)t=t.substr(0,t.length-1);return t},t}(),Tt=function(t){function e(e){return void 0===e&&(e=100),t.call(this,e)||this}return A(e,t),e.prototype.format=function(e,i,r,n){return t.prototype.format.call(this,e,i,r,n)+"%"},e}(Ct),Mt=function(){function t(){this._listeners=[]}return t.prototype.subscribe=function(t,e,i){var r={callback:t,linkedObject:e,singleshot:!0===i};this._listeners.push(r)},t.prototype.unsubscribe=function(t){var e=this._listeners.findIndex(function(e){return t===e.callback});e>-1&&this._listeners.splice(e,1)},t.prototype.unsubscribeAll=function(t){this._listeners=this._listeners.filter(function(e){return e.linkedObject===t})},t.prototype.fire=function(t,e){var i=this._listeners.slice();this._listeners=this._listeners.filter(function(t){return!t.singleshot}),i.forEach(function(i){return i.callback(t,e)})},t.prototype.hasListeners=function(){return this._listeners.length>0},t.prototype.destroy=function(){this._listeners=[]},t}(),Pt=function(t){function e(e){var i=t.call(this)||this;return i._model=e,i}return A(e,t),e.prototype.model=function(){return this._model},e.prototype.base=function(){return 0},e.prototype.priceRange=function(t,e){return null},e}(gt),kt=function(){function t(t,e){this._minValue=t,this._maxValue=e}return t.prototype.equals=function(t){return null!==t&&this._minValue===t._minValue&&this._maxValue===t._maxValue},t.prototype.clone=function(){return new t(this._minValue,this._maxValue)},t.prototype.minValue=function(){return this._minValue},t.prototype.setMinValue=function(t){this._minValue=t},t.prototype.maxValue=function(){return this._maxValue},t.prototype.setMaxValue=function(t){this._maxValue=t},t.prototype.length=function(){return this._maxValue-this._minValue},t.prototype.isEmpty=function(){return this._maxValue===this._minValue||Number.isNaN(this._maxValue)||Number.isNaN(this._minValue)},t.prototype.merge=function(e){return new t(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))},t.prototype.apply=function(t,e){this._minValue=Math.min(this._minValue,t),this._maxValue=Math.max(this._maxValue,e)},t.prototype.set=function(t,e){this._minValue=t,this._maxValue=e},t.prototype.scaleAroundCenter=function(t){if(F(t)&&0!=this._maxValue-this._minValue){var e=.5*(this._maxValue+this._minValue),i=this._maxValue-e,r=this._minValue-e;i*=t,r*=t,this._maxValue=e+i,this._minValue=e+r}},t.prototype.shift=function(t){F(t)&&(this._maxValue+=t,this._minValue+=t)},t.prototype.containsStrictly=function(t){return t.minValue()>this._minValue&&t.maxValue()<this._maxValue},t}();function Et(t,e,i){return Math.min(Math.max(t,e),i)}function Dt(t,e,i){return e-t<=i}function Rt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function It(t,e){var i=100*(t-e)/e;return e<0?-i:i}function At(t,e){var i=It(t.minValue(),e),r=It(t.maxValue(),e);return new kt(i,r)}function Vt(t,e){var i=100*(t-e)/e+100;return e<0?-i:i}function Ot(t,e){var i=Vt(t.minValue(),e),r=Vt(t.maxValue(),e);return new kt(i,r)}function Lt(t){var e=Math.abs(t);if(e<1e-8)return 0;var i=Rt(e+1e-4)+4;return t<0?-i:i}function zt(t){var e=Math.abs(t);if(e<1e-8)return 0;var i=Math.pow(10,e-4)-1e-4;return t<0?-i:i}function Bt(t){if(null===t)return null;var e=Lt(t.minValue()),i=Lt(t.maxValue());return new kt(e,i)}!function(t){t[t.LogicalOffset=4]="LogicalOffset",t[t.CoordOffset=1e-4]="CoordOffset"}(xt||(xt={}));var Wt=function(){function t(t,e){if(this._base=t,this._integralDividers=e,function(t){if(t<0)return!1;for(var e=t;e>1;e/=10)if(e%10!=0)return!1;return!0}(this._base))this._fractionalDividers=[2,2.5,2];else{this._fractionalDividers=[];for(var i=this._base;1!==i;){if(i%2==0)this._fractionalDividers.push(2),i/=2;else{if(i%5!=0)throw new Error("unexpected base");this._fractionalDividers.push(2),this._fractionalDividers.push(2.5),i/=5}if(this._fractionalDividers.length>100)throw new Error("something wrong with base")}}}return t.prototype.tickSpan=function(t,e,i){for(var r,n=0===this._base?0:1/this._base,s=Math.pow(10,Math.max(0,Math.ceil(Rt(t-e)))),o=0,a=this._integralDividers[0];;){var h=Dt(s,n,1e-9)&&s>n+1e-9,l=Dt(s,i*a,1e-9),c=Dt(s,1,1e-9);if(!(h&&l&&c))break;s/=a,a=this._integralDividers[++o%this._integralDividers.length]}if(s<=n+1e-9&&(s=n),s=Math.max(1,s),this._fractionalDividers.length>0&&(r=s,1,1e-9,Math.abs(r-1)<1e-9))for(o=0,a=this._fractionalDividers[0];Dt(s,i*a,1e-9)&&s>n+1e-9;)s/=a,a=this._fractionalDividers[++o%this._fractionalDividers.length];return s},t}(),Ft=function(){function t(t,e,i,r){this._marks=[],this._priceScale=t,this._base=e,this._coordinateToLogicalFunc=i,this._logicalToCoordinateFunc=r}return t.prototype.base=function(){return this._base},t.prototype.setBase=function(t){if(t<0)throw new Error("base < 0");this._base=t},t.prototype.tickSpan=function(t,e){if(t<e)throw new Error("high < low");var i=this._priceScale.height(),r=(t-e)*this._tickMarkHeight()/i,n=new Wt(this._base,[2,2.5,2]),s=new Wt(this._base,[2,2,2.5]),o=new Wt(this._base,[2.5,2,2]),a=[];return a.push(n.tickSpan(t,e,r)),a.push(s.tickSpan(t,e,r)),a.push(o.tickSpan(t,e,r)),function(t){if(t.length<1)throw Error("array is empty");for(var e=t[0],i=1;i<t.length;++i)t[i]<e&&(e=t[i]);return e}(a)},t.prototype.rebuildTickMarks=function(){var t=this._priceScale;if(t.isEmpty())this._marks=[];else{var e=t.mainSource();if(null!==e){var i=e.firstValue();if(null!==i){var r=t.height(),n=this._coordinateToLogicalFunc(r-1,i),s=this._coordinateToLogicalFunc(0,i),o=this._priceScale.options().entireTextOnly?this._fontHeight()/2:0,a=o,h=r-1-o,l=Math.max(n,s),c=Math.min(n,s);if(l!==c){for(var u=this.tickSpan(l,c),p=l%u,d=l>=c?1:-1,_=null,f=0,m=l-(p+=p<0?u:0);m>c;m-=u){var v=this._logicalToCoordinateFunc(m,i,!0);null!==_&&Math.abs(v-_)<this._tickMarkHeight()||v<a||v>h||(f<this._marks.length?(this._marks[f].coord=Math.round(v),this._marks[f].label=t.formatLogical(m)):this._marks.push({coord:Math.round(v),label:t.formatLogical(m)}),f++,_=v,t.isLog()&&(u=this.tickSpan(m*d,c)))}this._marks.length=f}else this._marks=[]}else this._marks=[]}else this._marks=[]}},t.prototype.marks=function(){return this._marks},t.prototype._fontHeight=function(){return this._priceScale.fontSize()},t.prototype._tickMarkHeight=function(){return Math.ceil(2.5*this._fontHeight())},t}(),Nt=function(){function t(t){this._precision=t}return t.prototype.format=function(t){var e="";return t<0&&(e="-",t=-t),t<995?e+this._formatNumber(t):t<999995?e+this._formatNumber(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),e+this._formatNumber(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),e+this._formatNumber(t/1e9)+"B")},t.prototype._formatNumber=function(t){var e=Math.pow(10,this._precision);return((t=Math.round(t*e)/e)>=1e-15&&t<1?t.toFixed(this._precision).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,function(t,e){return e})},t}();function Ht(t,e,i,r){if(0!==e.length){var n=e[r.from].x,s=e[r.from].y;t.moveTo(n,s);for(var o=r.from+1;o<r.to;++o){var a=e[o];if(1===i){var h=e[o-1].x,l=a.x;t.lineTo(h,l)}t.lineTo(a.x,a.y)}}}var Ut=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange){t.save(),t.lineCap="square",t.strokeStyle=this._data.lineColor,t.lineWidth=this._data.lineWidth,R(t,this._data.lineStyle),t.lineWidth=1,t.beginPath(),t.moveTo(this._data.items[this._data.visibleRange.from].x,this._data.bottom),t.lineTo(this._data.items[this._data.visibleRange.from].x,this._data.items[this._data.visibleRange.from].y),Ht(t,this._data.items,this._data.lineType,this._data.visibleRange),t.lineTo(this._data.items[this._data.visibleRange.to-1].x,this._data.bottom),t.lineTo(this._data.items[this._data.visibleRange.from].x,this._data.bottom),t.closePath();var e=t.createLinearGradient(0,0,0,this._data.bottom);e.addColorStop(0,this._data.topColor),e.addColorStop(1,this._data.bottomColor),t.fillStyle=e,t.fill(),t.restore()}},t}(),Yt=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange&&(t.lineCap="square",t.lineWidth=this._data.lineWidth,R(t,this._data.lineStyle),t.strokeStyle=this._data.lineColor,t.lineJoin="miter",t.beginPath(),Ht(t,this._data.items,this._data.lineType,this._data.visibleRange),t.stroke())},t}();function jt(t,e,i,r,n){void 0===r&&(r=0),void 0===n&&(n=t.length);for(var s=n-r;0<s;){var o=s>>1,a=r+o;i(t[a],e)?(r=a+1,s-=o+1):s=o}return r}function Xt(t,e,i,r,n){void 0===r&&(r=0),void 0===n&&(n=t.length);for(var s=n-r;0<s;){var o=s>>1,a=r+o;i(e,t[a])?s=o:(r=a+1,s-=o+1)}return r}function qt(t,e){return t.time<e}function Gt(t,e){return t<e.time}function Zt(t,e){return{from:jt(t,e.firstBar(),qt),to:Xt(t,e.lastBar(),Gt)}}var Kt=function(){function t(t,e){this._invalidated=!0,this._dataInvalidated=!0,this._items=[],this._itemsVisibleRange=null,this._series=t,this._model=e}return t.prototype.update=function(t){this._invalidated=!0,"data"===t&&(this._dataInvalidated=!0)},t.prototype._makeValid=function(){this._dataInvalidated&&(this._fillRawPoints(),this._dataInvalidated=!1),this._invalidated&&(this._updatePoints(),this._invalidated=!1)},t.prototype._updatePoints=function(){var t=this._series.priceScale(),e=this._model.timeScale();if(this._itemsVisibleRange=null,!e.isEmpty()&&!t.isEmpty()){var i=e.visibleBars();if(null!==i&&0!==this._series.data().bars().size()){var r=this._series.firstValue();null!==r&&(this._itemsVisibleRange=Zt(this._items,i),this._convertToCoordinates(t,e,r))}}},t}(),$t=function(t){function e(e,i){return t.call(this,e,i)||this}return A(e,t),e.prototype._convertToCoordinates=function(t,e,i){e.indexesToCoordinates(this._items,X(this._itemsVisibleRange)),t.pointsArrayToCoordinates(this._items,i,X(this._itemsVisibleRange))},e.prototype._createRawItemBase=function(t,e){return{time:t,price:e,x:NaN,y:NaN}},e.prototype._fillRawPoints=function(){var t=this,e=this._series.barFunction(),i=[],r=this._series.barColorer();this._series.bars().each(function(n,s){var o=e(s.value),a=t._createRawItem(n,o,r);return i.push(a),!1}),this._items=i},e}(Kt),Jt=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._renderer=new $,r._areaRenderer=new Ut,r._lineRenderer=new Yt,r._renderer.setRenderers([r._areaRenderer,r._lineRenderer]),r}return A(e,t),e.prototype.renderer=function(t,e){this._makeValid();var i=this._series.options(),r={lineType:0,items:this._items,lineColor:i.lineColor,lineStyle:i.lineStyle,lineWidth:i.lineWidth,topColor:i.topColor,bottomColor:i.bottomColor,bottom:t,visibleRange:this._itemsVisibleRange};return this._areaRenderer.setData(r),this._lineRenderer.setData(r),this._renderer},e.prototype._createRawItem=function(t,e){return this._createRawItemBase(t,e)},e}($t);function Qt(t){return.3*t}var te,ee=function(){function t(){this._data=null,this._barWidth=0,this._barLineWidth=0}return t.prototype.setData=function(t){this._data=t,this._barWidth=Qt(t.barSpacing),this._barLineWidth=t.thinBars?1:Math.max(1,Math.round(this._barWidth))},t.prototype.draw=function(t){if(null!==this._data&&0!==this._data.bars.length&&null!==this._data.visibleRange){t.save(),t.translate(.5,.5);for(var e=this._data.thinBars?1:Math.round(this._barWidth),i=this._data.thinBars?1:e/2,r=null,n=this._data.visibleRange.from;n<this._data.visibleRange.to;++n){var s=this._data.bars[n];r!==s.color&&(t.fillStyle=s.color,r=s.color),t.fillRect(Math.round(s.x-this._barLineWidth/2),Math.round(s.highY-i),Math.round(this._barLineWidth),Math.round(s.lowY-s.highY+e)),this._barLineWidth<this._data.barSpacing-1&&(this._data.openVisible&&t.fillRect(Math.round(s.x-1.5*this._barWidth),Math.floor(s.openY-i),Math.round(1.5*this._barWidth),e),t.fillRect(Math.round(s.x),Math.floor(s.closeY-i),Math.round(1.5*this._barWidth),e))}t.restore()}},t}(),ie=function(t){function e(e,i){return t.call(this,e,i)||this}return A(e,t),e.prototype._convertToCoordinates=function(t,e,i){e.indexesToCoordinates(this._items,X(this._itemsVisibleRange)),t.barPricesToCoordinates(this._items,i,X(this._itemsVisibleRange))},e.prototype._createDefaultItem=function(t,e,i){return{time:t,open:e.value[0],high:e.value[1],low:e.value[2],close:e.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},e.prototype._fillRawPoints=function(){var t=this,e=[],i=this._series.barColorer();this._series.bars().each(function(r,n){var s=t._createRawItem(r,n,i);return e.push(s),!1}),this._items=e},e}(Kt),re=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._renderer=new ee,r}return A(e,t),e.prototype.renderer=function(t,e){this._makeValid();var i=this._series.options(),r={bars:this._items,barSpacing:this._model.timeScale().barSpacing(),openVisible:i.openVisible,thinBars:i.thinBars,visibleRange:this._itemsVisibleRange};return this._renderer.setData(r),this._renderer},e.prototype._createRawItem=function(t,e,i){return V({},this._createDefaultItem(t,e,i),{color:i.barStyle(t).barColor})},e}(ie);!function(t){t[t.BarBorderWidth=1]="BarBorderWidth"}(te||(te={}));var ne,se=function(){function t(){this._data=null,this._barWidth=0}return t.prototype.setData=function(t){this._data=t,this._barWidth=Qt(t.barSpacing)},t.prototype.draw=function(t){if(null!==this._data&&0!==this._data.bars.length&&null!==this._data.visibleRange)if(t.lineCap="square",this._data.barSpacing<1)this._drawThinCandles(t);else{var e=this._data.bars;t.translate(-.5,-.5),t.lineWidth=1,this._data.wickVisible&&this._drawWicks(t,e,this._data.visibleRange),this._data.borderVisible&&this._drawBorder(t,e,this._data.visibleRange),this._drawCandles(t,e,this._data.visibleRange)}},t.prototype._drawWicks=function(t,e,i){for(var r="",n=i.from;n<i.to;n++){var s=e[n];s.wickColor!==r&&(t.fillStyle=s.wickColor,r=s.wickColor),t.fillRect(s.x,s.highY,1,s.lowY-s.highY)}},t.prototype._drawBorder=function(t,e,i){for(var r="",n=i.from;n<i.to;n++){var s=e[n];s.borderColor!==r&&(t.fillStyle=s.borderColor,r=s.borderColor);var o=Math.round(s.x-this._barWidth),a=Math.round(s.x+this._barWidth),h=Math.min(s.openY,s.closeY),l=Math.max(s.openY,s.closeY);t.fillRect(o,h,a-o+1,l-h+1)}},t.prototype._drawCandles=function(t,e,i){if(null!==this._data)for(var r="",n=i.from;n<i.to;n++){var s=e[n],o=Math.min(s.openY,s.closeY),a=Math.max(s.openY,s.closeY),h=Math.round(s.x-this._barWidth),l=Math.round(s.x+this._barWidth);if(this._data.borderVisible&&(h+=1,o+=1,l-=1,a-=1),!(o>a)){if(s.color!==r){var c=s.color;t.fillStyle=c,r=c}t.fillRect(h,o,l-h+1,a-o+1)}}},t.prototype._drawThinCandles=function(t){if(null!==this._data&&null!==this._data.visibleRange){if(t.lineWidth=1,this._data.wickVisible){t.strokeStyle=this._data.wickColor,t.beginPath();for(var e=this._data.visibleRange.from;e<this._data.visibleRange.to;e++){var i=this._data.bars[e];t.moveTo(i.x,i.lowY),t.lineTo(i.x,i.highY)}t.stroke()}var r="",n=!1;for(t.beginPath(),e=this._data.visibleRange.from;e<this._data.visibleRange.to;e++)r!==(i=this._data.bars[e]).color&&(n&&(t.stroke(),t.beginPath(),n=!1),t.strokeStyle=i.color,r=i.color),t.moveTo(i.x,i.openY),t.lineTo(i.x,i.closeY),n=!0;n&&t.stroke()}},t}(),oe=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._renderer=new se,r}return A(e,t),e.prototype.renderer=function(t,e){this._makeValid();var i=this._series.options(),r={bars:this._items,barSpacing:this._model.timeScale().barSpacing(),wickColor:i.wickColor,wickVisible:i.wickVisible,borderVisible:i.borderVisible,visibleRange:this._itemsVisibleRange};return this._renderer.setData(r),this._renderer},e.prototype._createRawItem=function(t,e,i){var r=i.barStyle(t);return V({},this._createDefaultItem(t,e,i),{color:r.barColor,wickColor:r.barWickColor,borderColor:r.barBorderColor})},e}(ie),ae=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange){var e=this._data.histogramBase;t.translate(.5,.5),t.fillStyle=this._data.color,t.lineWidth=1,t.beginPath();for(var i=this._data.visibleRange.from;i<this._data.visibleRange.to;i++){var r=this._data.items[i],n=r.y,s=r.left,o=r.right;t.rect(s,n,o-s,e-n)}t.fill()}},t}(),he=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._compositeRenderer=new $,r._paletteData=[],r._paletteRenderers=[],r._colorIndexes=new Int32Array(0),r._sourceIndexes=new Int32Array(0),r}return A(e,t),e.prototype.renderer=function(t,e){return this._makeValid(),this._compositeRenderer},e.prototype._fillRawPoints=function(){var t=this,e=this._model.timeScale().barSpacing(),i=this._series.palette();this._paletteRenderers.length=i.size(),this._paletteData.length=i.size();var r=new Int32Array(i.size()),n=this._series.options(),s=this._series.barFunction();this._colorIndexes=new Int32Array(this._series.bars().size());var o=0;this._items.length=this._series.bars().size();var a=0;this._series.bars().each(function(h,l){var c=s(l.value),u=l.value[4],p={time:h,price:c,x:NaN,y:NaN},d=i.colorByIndex(u),_=t._paletteData[u]||function(t,e,i){return{items:[],barSpacing:t,lineWidth:n.lineWidth,histogramBase:NaN,color:d,visibleRange:null}}(e),f=r[u]++;return f<_.items.length?_.items[f]=p:_.items.push(p),t._items[a++]={time:h,x:0},t._paletteData[u]=_,t._colorIndexes[o++]=u,!1}),this._paletteRenderers.length=this._paletteData.length,this._sourceIndexes.length!==this._paletteData.length&&(this._sourceIndexes=new Int32Array(this._paletteData.length)),this._paletteData.forEach(function(e,i){e.items.length=r[i];var n=t._paletteRenderers[i]||new ae;n.setData(e),t._paletteRenderers[i]=n}),this._compositeRenderer.setRenderers(this._paletteRenderers)},e.prototype._convertToCoordinates=function(t,e,i){var r=this;if(null!==this._itemsVisibleRange){var n=e.barSpacing(),s=z(e.visibleBars()),o=t.priceToCoordinate(this._series.options().base,i);this._paletteData.forEach(function(n,a){e.indexesToCoordinates(n.items),t.pointsArrayToCoordinates(n.items,i),n.histogramBase=o,n.visibleRange=Zt(n.items,s),r._sourceIndexes[a]=n.visibleRange.from});for(var a=null,h=this._itemsVisibleRange.from;h<this._itemsVisibleRange.to;++h){var l=this._colorIndexes[h],c=this._paletteData[l],u=this._sourceIndexes[l]++,p=c.items[u];if(p.left=Math.floor(p.x-.5*n),p.right=Math.ceil(p.left+n),null!==a){var d=p.right-p.left>5?1:0;a.right=p.left-d}a=p}}},e}(Kt),le=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._lineRenderer=new Yt,r}return A(e,t),e.prototype.renderer=function(t,e){this._makeValid();var i=this._series.options(),r={items:this._items,lineColor:i.color,lineStyle:i.lineStyle,lineType:0,lineWidth:i.lineWidth,visibleRange:this._itemsVisibleRange};return this._lineRenderer.setData(r),this._lineRenderer},e.prototype._createRawItem=function(t,e){return this._createRawItemBase(t,e)},e}($t),ce=/[2-9]/g,ue=function(){function t(t){void 0===t&&(t=50),this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._tick2Labels={},this._cache={},this._maxSize=t}return t.prototype.reset=function(){this._actualSize=0,this._cache={},this._usageTick=1,this._oldestTick=1,this._tick2Labels={}},t.prototype.measureText=function(t,e,i){var r=i||ce,n=String(e).replace(r,"0");if(this._cache[n])return this._cache[n].width;if(this._actualSize===this._maxSize){var s=this._tick2Labels[this._oldestTick];delete this._tick2Labels[this._oldestTick],delete this._cache[s],this._oldestTick++,this._actualSize--}var o=t.measureText(n).width;return 0===o&&e.length?0:(this._cache[n]={width:o,tick:this._usageTick},this._tick2Labels[this._usageTick]=n,this._actualSize++,this._usageTick++,o)},t}(),pe=function(){function t(t){this._priceAxisViewRenderer=null,this._rendererOptions=null,this._align="right",this._width=0,this._textWidthCache=t}return t.prototype.setParams=function(t,e,i,r){this._priceAxisViewRenderer=t,this._rendererOptions=e,this._width=i,this._align=r},t.prototype.draw=function(t){null!==this._rendererOptions&&null!==this._priceAxisViewRenderer&&this._priceAxisViewRenderer.draw(t,this._rendererOptions,this._textWidthCache,this._width,this._align)},t}(),de=function(){function t(t,e,i){this._priceAxisView=t,this._textWidthCache=new ue(50),this._dataSource=e,this._chartModel=i,this._fontSize=-1,this._renderer=new pe(this._textWidthCache)}return t.prototype.update=function(){this._priceAxisView.update()},t.prototype.renderer=function(t,e){var i=this._chartModel.paneForSource(this._dataSource);if(null===i)return null;if(null===this._dataSource.priceScale())return null;var r=i.priceScalePosition();if("overlay"===r)return null;var n=this._chartModel.priceAxisRendererOptions();return n.fontSize!==this._fontSize&&(this._fontSize=n.fontSize,this._textWidthCache.reset()),this._renderer.setParams(this._priceAxisView.paneRenderer(),n,e,r),this._renderer},t}(),_e=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data&&!1!==this._data.visible){var e=this._data.y;if(!(e<0||e>this._data.height)){var i=this._data.width;t.lineCap="square",t.strokeStyle=this._data.color,t.lineWidth=this._data.lineWidth,D(t,0,e,i,e,this._data.lineStyle)}}},t}(),fe=function(){function t(t){this._lineRendererData={width:0,height:0,y:0,color:"rgba(0, 0, 0, 0)",lineWidth:1,lineStyle:0,visible:!1},this._lineRenderer=new _e,this._invalidated=!0,this._series=t,this._model=t.model(),this._lineRenderer.setData(this._lineRendererData)}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._lineRenderer},t}(),me=function(t){function e(e){return t.call(this,e)||this}return A(e,t),e.prototype._updateImpl=function(){this._lineRendererData.visible=!1;var t=this._series.priceScale().mode().mode;if(2===t||3===t){var e=this._series.options();if(e.baseLineVisible){var i=this._series.firstValue();null!==i&&(this._lineRendererData.visible=!0,this._lineRendererData.y=this._series.priceScale().priceToCoordinate(i,i),this._lineRendererData.width=this._model.timeScale().width(),this._lineRendererData.height=this._series.priceScale().height(),this._lineRendererData.color=e.baseLineColor,this._lineRendererData.lineWidth=e.baseLineWidth,this._lineRendererData.lineStyle=e.baseLineStyle)}}},e}(fe),ve=function(t){function e(e){return t.call(this,e)||this}return A(e,t),e.prototype._updateImpl=function(){this._lineRendererData.visible=!1;var t=this._series.options();if(t.priceLineVisible){var e=this._series.lastValueData(void 0,!0);e.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=e.coordinate,this._lineRendererData.color=this._series.priceLineColor(e.color),this._lineRendererData.width=this._model.timeScale().width(),this._lineRendererData.height=this._series.priceScale().height(),this._lineRendererData.lineWidth=t.priceLineWidth,this._lineRendererData.lineStyle=t.priceLineStyle)}},e}(fe),ge=function(t){function e(e,i){var r=t.call(this)||this;return r._source=e,r._data=i,r}return A(e,t),e.prototype._getSource=function(){return this._source},e.prototype._getData=function(){return this._data},e.prototype._updateRendererData=function(t,e,i){t.visible=!1,e.visible=!1;var r=this._source.options(),n=r.lastValueVisible,s=""!==this._source.title(),o=0===r.seriesLastValueMode,a=this._source.lastValueData(void 0,!1);a.noData||(n&&(t.text=this._axisText(a,n,o),t.visible=0!==t.text.length),(s||o)&&(e.text=this._paneText(a,n,s,o),e.visible=e.text.length>0),i.background=this._source.priceLineColor(a.color),i.color=ct(i.background),i.coordinate=a.coordinate,i.floatCoordinate=a.floatCoordinate)},e.prototype._paneText=function(t,e,i,r){var n="",s=this._source.title();return i&&0!==s.length&&(n+=s+" "),e&&r&&(n+=this._source.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),n.trim()},e.prototype._axisText=function(t,e,i){return e?i?this._source.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},e}(dt),ye=function(){function t(){this._maxUsedIndex=0,this._colorToIndex=new Map,this._indexToColor=new Map}return t.prototype.colorByIndex=function(t){return L(this._indexToColor.get(t))},t.prototype.addColor=function(t){var e=this._colorToIndex.get(t);return void 0===e&&(e=this._maxUsedIndex++,this._colorToIndex.set(t,e),this._indexToColor.set(e,t)),e},t.prototype.size=function(){return this._indexToColor.size},t}(),be={barColor:"",barBorderColor:"",barWickColor:""},Se=function(){function t(t){this._series=t}return t.prototype.barStyle=function(t,e){var i=this._series.seriesType(),r=this._series.options();switch(i){case"Line":return this._lineStyle(r);case"Area":return this._areaStyle(r);case"Bar":return this._barStyle(r,t,e);case"Candlestick":return this._candleStyle(r,t,e);case"Histogram":return this._histogramStyle(r,t,e)}throw new Error("Unknown chart style")},t.prototype._barStyle=function(t,e,i){var r=V({},be),n=t.upColor,s=t.downColor,o=n,a=s,h=z(this._findBar(e,i)),l=B(h.value[0])<=B(h.value[3]);return r.barColor=l?n:s,r.barBorderColor=l?o:a,r},t.prototype._candleStyle=function(t,e,i){var r=V({},be),n=t.upColor,s=t.downColor,o=t.borderUpColor,a=t.borderDownColor,h=t.wickUpColor,l=t.wickDownColor,c=z(this._findBar(e,i)),u=B(c.value[0])<=B(c.value[3]);return r.barColor=u?n:s,r.barBorderColor=u?o:a,r.barWickColor=u?h:l,r},t.prototype._areaStyle=function(t){return V({},be,{barColor:t.lineColor})},t.prototype._lineStyle=function(t){return V({},be,{barColor:t.color})},t.prototype._histogramStyle=function(t,e,i){var r=V({},be),n=z(this._findBar(e,i)).value[4];if(null!=n){var s=z(this._series.palette());r.barColor=s.colorByIndex(n)}else r.barColor=t.color;return r},t.prototype._getSeriesBars=function(){return this._series.bars()},t.prototype._findBar=function(t,e){return void 0!==e?e.value:this._getSeriesBars().valueAt(t)},t}();!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.Exact=0]="Exact",t[t.NearestRight=1]="NearestRight"}(ne||(ne={}));var we,xe=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache=new Map,this._rowSearchCache=new Map,this._rowSearchCacheWithoutEmptyValues=new Map,this._plotFunctions=t||new Map,this._emptyValuePredicate=e}return t.prototype.clear=function(){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache.clear(),this._rowSearchCache.clear(),this._rowSearchCacheWithoutEmptyValues.clear()},t.prototype.first=function(){return this.size()>0?this._items[this._start]:null},t.prototype.last=function(){return this.size()>0?this._items[this._end-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this._indexAt(this._start):null},t.prototype.lastIndex=function(){return this.size()>0?this._indexAt(this._end-1):null},t.prototype.size=function(){return this._end-this._start},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this._search(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.add=function(t,e,i){if(this._shareRead)return!1;var r={index:t,value:i,time:e},n=this._search(t,0);return this._rowSearchCache.clear(),this._rowSearchCacheWithoutEmptyValues.clear(),null===n?(this._items.splice(this._lowerbound(t),0,r),this._start=0,this._end=this._items.length,!0):(this._items[n]=r,!1)},t.prototype.search=function(t,e,i){void 0===e&&(e=0);var r=this._search(t,e,i);if(null===r)return null;var n=this._valueAt(r);return{index:this._indexAt(r),time:n.time,value:n.value}},t.prototype.each=function(t){for(var e=this._start;e<this._end&&!t(this._indexAt(e),this._valueAt(e));++e);},t.prototype.range=function(e,i){var r=new t(this._plotFunctions,this._emptyValuePredicate);return r._items=this._items,r._start=this._lowerbound(e),r._end=this._upperbound(i),r._shareRead=!0,r},t.prototype.minMaxOnRangeCached=function(t,e,i){if(this.isEmpty())return null;for(var r=null,n=0,s=i;n<s.length;n++){var o=s[n];r=Ce(r,this._minMaxOnRangeCachedImpl(t,e,o))}return r},t.prototype.merge=function(t){return this._shareRead?null:0===t.length?null:this.isEmpty()||t[t.length-1].index<this._items[0].index?this._prepend(t):t[0].index>this._items[this._items.length-1].index?this._append(t):1===t.length&&t[0].index===this._items[this._items.length-1].index?(this._updateLast(t[0]),t[0]):this._merge(t)},t.prototype.remove=function(t){if(this._shareRead)return null;var e=this._search(t,1);if(null===e)return null;var i=this._items.splice(e);return this._end=this._items.length,this._minMaxCache.clear(),this._rowSearchCache.clear(),this._rowSearchCacheWithoutEmptyValues.clear(),i.length>0?i[0]:null},t.prototype._indexAt=function(t){return this._items[t].index},t.prototype._valueAt=function(t){return this._items[t]},t.prototype._search=function(t,e,i){var r=this._bsearch(t);if(null===r&&0!==e)switch(e){case-1:return this._searchNearestLeft(t,i);case 1:return this._searchNearestRight(t,i);default:throw new TypeError("Unknown search mode")}if(!i||null===r||0===e)return r;switch(e){case-1:return this._nonEmptyNearestLeft(r);case 1:return this._nonEmptyNearestRight(r);default:throw new TypeError("Unknown search mode")}},t.prototype._nonEmptyNearestRight=function(t){for(var e=z(this._emptyValuePredicate);t<this._end&&e(this._valueAt(t).value);)t+=1;return t===this._end?null:t},t.prototype._nonEmptyNearestLeft=function(t){for(var e=z(this._emptyValuePredicate);t>=this._start&&e(this._valueAt(t).value);)t-=1;return t<this._start?null:t},t.prototype._searchNearestLeft=function(t,e){var i=this._lowerbound(t);i>this._start&&(i-=1);var r=i!==this._end&&this._indexAt(i)<t?i:null;return e&&null!==r?this._nonEmptyNearestLeft(r):r},t.prototype._searchNearestRight=function(t,e){var i=this._upperbound(t),r=i!==this._end&&t<this._indexAt(i)?i:null;return e&&null!==r?this._nonEmptyNearestRight(r):r},t.prototype._bsearch=function(t){var e=this._lowerbound(t);return e===this._end||t<this._items[e].index?null:e},t.prototype._lowerbound=function(t){return jt(this._items,t,function(t,e){return t.index<e},this._start,this._end)},t.prototype._upperbound=function(t){return Xt(this._items,t,function(t,e){return e.index>t},this._start,this._end)},t.prototype._plotMinMax=function(t,e,i){var r=null,n=this._plotFunctions.get(i.name);if(void 0===n)throw new Error('Plot "'+i.name+'" is not registered');for(var s=t;s<e;s++){var o=n(this._items[s].value);null==o||Number.isNaN(o)||(null===r?r={min:o,max:o}:(o<r.min&&(r.min=o),o>r.max&&(r.max=o)))}return r},t.prototype._invalidateCacheForRow=function(t){var e=Math.floor(t.index/30);this._minMaxCache.forEach(function(t){return t.delete(e)})},t.prototype._prepend=function(t){return O(!this._shareRead,"collection should not be readonly"),O(0!==t.length,"plotRows should not be empty"),this._rowSearchCache.clear(),this._rowSearchCacheWithoutEmptyValues.clear(),this._minMaxCache.clear(),this._items=t.concat(this._items),this._start=0,this._end=this._items.length,t[0]},t.prototype._append=function(t){return O(!this._shareRead,"collection should not be readonly"),O(0!==t.length,"plotRows should not be empty"),this._rowSearchCache.clear(),this._rowSearchCacheWithoutEmptyValues.clear(),this._minMaxCache.clear(),this._items=this._items.concat(t),this._start=0,this._end=this._items.length,t[0]},t.prototype._updateLast=function(t){O(!this.isEmpty(),"plot list should not be empty"),O(this._items[this._end-1].index===t.index,"last row index should match new row index"),this._invalidateCacheForRow(t),this._rowSearchCache.delete(t.index),this._rowSearchCacheWithoutEmptyValues.delete(t.index),this._items[this._end-1]=t},t.prototype._merge=function(t){return O(0!==t.length,"plot rows should not be empty"),this._rowSearchCache.clear(),this._rowSearchCacheWithoutEmptyValues.clear(),this._minMaxCache.clear(),this._items=function(t,e){for(var i=function(t,e){for(var i=t.length,r=e.length,n=i+r,s=0,o=0;s<i&&o<r;)t[s].index<e[o].index?s++:t[s].index>e[o].index?o++:(s++,o++,n--);return n}(t,e),r=new Array(i),n=0,s=0,o=t.length,a=e.length,h=0;n<o&&s<a;)t[n].index<e[s].index?(r[h]=t[n],n++):t[n].index>e[s].index?(r[h]=e[s],s++):(r[h]=e[s],n++,s++),h++;for(;n<o;)r[h]=t[n],n++,h++;for(;s<a;)r[h]=e[s],s++,h++;return r}(this._items,t),this._start=0,this._end=this._items.length,t[0]},t.prototype._minMaxOnRangeCachedImpl=function(t,e,i){if(this.isEmpty())return null;var r=null,n=z(this.firstIndex()),s=z(this.lastIndex()),o=t-i.offset,a=e-i.offset;o=Math.max(o,n),a=Math.min(a,s);var h=30*Math.ceil(o/30),l=Math.max(h,30*Math.floor(a/30)),c=this._lowerbound(o),u=this._upperbound(Math.min(a,h,e));r=Ce(r,this._plotMinMax(c,u,i));var p=this._minMaxCache.get(i.name);void 0===p&&(p=new Map,this._minMaxCache.set(i.name,p));for(var d=Math.max(h+1,o);d<l;d+=30){var _=Math.floor(d/30),f=p.get(_);if(void 0===f){var m=this._lowerbound(30*_),v=this._upperbound(30*(_+1)-1);f=this._plotMinMax(m,v,i),p.set(_,f)}r=Ce(r,f)}return c=this._lowerbound(l),u=this._upperbound(a),Ce(r,this._plotMinMax(c,u,i))},t}();function Ce(t,e){return null===t?e:null===e?t:{min:Math.min(t.min,e.min),max:Math.max(t.max,e.max)}}!function(t){t[t.Open=0]="Open",t[t.High=1]="High",t[t.Low=2]="Low",t[t.Close=3]="Close",t[t.Color=4]="Color"}(we||(we={}));var Te={open:function(t){return t[0]},high:function(t){return t[1]},low:function(t){return t[2]},close:function(t){return t[3]},hl2:function(t){return(t[1]+t[2])/2},hlc3:function(t){return(t[1]+t[2]+t[3])/3},ohlc4:function(t){return(t[0]+t[1]+t[2]+t[3])/4}},Me=["open","high","low","close","hl2","hlc3","ohlc4"];function Pe(t){return Te[t]}var ke,Ee=function(){function t(){var t;this._bars=new xe((t=new Map,Me.forEach(function(e,i){t.set(e,Pe(e))}),t))}return t.prototype.bars=function(){return this._bars},t.prototype.size=function(){return this._bars.size()},t.prototype.each=function(t){this._bars.each(t)},t.prototype.clear=function(){this._bars.clear()},t.prototype.isEmpty=function(){return this._bars.isEmpty()},t.prototype.first=function(){return this._bars.first()},t.prototype.last=function(){return this._bars.last()},t.prototype.search=function(t,e){return this.bars().search(t,e)},t.prototype.valueAt=function(t){return this.search(t)},t}(),De=function(t){function e(e,i,r){var n=t.call(this,e)||this;n._data=new Ee,n._priceLineView=new ve(n),n._baseHorizontalLineView=new me(n),n._endOfData=!1,n._paneView=null,n._barColorerCache=null,n._palette=new ye,n._options=i,n._seriesType=r,n.createPaneView();var s=new ge(n,{model:e});return n._priceAxisViews=[s],n._panePriceAxisView=new de(s,n,e),n._recreateFormatter(),n._updateBarFunction(),n._barFunction=n.barFunction(),n}return A(e,t),e.prototype.destroy=function(){},e.prototype.endOfData=function(){return this._endOfData},e.prototype.priceLineColor=function(t){return this._options.priceLineColor||t},e.prototype.lastValueData=function(t,e,i){var r={noData:!0},n=this.priceScale();if(this.model().timeScale().isEmpty()||n.isEmpty()||this.data().isEmpty())return r;var s,o,a=this.model().timeScale().visibleBars(),h=this.firstValue();if(null===a||null===h)return r;if(e){var l=this.data().bars().last();if(null===l)return r;s=l,o=l.index}else{var c=this.data().bars().search(a.lastBar(),-1);if(null===c)return r;if(null===(s=this.data().bars().valueAt(c.index)))return r;o=c.index}var u=void 0!==t?s.value[t]:this._barFunction(s.value),p=this.barColorer().barStyle(o,{value:s}),d=n.priceToCoordinate(u,h,!0);return{noData:!1,price:i?u:void 0,text:n.formatPrice(u,h),formattedPriceAbsolute:n.formatPriceAbsolute(u),formattedPricePercentage:n.formatPricePercentage(u,h),color:p.barColor,floatCoordinate:d,coordinate:Math.round(d),index:o}},e.prototype.data=function(){return this._data},e.prototype.createPaneView=function(){switch(this._paneView=null,this._seriesType){case"Bar":this._paneView=new re(this,this.model());break;case"Candlestick":this._paneView=new oe(this,this.model());break;case"Line":this._paneView=new le(this,this.model());break;case"Area":this._paneView=new Jt(this,this.model());break;case"Histogram":this._paneView=new he(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this._seriesType)}},e.prototype.barColorer=function(){return null!==this._barColorerCache?this._barColorerCache:(this._barColorerCache=new Se(this),this._barColorerCache)},e.prototype.options=function(){return this._options},e.prototype.applyOptions=function(t){var e=this._options.overlay;W(this._options,t),this._options.overlay=e,e&&null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:this._options.scaleMargins}),this._recreateFormatter(),this.model().updateSource(this)},e.prototype.setData=function(t,e,i){this._data.clear(),this._data.bars().merge(t),e&&(this._palette=void 0===i?new ye:i),null!==this._paneView&&this._paneView.update("data");var r=this.model().paneForSource(this);this.model().recalculatePane(r),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},e.prototype.updateData=function(t){this._data.bars().merge(t),null!==this._paneView&&this._paneView.update("data");var e=this.model().paneForSource(this);this.model().recalculatePane(e),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},e.prototype.palette=function(){return this._palette},e.prototype.seriesType=function(){return this._seriesType},e.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:this._barFunction(t.value)},e.prototype.firstBar=function(){var t=this.model().timeScale().visibleBars();if(null===t)return null;var e=t.firstBar();return this.data().search(e,1)},e.prototype.bars=function(){return this._data.bars()},e.prototype.nearestIndex=function(t,e){var i=this.nearestData(t,e);return i?i.index:null},e.prototype.nearestData=function(t,e){return N(t)?this.data().search(t,e):null},e.prototype.dataAt=function(t){var e=this.data().valueAt(t);return null===e?null:"Bar"===this._seriesType||"Candlestick"===this._seriesType?{open:e.value[0],high:e.value[1],low:e.value[2],close:e.value[3]}:this.barFunction()(e.value)},e.prototype.paneViews=function(){var t=[];return this.priceScale()===this.model().mainPriceScale()&&t.push(this._baseHorizontalLineView),t.push(z(this._paneView)),t.push(this._priceLineView),t.push(this._panePriceAxisView),t},e.prototype.priceAxisViews=function(t,e){return this._priceAxisViews},e.prototype.priceRange=function(t,e){if(!N(t))return null;if(!N(e))return null;if(this.data().isEmpty())return null;var i,r="Line"===this._seriesType||"Area"===this._seriesType||"Histogram"===this._seriesType?"close":null,n=null!==(i=null!==r?this.data().bars().minMaxOnRangeCached(t,e,[{name:r,offset:0}]):this.data().bars().minMaxOnRangeCached(t,e,[{name:"low",offset:0},{name:"high",offset:0}]))?i.min===i.max?new kt(i.min-.5,i.max+.5):new kt(i.min,i.max):new kt(-.5,.5);if("Histogram"===this.seriesType()){var s=this._options.base;n=n.merge(new kt(s,s))}return n},e.prototype.base=function(){return Math.round(1/this._options.priceFormat.minMove)},e.prototype.formatter=function(){return this._formatter},e.prototype.barFunction=function(){return this._barFunction},e.prototype.updateAllViews=function(){if(null!==this._paneView){this._paneView.update();for(var t=this._priceAxisViews.length,e=0;e<t;e++)this._priceAxisViews[e].update();this._priceLineView.update(),this._baseHorizontalLineView.update()}},e.prototype.setPriceScale=function(t){this._priceScale!==t&&(this._priceScale=t)},e.prototype.priceScale=function(){return z(this._priceScale)},e.prototype.markerDataAtIndex=function(t){if("Line"!==this._seriesType&&"Area"!==this._seriesType||!this._options.crosshairMarkerVisible)return null;var e=this._data.valueAt(t);return null===e?null:{price:this._barFunction(e.value),radius:this._markerRadius()}},e.prototype.title=function(){return this._options.title},e.prototype._markerRadius=function(){switch(this._seriesType){case"Line":case"Area":return this._options.crosshairMarkerRadius}return 0},e.prototype._recreateFormatter=function(){switch(this._options.priceFormat.type){case"volume":this._formatter=new Nt(this._options.priceFormat.precision);break;case"percent":this._formatter=new Tt(this._options.priceFormat.precision);break;default:var t=Math.pow(10,this._options.priceFormat.precision);this._formatter=new Ct(t,this._options.priceFormat.minMove*t,!1,void 0)}null!==this._priceScale&&this._priceScale.updateFormatter()},e.prototype._updateBarFunction=function(){this._barFunction=Pe("close")},e}(Pt);function Re(t){return t.slice().sort(function(t,e){return z(t.zorder())-z(e.zorder())})}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(ke||(ke={}));var Ie=new Tt,Ae=new Ct(100,1),Ve=function(){function t(t,e,i){this._height=0,this._internalHeightCache=null,this._internalHeightChanged=new Mt,this._priceRange=null,this._priceRangeSnapshot=null,this._priceRangeChanged=new Mt,this._invalidatedForRange={isValid:!1,visibleBars:null},this._onMarksChanged=new Mt,this._modeChanged=new Mt,this._dataSources=[],this._cachedOrderedSources=null,this._hasSeries=!1,this._mainSource=null,this._marksCache=null,this._scaleStartPoint=null,this._scrollStartPoint=null,this._formatter=Ae,this._optionsChanged=new Mt,this._options=t,this._layoutOptions=e,this._localizationOptions=i,this._markBuilder=new Ft(this,100,this._coordinateToLogical.bind(this),this._logicalToCoordinate.bind(this))}return t.prototype.options=function(){return this._options},t.prototype.applyOptions=function(t){if(W(this._options,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),this._optionsChanged.fire(),void 0!==t.scaleMargins){var e=L(t.scaleMargins.top),i=L(t.scaleMargins.bottom);if(e<0||e>1)throw new Error("Invalid top margin - expect value between 0 and 1, given="+e);if(i<0||i>1||e+i>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given="+i);if(e+i>1)throw new Error("Invalid margins - sum of margins must be less than 1, given="+(e+i));this._invalidateInternalHeightCache(),this._marksCache=null}},t.prototype.optionsChanged=function(){return this._optionsChanged},t.prototype.isAutoScale=function(){return this._options.autoScale},t.prototype.isLog=function(){return 1===this._options.mode},t.prototype.isPercentage=function(){return 2===this._options.mode},t.prototype.isIndexedTo100=function(){return 3===this._options.mode},t.prototype.mode=function(){return{autoScale:this._options.autoScale,isInverted:this._options.invertScale,mode:this._options.mode}},t.prototype.setMode=function(t){var e=this.mode(),i=null;void 0!==t.autoScale&&(this._options.autoScale=t.autoScale),void 0!==t.mode&&(this._options.mode=t.mode,2!==t.mode&&3!==t.mode||(this._options.autoScale=!0),this._invalidatedForRange.isValid=!1),1===e.mode&&t.mode!==e.mode&&(function(t){if(null===t)return!1;var e=zt(t.minValue()),i=zt(t.maxValue());return isFinite(e)&&isFinite(i)}(this._priceRange)?null!==(i=function(t){if(null===t)return null;var e=zt(t.minValue()),i=zt(t.maxValue());return new kt(e,i)}(this._priceRange))&&this.setPriceRange(i):this._options.autoScale=!0),1===t.mode&&t.mode!==e.mode&&null!==(i=Bt(this._priceRange))&&this.setPriceRange(i);var r=e.mode!==this._options.mode;r&&(2===e.mode||this.isPercentage())&&this.updateFormatter(),r&&(3===e.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&e.isInverted!==t.isInverted&&(this._options.invertScale=t.isInverted,this._onIsInvertedChanged()),this._modeChanged.fire(e,this.mode())},t.prototype.modeChanged=function(){return this._modeChanged},t.prototype.fontSize=function(){return this._layoutOptions.fontSize},t.prototype.height=function(){return this._height},t.prototype.setHeight=function(t){this._height!==t&&(this._height=t,this._invalidateInternalHeightCache(),this._marksCache=null)},t.prototype.topMargin=function(){return this.isInverted()?this._options.scaleMargins.bottom:this._options.scaleMargins.top},t.prototype.bottomMargin=function(){return this.isInverted()?this._options.scaleMargins.top:this._options.scaleMargins.bottom},t.prototype.internalHeight=function(){if(this._internalHeightCache)return this._internalHeightCache;var t=this.height()*(1-this.topMargin()-this.bottomMargin());return this._internalHeightCache=t,t},t.prototype.internalHeightChanged=function(){return this._internalHeightChanged},t.prototype.priceRange=function(){return this._makeSureItIsValid(),this._priceRange},t.prototype.priceRangeChanged=function(){return this._priceRangeChanged},t.prototype.setPriceRange=function(t,e,i){var r=this._priceRange;(e||null===r&&null!==t||null!==r&&!r.equals(t))&&(this._marksCache=null,this._priceRange=t,i||this._priceRangeChanged.fire(r,t))},t.prototype.isEmpty=function(){return this._makeSureItIsValid(),0===this._height||!this._priceRange||this._priceRange.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,e,i){return this.isPercentage()?t=It(t,e):this.isIndexedTo100()&&(t=Vt(t,e)),this._logicalToCoordinate(t,e,i)},t.prototype.pointsArrayToCoordinates=function(t,e,i){this._makeSureItIsValid();for(var r=this.bottomMargin()*this.height(),n=z(this.priceRange()),s=n.minValue(),o=n.maxValue(),a=this.internalHeight()-1,h=this.isInverted(),l=a/(o-s),c=void 0===i?0:i.from,u=void 0===i?t.length:i.to,p=this._getCoordinateTransformer(),d=c;d<u;d++){var _=t[d],f=_.price;if(!isNaN(f)){var m=f;null!==p&&(m=p(_.price,e));var v=r+l*(m-s),g=h?v:this._height-1-v;_.y=Math.round(g)}}},t.prototype.barPricesToCoordinates=function(t,e,i){this._makeSureItIsValid();for(var r=this.bottomMargin()*this.height(),n=z(this.priceRange()),s=n.minValue(),o=n.maxValue(),a=this.internalHeight()-1,h=this.isInverted(),l=a/(o-s),c=void 0===i?0:i.from,u=void 0===i?t.length:i.to,p=this._getCoordinateTransformer(),d=c;d<u;d++){var _=t[d],f=_.open,m=_.high,v=_.low,g=_.close;null!==p&&(f=p(_.open,e),m=p(_.high,e),v=p(_.low,e),g=p(_.close,e));var y=r+l*(f-s),b=h?y:this._height-1-y;_.openY=Math.round(b),y=r+l*(m-s),b=h?y:this._height-1-y,_.highY=Math.round(b),y=r+l*(v-s),b=h?y:this._height-1-y,_.lowY=Math.round(b),y=r+l*(g-s),b=h?y:this._height-1-y,_.closeY=Math.round(b)}},t.prototype.coordinateToPrice=function(t,e){var i=this._coordinateToLogical(t,e);return this.logicalToPrice(i,e)},t.prototype.logicalToPrice=function(t,e){var i=t;return this.isPercentage()?i=function(t,e){return e<0&&(t=-t),t/100*e+e}(i,e):this.isIndexedTo100()&&(i=function(t,e){return t-=100,e<0&&(t=-t),t/100*e+e}(i,e)),i},t.prototype.dataSources=function(){return this._dataSources},t.prototype.orderedSources=function(){if(this._cachedOrderedSources)return this._cachedOrderedSources;for(var t=[],e=0;e<this._dataSources.length;e++){var i=this._dataSources[e];null===i.zorder()&&i.setZorder(e+1),t.push(i)}return t=Re(t),this._cachedOrderedSources=t,this._cachedOrderedSources},t.prototype.hasSeries=function(){return this._hasSeries},t.prototype.addDataSource=function(t){-1===this._dataSources.indexOf(t)&&(t instanceof De&&(this._hasSeries=!0),this._dataSources.push(t),this._mainSource=null,this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var e=this._dataSources.indexOf(t);if(-1===e)throw new Error("source is not attached to scale");this._dataSources.splice(e,1),t instanceof De&&(this._hasSeries=!1),this.mainSource()||this.setMode({autoScale:!0}),this._mainSource=null,this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.mainSource=function(){if(null!==this._mainSource)return this._mainSource;for(var t=null,e=0;e<this._dataSources.length;e++){var i=this._dataSources[e];if(i instanceof De){t=i;break}null===t&&i instanceof Pt&&(t=i)}return this._mainSource=t,this._mainSource},t.prototype.isInverted=function(){return this._options.invertScale},t.prototype.marks=function(){return this._marksCache?this._marksCache:(this._markBuilder.rebuildTickMarks(),this._marksCache=this._markBuilder.marks(),this._onMarksChanged.fire(),this._marksCache)},t.prototype.onMarksChanged=function(){return this._onMarksChanged},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this._scaleStartPoint&&null===this._priceRangeSnapshot&&(this.isEmpty()||(this._scaleStartPoint=this._height-t,this._priceRangeSnapshot=z(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this._scaleStartPoint){this.setMode({autoScale:!1}),(t=this._height-t)<0&&(t=0);var e=(this._scaleStartPoint+.2*(this._height-1))/(t+.2*(this._height-1)),i=z(this._priceRangeSnapshot).clone();e=Math.max(e,.1),i.scaleAroundCenter(e),this.setPriceRange(i)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this._scaleStartPoint=null,this._priceRangeSnapshot=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this._scrollStartPoint&&null===this._priceRangeSnapshot&&(this.isEmpty()||(this._scrollStartPoint=t,this._priceRangeSnapshot=z(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this._scrollStartPoint){var e=z(this.priceRange()).length()/(this.height()-1),i=t-this._scrollStartPoint;this.isInverted()&&(i*=-1);var r=i*e,n=z(this._priceRangeSnapshot).clone();n.shift(r),this.setPriceRange(n,!0),this._marksCache=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this._scrollStartPoint&&(this._scrollStartPoint=null,this._priceRangeSnapshot=null)},t.prototype.formatter=function(){return this._formatter||this.updateFormatter(),this._formatter},t.prototype.formatPrice=function(t,e){switch(this._options.mode){case 2:return this.formatter().format(It(t,e));case 3:return this.formatter().format(Vt(t,e));default:return this._formatPrice(t)}},t.prototype.formatLogical=function(t){switch(this._options.mode){case 2:case 3:return this.formatter().format(t);default:return this._formatPrice(t)}},t.prototype.formatPriceAbsolute=function(t){return this._formatPrice(t,this._mainSourceFormatter())},t.prototype.formatPricePercentage=function(t,e){return t=It(t,e),Ie.format(t)},t.prototype.sourcesForAutoScale=function(){return this._dataSources.filter(function(t){return t instanceof Pt})},t.prototype.recalculatePriceRange=function(t){this._invalidatedForRange={visibleBars:t,isValid:!1}},t.prototype.updateAllViews=function(){this._dataSources.forEach(function(t){return t.updateAllViews()})},t.prototype.updateFormatter=function(){this._marksCache=null;var t=this.mainSource(),e=100;null!==t&&(e=t.base()),this._formatter=Ae,this.isPercentage()?(this._formatter=Ie,e=100):this.isIndexedTo100()?(this._formatter=new Ct(100,1),e=100):null!==t&&(this._formatter=t.formatter()),this._markBuilder=new Ft(this,e,this._coordinateToLogical.bind(this),this._logicalToCoordinate.bind(this)),this._markBuilder.rebuildTickMarks()},t.prototype.invalidateSourcesCache=function(){this._cachedOrderedSources=null},t.prototype._makeSureItIsValid=function(){this._invalidatedForRange.isValid||(this._invalidatedForRange.isValid=!0,this._recalculatePriceRangeImpl())},t.prototype._invalidateInternalHeightCache=function(){this._internalHeightCache=null,this._internalHeightChanged.fire()},t.prototype._logicalToCoordinate=function(t,e,i){if(this._makeSureItIsValid(),this.isEmpty())return 0;t=this.isLog()&&t?Lt(t):t;var r=z(this.priceRange()),n=this.bottomMargin()*this.height()+(this.internalHeight()-1)*(t-r.minValue())/r.length(),s=this.invertedCoordinate(n);return i?s:Math.round(s)},t.prototype._coordinateToLogical=function(t,e){if(this._makeSureItIsValid(),this.isEmpty())return 0;var i=this.invertedCoordinate(t),r=z(this.priceRange()),n=r.minValue()+r.length()*((i-this.bottomMargin()*this.height())/(this.internalHeight()-1));return this.isLog()?zt(n):n},t.prototype._onIsInvertedChanged=function(){this._marksCache=null,this._markBuilder.rebuildTickMarks()},t.prototype._mainSourceFormatter=function(){return z(this.mainSource()).formatter()},t.prototype._recalculatePriceRangeImpl=function(){var t=this._invalidatedForRange.visibleBars;if(null!==t){for(var e=null,i=this.sourcesForAutoScale(),r=0;r<i.length;r++){var n=i[r],s=n.firstValue();if(null!==s){var o=t.firstBar(),a=t.lastBar(),h=n.priceRange(o,a);if(null!==h){switch(this._options.mode){case 1:h=Bt(h);break;case 2:h=At(h,s);break;case 3:h=Ot(h,s)}e=null===e?h:e.merge(z(h))}}}e?(e.minValue()===e.maxValue()&&(e=new kt(e.minValue()-.5,e.maxValue()+.5)),this.setPriceRange(e)):null===this._priceRange&&this.setPriceRange(new kt(-.5,.5)),this._invalidatedForRange.isValid=!0}},t.prototype._getCoordinateTransformer=function(){return this.isPercentage()?It:this.isIndexedTo100()?Vt:this.isLog()?Lt:null},t.prototype._formatPrice=function(t,e){return void 0===this._localizationOptions.priceFormatter?(void 0===e&&(e=this.formatter()),e.format(t)):this._localizationOptions.priceFormatter(t)},t}();function Oe(t){return!F(t)}function Le(t){return F(t)}var ze=/(\d+(?:\.\d+)?)(px|em|rem|pt)/g,Be=document.createElement("canvas").getContext("2d")||{},We=Be.backingStorePixelRatio||Be.webkitBackingStorePixelRatio||Be.mozBackingStorePixelRatio||Be.msBackingStorePixelRatio||Be.oBackingStorePixelRatio||Be.backingStorePixelRatio||1,Fe=(window.devicePixelRatio||1)/We;function Ne(t){t.width!==Math.floor(parseInt(z(t.style.width))*Fe)&&(t.style.width=t.width+"px",t.width*=Fe,t.height*=Fe);var e=t.getContext("2d");return null===e?null:new Ue(e,Fe)}var He,Ue=function(){function t(t,e){this.canvas=t.canvas,this._ctx=t,this._rto=e}return t.prototype.restore=function(){this._ctx.restore()},t.prototype.save=function(){this._ctx.save()},t.prototype.getTransform=function(){return this._ctx.getTransform()},t.prototype.resetTransform=function(){this._ctx.resetTransform()},t.prototype.rotate=function(t){this._ctx.rotate(t)},t.prototype.scale=function(t,e){this._ctx.scale(t,e)},t.prototype.setTransform=function(t,e,i,r,n,s){F(t)?this._ctx.setTransform(t,e,i,r,n,s):this._ctx.setTransform(t)},t.prototype.transform=function(t,e,i,r,n,s){this._ctx.transform(t,e,i,r,n,s)},t.prototype.translate=function(t,e){this._ctx.translate(t*this._rto,e*this._rto)},Object.defineProperty(t.prototype,"globalAlpha",{get:function(){return this._ctx.globalAlpha},set:function(t){this._ctx.globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalCompositeOperation",{get:function(){return this._ctx.globalCompositeOperation},set:function(t){this._ctx.globalCompositeOperation=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageSmoothingEnabled",{get:function(){return this._ctx.imageSmoothingEnabled},set:function(t){this._ctx.imageSmoothingEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageSmoothingQuality",{get:function(){return this._ctx.imageSmoothingQuality},set:function(t){this._ctx.imageSmoothingQuality=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillStyle",{get:function(){return this._ctx.fillStyle},set:function(t){this._ctx.fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeStyle",{get:function(){return this._ctx.strokeStyle},set:function(t){this._ctx.strokeStyle=t},enumerable:!0,configurable:!0}),t.prototype.createLinearGradient=function(t,e,i,r){return this._ctx.createLinearGradient(t*this._rto,e*this._rto,i*this._rto,r*this._rto)},t.prototype.createPattern=function(t,e){return this._ctx.createPattern(t,e)},t.prototype.createRadialGradient=function(t,e,i,r,n,s){return this._ctx.createRadialGradient(t*this._rto,e*this._rto,i*this._rto,r*this._rto,n*this._rto,s*this._rto)},Object.defineProperty(t.prototype,"shadowBlur",{get:function(){return this._ctx.shadowBlur},set:function(t){this._ctx.shadowBlur=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowColor",{get:function(){return this._ctx.shadowColor},set:function(t){this._ctx.shadowColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetX",{get:function(){return this._ctx.shadowOffsetX},set:function(t){this._ctx.shadowOffsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetY",{get:function(){return this._ctx.shadowOffsetY},set:function(t){this._ctx.shadowOffsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._ctx.filter},set:function(t){this._ctx.filter=t},enumerable:!0,configurable:!0}),t.prototype.clearRect=function(t,e,i,r){this._ctx.clearRect(t*this._rto,e*this._rto,i*this._rto,r*this._rto)},t.prototype.fillRect=function(t,e,i,r){this._ctx.fillRect(t*this._rto,e*this._rto,i*this._rto,r*this._rto)},t.prototype.strokeRect=function(t,e,i,r){this._ctx.strokeRect(t*this._rto,e*this._rto,i*this._rto,r*this._rto)},t.prototype.beginPath=function(){this._ctx.beginPath()},t.prototype.clip=function(t,e){"nonzero"===t||"evenodd"===t||void 0===t?this._ctx.clip(t):this._ctx.clip(t,e)},t.prototype.fill=function(t,e){"nonzero"===t||"evenodd"===t||void 0===t?this._ctx.fill(t):this._ctx.fill(t,e)},t.prototype.isPointInPath=function(t,e,i,r){return F(t)?this._ctx.isPointInPath(t*this._rto,e*this._rto,i):this._ctx.isPointInPath(t,e*this._rto,i*this._rto,r)},t.prototype.isPointInStroke=function(t,e,i){return F(t)?this._ctx.isPointInStroke(t*this._rto,e*this._rto):this._ctx.isPointInStroke(t,e*this._rto,i*this._rto)},t.prototype.stroke=function(t){void 0!==t?this._ctx.stroke(t):this._ctx.stroke()},t.prototype.drawFocusIfNeeded=function(t,e){void 0!==e?this._ctx.drawFocusIfNeeded(t,e):this._ctx.drawFocusIfNeeded(t)},t.prototype.scrollPathIntoView=function(t){void 0!==t?this._ctx.scrollPathIntoView(t):this._ctx.scrollPathIntoView()},t.prototype.fillText=function(t,e,i,r){var n=this;1!==this._rto&&(this.font=this.font.replace(ze,function(t,e,i){return e*n._rto+i})),void 0===r?this._ctx.fillText(t,e*this._rto,i*this._rto):this._ctx.fillText(t,e*this._rto,i*this._rto,r*this._rto),-1!==this._rto&&(this.font=this.font.replace(ze,function(t,e,i){return e/n._rto+i}))},t.prototype.measureText=function(t){return this._ctx.measureText(t)},t.prototype.strokeText=function(t,e,i,r){var n=this;1!==this._rto&&(this.font=this.font.replace(ze,function(t,e,i){return e*n._rto+i})),void 0===r?this._ctx.strokeText(t,e*this._rto,i*this._rto):this._ctx.strokeText(t,e*this._rto,i*this._rto,r*this._rto),1!==this._rto&&(this.font=this.font.replace(ze,function(t,e,i){return e/n._rto+i}))},t.prototype.drawImage=function(t,e,i,r,n,s,o,a,h){return t instanceof HTMLCanvasElement?this._drawImagePatchedSourceAndDest(t,e,i,r,n,s,o,a,h):this._drawImagePatchedSource(t,e,i,r,n,s,o,a,h)},t.prototype.createImageData=function(t,e){return F(t)?this._ctx.createImageData(t,e):this._ctx.createImageData(t)},t.prototype.getImageData=function(t,e,i,r){return this._ctx.getImageData(t,e,i,r)},t.prototype.putImageData=function(t,e,i,r,n,s,o){void 0===r?this._ctx.putImageData(t,e,i):this._ctx.putImageData(t,e,i,r,n,s,o)},Object.defineProperty(t.prototype,"lineCap",{get:function(){return this._ctx.lineCap},set:function(t){this._ctx.lineCap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineDashOffset",{get:function(){return this._ctx.lineDashOffset},set:function(t){this._ctx.lineDashOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._ctx.lineJoin},set:function(t){this._ctx.lineJoin=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this._ctx.lineWidth},set:function(t){this._ctx.lineWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._ctx.miterLimit},set:function(t){this._ctx.miterLimit=t},enumerable:!0,configurable:!0}),t.prototype.getLineDash=function(){return this._ctx.getLineDash()},t.prototype.setLineDash=function(t){this._ctx.setLineDash(t)},Object.defineProperty(t.prototype,"direction",{get:function(){return this._ctx.direction},set:function(t){this._ctx.direction=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"font",{get:function(){return this._ctx.font},set:function(t){this._ctx.font=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textAlign",{get:function(){return this._ctx.textAlign},set:function(t){this._ctx.textAlign=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._ctx.textBaseline},set:function(t){this._ctx.textBaseline=t},enumerable:!0,configurable:!0}),t.prototype.arc=function(t,e,i,r,n,s){this._ctx.arc(t*this._rto,e*this._rto,i*this._rto,r,n,s)},t.prototype.arcTo=function(t,e,i,r,n){this._ctx.arcTo(t*this._rto,e*this._rto,i*this._rto,r*this._rto,n*this._rto)},t.prototype.bezierCurveTo=function(t,e,i,r,n,s){this._ctx.bezierCurveTo(t*this._rto,e*this._rto,i*this._rto,r*this._rto,n*this._rto,s*this._rto)},t.prototype.closePath=function(){this._ctx.closePath()},t.prototype.ellipse=function(t,e,i,r,n,s,o,a){this._ctx.ellipse(t,e,i,r,n,s,o,a)},t.prototype.lineTo=function(t,e){this._ctx.lineTo(t*this._rto,e*this._rto)},t.prototype.moveTo=function(t,e){this._ctx.moveTo(t*this._rto,e*this._rto)},t.prototype.quadraticCurveTo=function(t,e,i,r){this._ctx.quadraticCurveTo(t*this._rto,e*this._rto,i*this._rto,r*this._rto)},t.prototype.rect=function(t,e,i,r){this._ctx.rect(t*this._rto,e*this._rto,i*this._rto,r*this._rto)},t.prototype._drawImageImpl=function(t,e,i,r,n,s,o,a,h){void 0===r?this._ctx.drawImage(t,e,i):void 0===s?this._ctx.drawImage(t,e,i,r,n):this._ctx.drawImage(t,e,i,r,n,s,o,a,h)},t.prototype._drawImagePatchedSource=function(t,e,i,r,n,s,o,a,h){this._drawImageImpl(t,e*this._rto,i*this._rto,void 0===r?r:r*this._rto,void 0===n?n:n*this._rto,void 0===s?s:s*this._rto,void 0===o?o:o*this._rto,void 0===a?a:a*this._rto,void 0===h?h:h*this._rto)},t.prototype._drawImagePatchedSourceAndDest=function(t,e,i,r,n,s,o,a,h){void 0!==s&&("width"in t&&(r=Math.min(t.width,Math.max(1,r))),"height"in t&&(n=Math.min(t.height,Math.max(1,n)))),this._drawImageImpl(t,e*this._rto,i*this._rto,void 0===r?r:r*this._rto,void 0===n?n:n*this._rto,void 0===s?s:s*this._rto,void 0===o?o:o*this._rto,void 0===a?a:a*this._rto,void 0===h?h:h*this._rto)},t}(),Ye="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function je(t,e,i){return void 0!==i?i+=" ":i="",void 0===e&&(e=Ye),""+i+t+"px "+e}!function(t){t[t.BorderSize=1]="BorderSize",t[t.TickLength=4]="TickLength",t[t.OffsetSize=1]="OffsetSize"}(He||(He={}));var Xe,qe=function(){function t(t){this._rendererOptions={borderSize:1,tickLength:4,offsetSize:1,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this._chartModel=t}return t.prototype.options=function(){var t=this._rendererOptions,e=this._fontSize(),i=this._fontFamily();return t.fontSize===e&&t.fontFamily===i||(t.fontSize=e,t.fontFamily=i,t.font=je(e,i),t.paddingTop=Math.floor(e/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(e/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(e/2+t.tickLength/2),t.baselineOffset=Math.round(e/5)),t.color=this._textColor(),this._rendererOptions},t.prototype._textColor=function(){return this._chartModel.options().layout.textColor},t.prototype._fontSize=function(){return this._chartModel.options().layout.fontSize},t.prototype._fontFamily=function(){return this._chartModel.options().layout.fontFamily},t}(),Ge=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data){if(t.lineWidth=1,this._data.vertLinesVisible){t.strokeStyle=this._data.vertLinesColor,R(t,this._data.vertLineStyle),t.beginPath();for(var e=0,i=this._data.timeMarks;e<i.length;e++){var r=i[e];t.moveTo(r.coord+1,0),t.lineTo(r.coord+1,this._data.h)}t.stroke()}if(this._data.horzLinesVisible){t.strokeStyle=this._data.horzLinesColor,R(t,this._data.horzLineStyle),t.beginPath();for(var n=0,s=this._data.priceMarks;n<s.length;n++){var o=s[n];t.moveTo(0,o.coord),t.lineTo(this._data.w,o.coord)}t.stroke()}}},t}(),Ze=function(){function t(t){this._renderer=new Ge,this._invalidated=!0,this._pane=t}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(t,e){if(this._invalidated){var i=this._pane.model().options().grid,r={h:t,w:e,horzLinesVisible:i.horzLines.visible,vertLinesVisible:i.vertLines.visible,horzLinesColor:i.horzLines.color,vertLinesColor:i.vertLines.color,horzLineStyle:i.horzLines.style,vertLineStyle:i.vertLines.style,priceMarks:this._pane.defaultPriceScale().marks(),timeMarks:this._pane.model().timeScale().marks()||[]};this._renderer.setData(r),this._invalidated=!1}return this._renderer},t}(),Ke=function(){function t(){this._paneViews=new WeakMap,this._invalidated=!0}return t.prototype.paneViews=function(t){var e=this._paneViews.get(t);return void 0===e&&(e=[new Ze(t)],this._paneViews.set(t,e)),this._invalidated&&(e.forEach(function(t){return t.update()}),this._invalidated=!1),e},t.prototype.invalidate=function(){this._invalidated=!0},t}();!function(t){t[t.None=0]="None",t[t.Cursor=1]="Cursor",t[t.Light=2]="Light",t[t.Full=3]="Full"}(Xe||(Xe={}));var $e=function(){function t(t){this._invalidatedPanes=new Map,this._force=!1,this._fitContent=!1,this._targetTimeRange=null,this._globalLevel=t}return t.prototype.invalidatePane=function(t,e){var i=function(t,e){return void 0===t?e:{level:Math.max(t.level,e.level),autoScale:t.autoScale||e.autoScale}}(this._invalidatedPanes.get(t),e);this._invalidatedPanes.set(t,i)},t.prototype.invalidateAll=function(t){this._globalLevel=Math.max(this._globalLevel,t)},t.prototype.fullInvalidation=function(){return this._globalLevel},t.prototype.invalidateForPane=function(t){var e=this._invalidatedPanes.get(t);return void 0===e?{level:this._globalLevel}:{level:Math.max(this._globalLevel,e.level),autoScale:e.autoScale}},t.prototype.setFitContent=function(){this._fitContent=!0,this._targetTimeRange=null},t.prototype.getFitContent=function(){return this._fitContent},t.prototype.setTargetTimeRange=function(t){this._targetTimeRange=t,this._fitContent=!1},t.prototype.getTargetTimeRange=function(){return this._targetTimeRange},t.prototype.merge=function(t){var e=this;this._force=this._force||t._force,t._fitContent&&this.setFitContent(),t._targetTimeRange&&this.setTargetTimeRange(t._targetTimeRange),this._globalLevel=Math.max(this._globalLevel,t._globalLevel),t._invalidatedPanes.forEach(function(t,i){e.invalidatePane(i,t)})},t}(),Je=function(){function t(t){this._options=t}return t.prototype.align=function(t,e,i){var r=t;if(0===this._options.mode)return r;var n=i.defaultPriceScale(),s=n.mainSource();if(n.isEmpty()||null===s)return r;var o=s.firstValue();if(null===o)return r;var a=n.priceToCoordinate(t,o),h=i.dataSources().filter(function(t){return t instanceof De}).reduce(function(t,r){if(i.isOverlay(r))return t;var n=r.priceScale(),s=r.bars();if(n.isEmpty()||!s.contains(e))return t;var o=s.valueAt(e);if(null===o)return t;var a=[o.value[3]],h=B(r.firstValue());return t.concat(a.map(function(t){return n.priceToCoordinate(t,h,!0)}))},[]);if(0===h.length)return r;h.sort(function(t,e){return Math.abs(t-a)-Math.abs(e-a)});var l=h[0];return n.coordinateToPrice(l,o)},t}(),Qe=1e3,ti=function(){function t(t,e){this._dataSources=[],this._overlaySources=[],this._height=0,this._width=0,this._stretchFactor=Qe,this._mainDataSource=null,this._cachedOrderedSources=null,this._destroyed=new Mt,this._timeScale=t,this._model=e,this.model().mainPriceScaleOptionsChanged().subscribe(this.onPriceScaleOptionsChanged.bind(this),this),this._defaultNonOverlayPriceScale=this._createPriceScale()}return t.prototype.onPriceScaleOptionsChanged=function(){this._defaultNonOverlayPriceScale.applyOptions(this._model.options().priceScale)},t.prototype.destroy=function(){this.model().mainPriceScaleOptionsChanged().unsubscribeAll(this),this._timeScale.barSpacingChanged().unsubscribeAll(this),this._defaultNonOverlayPriceScale.modeChanged().unsubscribeAll(this),this._dataSources.forEach(function(t){t.destroy&&t.destroy()}),this._destroyed.fire()},t.prototype.stretchFactor=function(){return this._stretchFactor},t.prototype.setStretchFactor=function(t){this._stretchFactor=t},t.prototype.model=function(){return this._model},t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype.setWidth=function(t){this._width=t,this.updateAllViews()},t.prototype.setHeight=function(t){var e=this;this._height=t,this._defaultNonOverlayPriceScale.setHeight(t),this._dataSources.forEach(function(i){if(e.isOverlay(i)){var r=i.priceScale();null!==r&&r.setHeight(t)}}),this.updateAllViews()},t.prototype.dataSources=function(){return this._dataSources},t.prototype.isOverlay=function(t){var e=t.priceScale();return null===e||this._defaultNonOverlayPriceScale!==e},t.prototype.addDataSource=function(t,e,i){var r=this._getZOrderMinMax().minZOrder-1;this._insertDataSource(t,e,r)},t.prototype.removeDataSource=function(t){var e=this._dataSources.indexOf(t);O(-1!==e,"removeDataSource: invalid data source"),this._dataSources.splice(e,1),t===this._mainDataSource&&(this._mainDataSource=null);var i=this._overlaySources.indexOf(t);-1!==i&&this._overlaySources.splice(i,1);var r=t.priceScale();if(r&&r.dataSources().indexOf(t)>=0&&r.removeDataSource(t),r&&null===r.mainSource()){var n=r.dataSources().length;O(0===n,"Invalid priceScale state: empty mainSource but non-empty data sources="+n),r!==this._defaultNonOverlayPriceScale&&r.modeChanged().unsubscribeAll(this)}t instanceof Pt&&this._processMainSourceChange(),r&&t instanceof Pt&&(r.invalidateSourcesCache(),this.recalculatePriceScale(r)),this._cachedOrderedSources=null},t.prototype.priceScalePosition=function(){var t=this._model.options().priceScale.position;return"none"===t?"overlay":t},t.prototype.startScalePrice=function(t,e){t.startScale(e)},t.prototype.scalePriceTo=function(t,e){t.scaleTo(e),this.updateAllViews()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,e){t.startScroll(e)},t.prototype.scrollPriceTo=function(t,e){t.scrollTo(e),this.updateAllViews()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.setPriceAutoScale=function(t,e){t.setMode({autoScale:e}),this._timeScale.isEmpty()?t.setPriceRange(null):this.recalculatePriceScale(t)},t.prototype.updateAllViews=function(){this._dataSources.forEach(function(t){t.updateAllViews()})},t.prototype.defaultPriceScale=function(){var t=this.mainDataSource(),e=null!==t?t.priceScale():null;return null===e&&(e=this._defaultNonOverlayPriceScale),e},t.prototype.mainDataSource=function(){return this._mainDataSource},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this._recalculatePriceScaleImpl(t)},t.prototype.resetPriceScale=function(t){var e=this._timeScale.visibleBars();t.setMode({autoScale:!0}),null!==e&&t.recalculatePriceRange(e),this.updateAllViews()},t.prototype.momentaryAutoScale=function(){this._recalculatePriceScaleImpl(this._defaultNonOverlayPriceScale)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this._defaultNonOverlayPriceScale),this._dataSources.forEach(function(e){t.isOverlay(e)&&t.recalculatePriceScale(e.priceScale())}),this.updateAllViews(),this._model.updatePane(this)},t.prototype.isEmpty=function(){return null===this._mainDataSource},t.prototype.containsSeries=function(){return this._dataSources.some(function(t){return t instanceof De})},t.prototype.orderedSources=function(){return null===this._cachedOrderedSources&&(this._cachedOrderedSources=Re(this._dataSources)),this._cachedOrderedSources},t.prototype.onDestroyed=function(){return this._destroyed},t.prototype._findSuitableScale=function(t,e){return"overlay"!==e?this._defaultNonOverlayPriceScale:this._createPriceScale()},t.prototype._recalculatePriceScaleImpl=function(t){var e=t.sourcesForAutoScale();if(e&&e.length>0&&!this._timeScale.isEmpty()){var i=this._timeScale.visibleBars();null!==i&&t.recalculatePriceRange(i)}t.updateAllViews()},t.prototype._getZOrderMinMax=function(){var t=this.orderedSources();if(0===t.length)return{minZOrder:0,maxZOrder:0};for(var e=0,i=0,r=0;r<t.length;r++){var n=t[r].zorder();null!==n&&(n<e&&(e=n),n>i&&(i=n))}return{minZOrder:e,maxZOrder:i}},t.prototype._insertDataSource=function(t,e,i){var r="overlay",n=null;if(!e){var s=this.model().options().priceScale.position;r="none"===s?"overlay":s}t instanceof Pt&&(n=this._findSuitableScale(t,r)),this._dataSources.push(t),e&&this._overlaySources.push(t),null!==n&&(n.addDataSource(t),t.setPriceScale(n)),t.setZorder(i),this._processMainSourceChange(),t instanceof Pt&&this.recalculatePriceScale(n),this._cachedOrderedSources=null},t.prototype._onPriceScaleModeChanged=function(t,e,i){e.mode!==i.mode&&this._recalculatePriceScaleImpl(t)},t.prototype._processMainSourceChange=function(){if(null===this._mainDataSource||-1!==this._overlaySources.indexOf(this._mainDataSource)){for(var t=0,e=this._dataSources;t<e.length;t++)if((n=e[t])instanceof Pt&&!this.isOverlay(n))return void this._setMainSource(n);for(var i=0,r=this._overlaySources;i<r.length;i++){var n;if((n=r[i])instanceof Pt)return void this._setMainSource(n)}}},t.prototype._setMainSource=function(t){var e=z(t.priceScale());this.defaultPriceScale().modeChanged().unsubscribeAll(this),e.modeChanged().subscribe(this._onPriceScaleModeChanged.bind(this,e),this),this._mainDataSource=t},t.prototype._createPriceScale=function(){var t=new Ve(Y(this._model.options().priceScale),this._model.options().layout,this._model.options().localization);return t.setHeight(this.height()),t},t}(),ei=function(t){return t.getUTCFullYear()},ii=function(t){return wt(function(t){return t.getUTCDate()}(t),2)},ri=function(t){return wt(function(t){return t.getUTCMonth()+1}(t),2)},ni=function(t){return wt(ei(t)%100,2)},si=function(t){return wt(ei(t),4)},oi={"dd MMM 'yy":function(t,e){return ii(t)+" "+function(t,e){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(e,{month:"short"})}(t,e)+" '"+ni(t)},"yyyy-MM-dd":function(t,e){return si(t)+"-"+ri(t)+"-"+ii(t)},"yy-MM-dd":function(t,e){return ni(t)+"-"+ri(t)+"-"+ii(t)},"yy/MM/dd":function(t,e){return ni(t)+"/"+ri(t)+"/"+ii(t)},"yyyy/MM/dd":function(t,e){return si(t)+"/"+ri(t)+"/"+ii(t)},"dd-MM-yyyy":function(t,e){return ii(t)+"-"+ri(t)+"-"+si(t)},"dd-MM-yy":function(t,e){return ii(t)+"-"+ri(t)+"-"+ni(t)},"dd/MM/yy":function(t,e){return ii(t)+"/"+ri(t)+"/"+ni(t)},"dd/MM/yyyy":function(t,e){return ii(t)+"/"+ri(t)+"/"+si(t)},"MM/dd/yy":function(t,e){return ri(t)+"/"+ii(t)+"/"+ni(t)},"MM/dd/yyyy":function(t,e){return ri(t)+"/"+ii(t)+"/"+si(t)}},ai=function(){function t(t,e){void 0===t&&(t="yyyy-MM-dd"),void 0===e&&(e="default"),this._dateFormatFunc=oi[t],this._locale=e}return t.prototype.format=function(t){return this._dateFormatFunc(t,this._locale)},t}(),hi=function(){function t(t){this._formatStr=t||"%h:%m:%s"}return t.prototype.format=function(t){return this._formatStr.replace("%h",wt(t.getUTCHours(),2)).replace("%m",wt(t.getUTCMinutes(),2)).replace("%s",wt(t.getUTCSeconds(),2))},t}(),li={dateFormat:"yyyy-MM-dd",timeFormat:"%h:%m:%s",dateTimeSeparator:" ",locale:"default"},ci=function(){function t(t){void 0===t&&(t={});var e=V({},li,t);this._dateFormatter=new ai(e.dateFormat,e.locale),this._timeFormatter=new hi(e.timeFormat),this._separator=e.dateTimeSeparator}return t.prototype.format=function(t){return""+this._dateFormatter.format(t)+this._separator+this._timeFormatter.format(t)},t}(),ui=function(){function t(t,e){O(t<=e,"The last bar in the bars range should be greater than or equal to the first bar"),this._firstBar=t,this._lastBar=e}return t.prototype.firstBar=function(){return this._firstBar},t.prototype.lastBar=function(){return this._lastBar},t.prototype.count=function(){return this._lastBar-this._firstBar+1},t.prototype.contains=function(t){return this._firstBar<=t&&t<=this._lastBar},t.prototype.equals=function(t){return this._firstBar===t.firstBar()&&this._lastBar===t.lastBar()},t}(),pi=function(){function t(t,e){void 0===e&&(e=50),this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._cache=new Map,this._tick2Labels=new Map,this._format=t,this._maxSize=e}return t.prototype.format=function(t){var e=this._cache.get(t.valueOf());if(void 0!==e)return e.string;if(this._actualSize===this._maxSize){var i=this._tick2Labels.get(this._oldestTick);this._tick2Labels.delete(this._oldestTick),this._cache.delete(L(i)),this._oldestTick++,this._actualSize--}var r=this._format(t);return this._cache.set(t.valueOf(),{string:r,tick:this._usageTick}),this._tick2Labels.set(this._usageTick,t.valueOf()),this._actualSize++,this._usageTick++,r},t}();function di(t,e){return t.index-e.index}var _i,fi,mi=function(){function t(){this._minIndex=1/0,this._maxIndex=-1/0,this._marksByIndex=new Map,this._marksBySpan=[],this._changed=new Mt,this._cache=null,this._maxBar=NaN}return t.prototype.reset=function(){this._marksByIndex.clear(),this._marksBySpan=[],this._minIndex=1/0,this._maxIndex=-1/0,this._cache=null,this._changed.fire()},t.prototype.merge=function(t){for(var e=this._marksBySpan,i={},r=0,n=t;r<n.length;r++){var s=n[r],o=s.index,a=s.span,h=this._marksByIndex.get(s.index);if(h){if(h.index===s.index&&h.span===s.span){h.time=s.time;continue}this._removeTickMark(h)}this._marksByIndex.set(o,s),this._minIndex>o&&(this._minIndex=o),this._maxIndex<o&&(this._maxIndex=o),void 0===(l=e[a])&&(l=[],e[a]=l),l.push(s),i[a]=!0}for(a=e.length;a--;){var l;void 0!==(l=e[a])&&(0===l.length&&delete e[a],i[a]&&l.sort(di))}this._cache=null,this._changed.fire()},t.prototype.indexToTime=function(t){var e=this._marksByIndex.get(t);return void 0===e?null:e.time},t.prototype.nearestIndex=function(t){for(var e=this._minIndex,i=this._maxIndex;i-e>2;){if(1e3*L(this._marksByIndex.get(e)).time.timestamp===t)return e;if(1e3*L(this._marksByIndex.get(i)).time.timestamp===t)return i;var r=Math.round((e+i)/2);1e3*L(this._marksByIndex.get(r)).time.timestamp>t?i=r:e=r}return e},t.prototype.build=function(t,e){var i=Math.ceil(e/t);if(this._maxBar===i&&this._cache)return this._cache;this._maxBar=i;for(var r=[],n=this._marksBySpan.length;n--;)if(this._marksBySpan[n]){var s=r;r=[];for(var o=s.length,a=0,h=L(this._marksBySpan[n]),l=h.length,c=1/0,u=-1/0,p=0;p<l;p++){for(var d=h[p],_=d.index;a<o;){var f=s[a],m=f.index;if(!(m<_)){c=m;break}a++,r.push(f),u=m,c=1/0}c-_>=i&&_-u>=i&&(r.push(d),u=_)}for(;a<o;a++)r.push(s[a])}return this._cache=r,this._cache},t.prototype._removeTickMark=function(t){var e=t.index;if(this._marksByIndex.get(e)===t){this._marksByIndex.delete(e),e<=this._minIndex&&this._minIndex++,e>=this._maxIndex&&this._maxIndex--,this._maxIndex<this._minIndex&&(this._minIndex=1/0,this._maxIndex=-1/0);var i=L(this._marksBySpan[t.span]),r=i.indexOf(t);-1!==r&&i.splice(r,1)}},t}(),vi=function(){function t(){this._items=[]}return t.prototype.clear=function(){this._items=[]},t.prototype.size=function(){return this._items.length},t.prototype.firstIndex=function(){return this._offsetToIndex(0)},t.prototype.lastIndex=function(){return this._offsetToIndex(this._items.length-1)},t.prototype.merge=function(t,e){if(0!==e.length)if(0!==this._items.length){var i=t;if(i<0){var r=Math.abs(i);if(e.length<r)return;this._items=new Array(r).concat(this._items);for(var n=0;n<e.length;++n)this._items[t+n]=e[n]}else{for(var s=i;s<this._items.length&&s-i<e.length;++s)this._items[s]=e[s-i];var o=i+e.length;if(o>this._items.length){r=o-this._items.length;for(var a=s;a<s+r;++a)this._items.push(e[a-i])}}}else this._items=e},t.prototype.valueAt=function(t){var e=this._indexToOffset(t);return null!==e?this._items[e]:null},t.prototype.indexOf=function(t,e){if(this._items.length<1)return null;if(t>this._items[this._items.length-1].timestamp)return e?this._items.length-1:null;for(var i=0;i<this._items.length;++i){if(t===this._items[i].timestamp)return i;if(t<this._items[i].timestamp)return e?i:null}return null},t.prototype.closestIndexLeft=function(t){var e=this._items;if(!e.length)return null;if(Number.isNaN(t.timestamp))return null;var i=e.length-1;if(t>=e[i])return i;var r=0,n=e[r];if(t<n)return null;if(t===n)return r;for(;i>r+1;){var s=r+i>>1,o=e[s];if(o.timestamp>t.timestamp)i=s;else{if(!(o.timestamp<t.timestamp))return o.timestamp===t.timestamp?s:null;r=s}}return r},t.prototype._offsetToIndex=function(t){return 0<=t&&t<this.size()?t:null},t.prototype._indexToOffset=function(t){return 0<=t&&t<this.size()?t:null},t}();!function(t){t[t.DefaultAnimationDuration=400]="DefaultAnimationDuration",t[t.MaxBarSpacing=50]="MaxBarSpacing",t[t.MinBarSpacing=.5]="MinBarSpacing",t[t.MinVisibleBarsCount=5]="MinVisibleBarsCount"}(_i||(_i={})),function(t){t[t.Minute=20]="Minute",t[t.Hour=30]="Hour",t[t.Day=40]="Day",t[t.Week=50]="Week",t[t.Month=60]="Month",t[t.Year=70]="Year"}(fi||(fi={}));var gi=function(){function t(t,e,i){this._width=0,this._baseIndexOrNull=null,this._points=new vi,this._barSpacingChanged=new Mt,this._scrollStartPoint=null,this._scaleStartPoint=null,this._tickMarks=new mi,this._formattedBySpan=new Map,this._visibleBars=null,this._visibleBarsInvalidated=!0,this._visibleBarsChanged=new Mt,this._optionsApplied=new Mt,this._leftEdgeIndex=null,this._commonTransitionStartState=null,this._timeMarksCache=null,this._labels=[],this._options=e,this._localizationOptions=i,this._rightOffset=e.rightOffset,this._barSpacing=yi(e.barSpacing),this._model=t,this._updateDateTimeFormatter()}return t.prototype.options=function(){return this._options},t.prototype.applyLocalizationOptions=function(t){W(this._localizationOptions,t),this._invalidateTickMarks(),this._updateDateTimeFormatter()},t.prototype.applyOptions=function(t,e){if(W(this._options,t),this._options.fixLeftEdge){var i=this._points.firstIndex();null!==i&&this.setLeftEdgeFix(i)}else this._leftEdgeIndex=null;void 0!==t.rightOffset&&this.setRightOffset(t.rightOffset),void 0!==t.barSpacing&&this.setBarSpacing(t.barSpacing),this._invalidateTickMarks(),this._updateDateTimeFormatter(),this._optionsApplied.fire()},t.prototype.isEmpty=function(){return 0===this._width||0===this._points.size()},t.prototype.visibleBars=function(){return this._visibleBarsInvalidated&&(this._visibleBarsInvalidated=!1,this._updateVisibleBars()),this._visibleBars},t.prototype.tickMarks=function(){return this._tickMarks},t.prototype.points=function(){return this._points},t.prototype.width=function(){return this._width},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this._width!==t){if(this._visibleBarsInvalidated=!0,this._options.lockVisibleTimeRangeOnResize&&this._width){var e=this._barSpacing*t/this._width;this._setBarSpacing(e)}if(null!==this._leftEdgeIndex&&z(this.visibleBars()).firstBar()<=this._leftEdgeIndex){var i=this._width-t;this._rightOffset-=Math.round(i/this._barSpacing)+1}this._width=t,this._correctOffset()}},t.prototype.indexToCoordinate=function(t,e){if(this.isEmpty()||!N(t))return 0;var i=this.baseIndex()+this._rightOffset-t,r=this._width-(i+.5)*this._barSpacing;return e?r:Math.round(r)},t.prototype.indexesToCoordinates=function(t,e){for(var i=this.baseIndex(),r=void 0===e?0:e.from,n=void 0===e?t.length:e.to,s=r;s<n;s++){var o=t[s].time,a=i+this._rightOffset-o,h=this._width-(a+.5)*this._barSpacing;t[s].x=Math.round(h)}},t.prototype.indexToUserTime=function(t){return this._tickMarks.indexToTime(t)},t.prototype.coordinateToIndex=function(t){return Math.ceil(this._coordinateToFloatIndex(t))},t.prototype.setRightOffset=function(t){this._visibleBarsInvalidated=!0,this._rightOffset=t,this._correctOffset(),this._model.recalculateAllPanes(),this._model.lightUpdate()},t.prototype.barSpacing=function(){return this._barSpacing},t.prototype.setBarSpacing=function(t){this._setBarSpacing(t),this._correctOffset()},t.prototype.barSpacingChanged=function(){return this._barSpacingChanged},t.prototype.rightOffset=function(){return this._rightOffset},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this._timeMarksCache)return this._timeMarksCache;for(var t=this._barSpacing,e=5*(this._model.options().layout.fontSize+4),i=Math.round(e/t),r=z(this.visibleBars()),n=Math.max(r.firstBar(),r.firstBar()-i),s=Math.max(r.lastBar(),r.lastBar()-i),o=0,a=0,h=this._tickMarks.build(t,e);a<h.length;a++){var l=h[a];if(n<=l.index&&l.index<=s){var c=this._tickMarks.indexToTime(l.index);if(null!==c){if(o<this._labels.length){var u=this._labels[o];u.coord=this.indexToCoordinate(l.index),u.label=this._formatLabel(c,l.span),u.span=l.span,u.major=!1}else this._labels.push({coord:this.indexToCoordinate(l.index),label:this._formatLabel(c,l.span),span:l.span,major:!1});o++}}}return this._labels.length=o,this._timeMarksCache=this._labels,this._labels},t.prototype.reset=function(){this._visibleBarsInvalidated=!0,this._points=new vi,this._scrollStartPoint=null,this._scaleStartPoint=null,this._clearCommonTransitionsStartState(),this._tickMarks.reset(),this._leftEdgeIndex=null},t.prototype.restoreDefault=function(){this._visibleBarsInvalidated=!0,this.setBarSpacing(this._options.barSpacing),this.setRightOffset(this._options.rightOffset)},t.prototype.setLeftEdgeFix=function(t){this._leftEdgeIndex=t;var e=z(this.visibleBars()).firstBar()-t;if(e<0){var i=this._rightOffset-e-1;this.scrollToOffsetAnimated(i,500)}},t.prototype.fixLeftEdge=function(){return this._options.fixLeftEdge},t.prototype.setBaseIndex=function(t){this._visibleBarsInvalidated=!0,this._baseIndexOrNull=t,this._correctOffset()},t.prototype.zoom=function(t,e){var i=this._coordinateToFloatIndex(t),r=this.barSpacing(),n=r+e*(r/10);this.setBarSpacing(n),this._options.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(i-this._coordinateToFloatIndex(t)))},t.prototype.startScale=function(t){this._scrollStartPoint&&this.endScroll(),null===this._scaleStartPoint&&null===this._commonTransitionStartState&&(this.isEmpty()||(this._scaleStartPoint=t,this._saveCommonTransitionsStartState()))},t.prototype.scaleTo=function(t){if(null!==this._commonTransitionStartState){var e=Et(this._width-t,0,this._width),i=Et(this._width-z(this._scaleStartPoint),0,this._width);0!==e&&0!==i&&this.setBarSpacing(this._commonTransitionStartState.barSpacing*e/i)}},t.prototype.endScale=function(){null!==this._scaleStartPoint&&(this._scaleStartPoint=null,this._clearCommonTransitionsStartState())},t.prototype.startScroll=function(t){null===this._scrollStartPoint&&null===this._commonTransitionStartState&&(this.isEmpty()||(this._scrollStartPoint=t,this._saveCommonTransitionsStartState()))},t.prototype.scrollTo=function(t){if(this._visibleBarsInvalidated=!0,null!==this._scrollStartPoint){var e=(this._scrollStartPoint-t)/this.barSpacing();this._rightOffset=z(this._commonTransitionStartState).rightOffset+e,this._correctOffset()}},t.prototype.endScroll=function(){null!==this._scrollStartPoint&&(this._scrollStartPoint=null,this._clearCommonTransitionsStartState())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this._options.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,e){var i=this;if(void 0===e&&(e=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(e)||e<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var r=this._rightOffset,n=(new Date).getTime(),s=function(){var o=((new Date).getTime()-n)/e,a=o>=1,h=a?t:r+(t-r)*o;i.setRightOffset(h),a||setTimeout(s,20)};s()},t.prototype.update=function(t,e,i){if(this._visibleBarsInvalidated=!0,e.length>0){var r=this._points.size();this._points.merge(t,e),this._rightOffset<0&&this._points.size()===r+1&&(this._rightOffset-=1,this._visibleBarsInvalidated=!0)}this._tickMarks.merge(i),this._correctOffset()},t.prototype.visibleBarsChanged=function(){return this._visibleBarsChanged},t.prototype.optionsApplied=function(){return this._optionsApplied},t.prototype.baseIndex=function(){return this._baseIndexOrNull||0},t.prototype.setVisibleRange=function(t){var e=t.count();this._setBarSpacing(this._width/e),this._rightOffset=t.lastBar()-this.baseIndex(),this._correctOffset(),this._visibleBarsInvalidated=!0,this._model.recalculateAllPanes(),this._model.lightUpdate()},t.prototype.fitContent=function(){var t=this._points.firstIndex(),e=this._points.lastIndex();null!==t&&null!==e&&this.setVisibleRange(new ui(t-1,e+1+this._options.rightOffset))},t.prototype.setTimePointsRange=function(t){var e=this.points(),i=e.firstIndex(),r=e.lastIndex();if(null!==i&&null!==r){var n=z(e.valueAt(i)).timestamp,s=z(e.valueAt(r)).timestamp,o=new ui(z(e.indexOf(Math.max(n,t.from.timestamp),!0)),z(e.indexOf(Math.min(s,t.to.timestamp),!0)));this.setVisibleRange(o)}},t.prototype.formatDateTime=function(t){return void 0!==this._localizationOptions.timeFormatter?this._localizationOptions.timeFormatter(t.businessDay||t.timestamp):this._dateTimeFormatter.format(new Date(1e3*t.timestamp))},t.prototype._rightOffsetForCoordinate=function(t){return(this._width+1-t)/this._barSpacing},t.prototype._coordinateToFloatIndex=function(t){var e=this._rightOffsetForCoordinate(t),i=this.baseIndex()+this._rightOffset-e;return Math.round(1e6*i)/1e6},t.prototype._setBarSpacing=function(t){t=yi(t);var e=this._barSpacing;e!==t&&(this._visibleBarsInvalidated=!0,this._barSpacing=t,this._barSpacingChanged.fire(e,t),this._resetTimeMarksCache())},t.prototype._updateVisibleBars=function(){if(this.isEmpty())this._setVisibleBars(null);else{var t=this.baseIndex(),e=Math.ceil(this._width/this._barSpacing)-1,i=Math.round(this._rightOffset+t),r=i-e;this._setVisibleBars(new ui(r,i))}},t.prototype._correctOffset=function(){var t=this._maxRightOffset();this._rightOffset>t&&(this._rightOffset=t,this._visibleBarsInvalidated=!0);var e=this._minRightOffset();null!==e&&this._rightOffset<e&&(this._rightOffset=e,this._visibleBarsInvalidated=!0)},t.prototype._minRightOffset=function(){var t=this._points.firstIndex(),e=this._baseIndexOrNull;if(null===t||null===e)return null;if(null!==this._leftEdgeIndex){var i=this._width/this._barSpacing;return this._leftEdgeIndex-e+i-1}return t-e-1+5},t.prototype._maxRightOffset=function(){return this._width/this._barSpacing-5},t.prototype._saveCommonTransitionsStartState=function(){this._commonTransitionStartState={barSpacing:this.barSpacing(),rightOffset:this.rightOffset()}},t.prototype._clearCommonTransitionsStartState=function(){this._commonTransitionStartState=null},t.prototype._formatLabel=function(t,e){var i=this,r=this._formattedBySpan.get(e);return void 0===r&&(r=new pi(function(t){return i._formatLabelImpl(t,e)}),this._formattedBySpan.set(e,r)),void 0===t.businessDay?r.format(new Date(1e3*t.timestamp)):r.format(new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)))},t.prototype._formatLabelImpl=function(t,e){var i={},r=this._options.timeVisible;return e<20&&r?(i.hour12=!1,i.hour="2-digit",i.minute="2-digit",this._options.secondsVisible&&(i.second="2-digit")):e<40&&r?(i.hour12=!1,i.hour="2-digit",i.minute="2-digit"):e<50?i.day="numeric":e<60?i.day="numeric":e<70?i.month="short":i.year="numeric",new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()).toLocaleString(this._localizationOptions.locale,i)},t.prototype._setVisibleBars=function(t){if(null!==t||null!==this._visibleBars){var e=this._visibleBars;this._visibleBars=t,(null===this._visibleBars||null!==e&&!this._visibleBars.equals(e))&&this._visibleBarsChanged.fire(),this._resetTimeMarksCache()}},t.prototype._resetTimeMarksCache=function(){this._timeMarksCache=null},t.prototype._invalidateTickMarks=function(){this._resetTimeMarksCache(),this._formattedBySpan.clear()},t.prototype._updateDateTimeFormatter=function(){var t=this._localizationOptions.dateFormat;this._options.timeVisible?this._dateTimeFormatter=new ci({dateFormat:t,timeFormat:this._options.secondsVisible?"%h:%m:%s":"%h:%m",dateTimeSeparator:"   ",locale:this._localizationOptions.locale}):this._dateTimeFormatter=new ai(t,this._localizationOptions.locale)},t}();function yi(t){return t<.5?.5:t>50?50:t}var bi=function(){function t(t){this._metricsCache=new Map,this._data=t}return t.prototype.draw=function(t){},t.prototype.drawBackground=function(t){if(this._data.visible){t.save();for(var e=0,i=0,r=this._data.lines;i<r.length;i++)if(0!==(h=r[i]).text.length){t.font=h.font;var n=this._metrics(t,h.text);n>this._data.width?h.zoom=this._data.width/n:h.zoom=1,e+=h.lineHeight*h.zoom}var s=0;switch(this._data.vertAlign){case"top":s=0;break;case"center":s=Math.max((this._data.height-e)/2,0);break;case"bottom":s=Math.max(this._data.height-e,0)}t.fillStyle=this._data.color;for(var o=0,a=this._data.lines;o<a.length;o++){var h=a[o];t.save();var l=0;switch(this._data.horzAlign){case"left":t.textAlign="left",l=h.lineHeight/2;break;case"center":t.textAlign="center",l=this._data.width/2;break;case"right":t.textAlign="right",l=this._data.width-1-h.lineHeight/2}t.translate(l,s),t.textBaseline="top",t.font=h.font,t.scale(h.zoom,h.zoom),t.fillText(h.text,0,h.vertOffset),t.restore(),s+=h.lineHeight*h.zoom}t.restore()}},t.prototype._metrics=function(t,e){var i=this._fontCache(t.font),r=i.get(e);return void 0===r&&(r=t.measureText(e).width,i.set(e,r)),r},t.prototype._fontCache=function(t){var e=this._metricsCache.get(t);return void 0===e&&(e=new Map,this._metricsCache.set(t,e)),e},t}(),Si=function(){function t(t){this._invalidated=!0,this._rendererData={visible:!1,color:"",height:0,width:0,lines:[],vertAlign:"center",horzAlign:"center"},this._renderer=new bi(this._rendererData),this._source=t}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(t,e){return this._invalidated&&(this._updateImpl(t,e),this._invalidated=!1),this._renderer},t.prototype._updateImpl=function(t,e){var i=this._source.options(),r=this._rendererData;r.visible=i.visible,r.visible&&(r.color=i.color,r.width=e,r.height=t,r.horzAlign=i.horzAlign,r.vertAlign=i.vertAlign,r.lines=[{text:i.text,font:je(i.fontSize),lineHeight:1.2*i.fontSize,vertOffset:0,zoom:0}])},t}(),wi=function(t){function e(e,i){var r=t.call(this)||this;return r._options=i,r._paneView=new Si(r),r}return A(e,t),e.prototype.paneViews=function(){return[this._paneView]},e.prototype.options=function(){return this._options},e.prototype.updateAllViews=function(){this._paneView.update()},e}(gt),xi=function(){function t(t,e){this._panes=[],this._serieses=[],this._width=0,this._initialTimeScrollPos=null,this._hoveredSource=null,this._mainPriceScaleOptionsChanged=new Mt,this._crosshairMoved=new Mt,this._invalidateHandler=t,this._options=e,this._rendererOptionsProvider=new qe(this),this._timeScale=new gi(this,e.timeScale,this._options.localization),this._grid=new Ke,this._crosshair=new yt(this,e.crosshair),this._magnet=new Je(e.crosshair),this._watermark=new wi(this,e.watermark),this.createPane(),this._panes[0].setStretchFactor(2*Qe),this._panes[0].addDataSource(this._watermark,!0,!1)}return t.prototype.updatePane=function(t){var e=this._paneInvalidationMask(t,0);this._invalidate(e)},t.prototype.fullUpdate=function(){this._invalidate(new $e(3))},t.prototype.lightUpdate=function(){this._invalidate(new $e(2))},t.prototype.updateSource=function(t){var e=this._invalidationMaskForSource(t);this._invalidate(e)},t.prototype.hoveredSource=function(){return this._hoveredSource},t.prototype.setHoveredSource=function(t){this._hoveredSource=t},t.prototype.options=function(){return this._options},t.prototype.applyOptions=function(t){W(this._options,t),void 0!==t.priceScale&&(this.mainPriceScale().applyOptions(t.priceScale),this._mainPriceScaleOptionsChanged.fire()),void 0!==t.timeScale&&this._timeScale.applyOptions(t.timeScale),void 0!==t.localization&&(this._timeScale.applyLocalizationOptions(t.localization),this.mainPriceScale().updateFormatter()),this.fullUpdate()},t.prototype.updateAllPaneViews=function(){this._panes.forEach(function(t){return t.updateAllViews()})},t.prototype.timeScale=function(){return this._timeScale},t.prototype.panes=function(){return this._panes},t.prototype.gridSource=function(){return this._grid},t.prototype.watermarkSource=function(){return this._watermark},t.prototype.crosshairSource=function(){return this._crosshair},t.prototype.crosshairMoved=function(){return this._crosshairMoved},t.prototype.width=function(){return this._width},t.prototype.setPaneHeight=function(t,e){t.setHeight(e),this.recalculateAllPanes(),this.lightUpdate()},t.prototype.setWidth=function(t){this._width=t,this._timeScale.setWidth(this._width),this._panes.forEach(function(e){return e.setWidth(t)}),this.recalculateAllPanes()},t.prototype.createPane=function(t){var e=new ti(this._timeScale,this);void 0!==t?this._panes.splice(t,0,e):this._panes.push(e);var i=void 0===t?this._panes.length-1:t,r=new $e(3);return r.invalidatePane(i,{level:0,autoScale:!0}),this.invalidate(r),e},t.prototype.startScalePrice=function(t,e,i){t.startScalePrice(e,i)},t.prototype.scalePriceTo=function(t,e,i){t.scalePriceTo(e,i),this.updateCrosshair(),this._invalidate(this._paneInvalidationMask(t,2))},t.prototype.endScalePrice=function(t,e){t.endScalePrice(e),this._invalidate(this._paneInvalidationMask(t,2))},t.prototype.startScrollPrice=function(t,e,i){e.isAutoScale()||t.startScrollPrice(e,i)},t.prototype.scrollPriceTo=function(t,e,i){e.isAutoScale()||(t.scrollPriceTo(e,i),this.updateCrosshair(),this._invalidate(this._paneInvalidationMask(t,2)))},t.prototype.endScrollPrice=function(t,e){e.isAutoScale()||(t.endScrollPrice(e),this._invalidate(this._paneInvalidationMask(t,2)))},t.prototype.setPriceAutoScale=function(t,e,i){t.setPriceAutoScale(e,i),this._invalidate(this._paneInvalidationMask(t,2))},t.prototype.resetPriceScale=function(t,e){t.resetPriceScale(e),this._invalidate(this._paneInvalidationMask(t,2))},t.prototype.startScaleTime=function(t){this._timeScale.startScale(t)},t.prototype.zoomTime=function(t,e){var i=this.timeScale();if(!i.isEmpty()&&0!==e){var r=i.width();t=Math.max(1,Math.min(t,r)),i.zoom(t,e),this.updateCrosshair(),this.recalculateAllPanes(),this.lightUpdate()}},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this._timeScale.scaleTo(t),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate()},t.prototype.endScaleTime=function(){this._timeScale.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this._initialTimeScrollPos=t,this._timeScale.startScroll(t)},t.prototype.scrollTimeTo=function(t){var e=!1;return null!==this._initialTimeScrollPos&&Math.abs(t-this._initialTimeScrollPos)>20&&(this._initialTimeScrollPos=null,e=!0),this._timeScale.scrollTo(t),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate(),e},t.prototype.endScrollTime=function(){this._timeScale.endScroll(),this.lightUpdate(),this._initialTimeScrollPos=null},t.prototype.resetTimeScale=function(){this._timeScale.restoreDefault(),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate()},t.prototype.invalidate=function(t){this._invalidateHandler&&this._invalidateHandler(t),this._grid.invalidate(),this.lightUpdate()},t.prototype.dataSources=function(){return this._panes.reduce(function(t,e){return t.concat(e.dataSources())},[])},t.prototype.serieses=function(){return this._serieses},t.prototype.setAndSaveCurrentPosition=function(t,e,i){this._crosshair.saveOriginCoord(t,e);var r=NaN,n=this._timeScale.coordinateToIndex(t),s=i.mainDataSource();if(null!==s){var o=i.defaultPriceScale();if(!o.isEmpty()){var a=z(s.firstValue());r=o.coordinateToPrice(e,a)}r=this._magnet.align(r,n,i)}this._crosshair.setPosition(n,r,i),this._cursorUpdate(),this._crosshairMoved.fire(this._crosshair.appliedIndex(),{x:t,y:e})},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this._cursorUpdate(),this._crosshairMoved.fire(null,null)},t.prototype.updateCrosshair=function(){var t=this._crosshair.pane();if(null!==t){var e=this._crosshair.originCoordX(),i=this._crosshair.originCoordY();this.setAndSaveCurrentPosition(e,i,t)}},t.prototype.updateTimeScale=function(t,e,i,r){r&&this._timeScale.reset(),this._timeScale.update(t,e,i)},t.prototype.updateTimeScaleBaseIndex=function(t){var e=this._serieses.reduce(function(t,e){var i=e.bars();if(i.isEmpty())return t;var r=z(i.lastIndex());return void 0===t?r:Math.max(r,t)},void 0);if(void 0!==e){var i=this._timeScale,r=i.baseIndex(),n=i.visibleBars();if(null!==n){var s=n.contains(r);if(void 0!==t&&t>0&&!s){var o=e-r;i.setRightOffset(i.rightOffset()-o)}}i.setBaseIndex(e)}this.updateCrosshair(),this.recalculateAllPanes(),this.lightUpdate()},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var e=this._panes.find(function(e){return e.orderedSources().includes(t)});return void 0===e?null:e},t.prototype.recalculateAllPanes=function(){this._panes.forEach(function(t){return t.recalculate()}),this.updateAllPaneViews()},t.prototype.destroy=function(){this._panes.forEach(function(t){return t.destroy()}),this._panes.length=0,this._options.localization.priceFormatter=void 0,this._options.localization.timeFormatter=void 0},t.prototype.setPriceAutoScaleForAllMainSources=function(){this._panes.map(function(t){return t.mainDataSource()}).forEach(function(t){null!==t&&z(t.priceScale()).setMode({autoScale:!0})})},t.prototype.rendererOptionsProvider=function(){return this._rendererOptionsProvider},t.prototype.priceAxisRendererOptions=function(){return this._rendererOptionsProvider.options()},t.prototype.mainPriceScaleOptionsChanged=function(){return this._mainPriceScaleOptionsChanged},t.prototype.mainPriceScale=function(){return this._panes[0].defaultPriceScale()},t.prototype.createSeries=function(t,e){var i=this._panes[0],r=this._createSeries(e,t,i);return this._serieses.push(r),this.lightUpdate(),r},t.prototype.removeSeries=function(t){var e=this.paneForSource(t),i=this._serieses.indexOf(t);O(-1!==i,"Series not found"),this._serieses.splice(i,1),z(e).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.fitContent=function(){var t=new $e(2);t.setFitContent(),this._invalidate(t)},t.prototype.setTargetTimeRange=function(t){var e=new $e(2);e.setTargetTimeRange(t),this._invalidate(e)},t.prototype._paneInvalidationMask=function(t,e){var i=new $e(e);if(null!==t){var r=this._panes.indexOf(t);i.invalidatePane(r,{level:e})}return i},t.prototype._invalidationMaskForSource=function(t,e){return void 0===e&&(e=2),this._paneInvalidationMask(this.paneForSource(t),e)},t.prototype._invalidate=function(t){this._invalidateHandler&&this._invalidateHandler(t),this._grid.invalidate()},t.prototype._cursorUpdate=function(){this._invalidate(new $e(1))},t.prototype._createSeries=function(t,e,i){var r=new De(this,t,e);return i.addDataSource(r,Boolean(t.overlay),!1),t.overlay&&r.applyOptions(t),r},t}(),Ci=function(){function t(t,e){this.w=t,this.h=e}return t.prototype.equals=function(t){return this.w===t.w&&this.h===t.h},t}();function Ti(t,e){t.width=e.w,t.height=e.h;var i=Ne(t);i&&i.translate(.5,.5)}function Mi(t,e,i,r,n,s){t.save(),t.translate(-.5,-.5),t.globalCompositeOperation="copy",t.fillStyle=s,t.fillRect(e,i,r,n),t.restore()}function Pi(t,e){var i=document.createElement("canvas");return t.appendChild(i),Ti(i,e),function(t){t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.MozUserSelect="none",t.style.webkitTapHighlightColor="transparent"}(i),i}var ki,Ei,Di=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||Boolean(window.DocumentTouch&&document instanceof window.DocumentTouch),Ri="onorientationchange"in window&&Di,Ii=/Android/i.test(navigator.userAgent),Ai=/iPhone|iPad|iPod|AppleWebKit.+Mobile/i.test(navigator.userAgent),Vi=Ii||Ai,Oi=!1;!function(t){t[t.ResetClick=500]="ResetClick",t[t.LongTap=240]="LongTap"}(ki||(ki={})),function(t){t[t.Left=0]="Left"}(Ei||(Ei={}));var Li=function(){function t(t,e,i){this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._target=t,this._handler=e,this._options=i,this._init()}return t.prototype.destroy=function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()},t.prototype._mouseEnterHandler=function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var i=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",i)},this._target.addEventListener("mousemove",i),Ri&&this._mouseMoveHandler(t);var r=this._makeCompatEvent(t);this._processEvent(r,this._handler.mouseEnterEvent)},t.prototype._resetClickTimeout=function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null},t.prototype._mouseMoveHandler=function(t){if(!Oi||Ri){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}},t.prototype._mouseMoveWithDownHandler=function(t){if(!("button"in t&&0!==t.button)&&null===this._startPinchMiddlePoint){var e=Wi(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;var i=this._makeCompatEvent(t),r=B(this._mouseMoveStartPosition),n=Math.abs(r.x-i.pageX),s=Math.abs(r.y-i.pageY),o=n+s>5;if(o||!e){if(o&&!this._moveExceededManhattanDistance&&e){var a=.5*n,h=s>=a&&!this._options.treatVertTouchDragAsPageScroll,l=a>s&&!this._options.treatHorzTouchDragAsPageScroll;h||l||(this._preventDragProcess=!0)}o&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(i,this._handler.pressedMouseMoveEvent),e&&Fi(t))}}}},t.prototype._mouseUpHandler=function(t){if(!("button"in t&&0!==t.button)){var e=this._makeCompatEvent(t),i=Ri||"touches"in t;i&&this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,Oi=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),i&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),"touchend"===t.type&&Fi(t),Ri&&this._mouseLeaveHandler(t)}},t.prototype._clearLongTapTimeout=function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)},t.prototype._mouseDownHandler=function(t){if(!("button"in t&&0!==t.button)){var e=this._makeCompatEvent(t);this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,Wi(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var i=this._mouseMoveWithDownHandler.bind(this),r=this._mouseUpHandler.bind(this),n=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){n.removeEventListener("touchmove",i),n.removeEventListener("touchend",r),n.removeEventListener("mousemove",i),n.removeEventListener("mouseup",r)},n.addEventListener("touchmove",i,{passive:!1}),n.addEventListener("touchend",r,{passive:!1}),Ri?(this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),240)):(n.addEventListener("mousemove",i),n.addEventListener("mouseup",r)),Oi=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}},t.prototype._init=function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e=this._target.ownerDocument,i=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){e.removeEventListener("mousedown",i),e.removeEventListener("touchstart",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",i),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this)),Ri||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",function(){},{passive:!1})},t.prototype._initPinch=function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",function(e){t._checkPinchState(e.touches)}),this._target.addEventListener("touchmove",function(e){if(2===e.touches.length&&null!==t._startPinchMiddlePoint&&void 0!==t._handler.pinchEvent){var i=Bi(e.touches[0],e.touches[1])/t._startPinchDistance;t._handler.pinchEvent(t._startPinchMiddlePoint,i),Fi(e)}},{passive:!1}),this._target.addEventListener("touchend",function(e){t._checkPinchState(e.touches)}))},t.prototype._checkPinchState=function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented?this._stopPinch():this._startPinch(t)},t.prototype._startPinch=function(t){var e=zi(this._target);this._startPinchMiddlePoint={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=Bi(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()},t.prototype._stopPinch=function(){null!==this._startPinchMiddlePoint&&(this._startPinchMiddlePoint=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())},t.prototype._mouseLeaveHandler=function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)},t.prototype._longTapHandler=function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0},t.prototype._processEvent=function(t,e){e&&e.call(this._handler,t)},t.prototype._makeCompatEvent=function(t){var e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var i=zi(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-i.left,localY:e.clientY-i.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?"mouse":"touch",target:e.target,view:t.view}},t}();function zi(t){return t.getBoundingClientRect()||{left:0,top:0}}function Bi(t,e){var i=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(i*i+r*r)}function Wi(t){return Ri||Boolean(t.touches)}function Fi(t){t.cancelable&&t.preventDefault()}var Ni,Hi=1,Ui=function(){function t(t,e,i,r){if(this._startY=0,this._deltaY=0,this._totalHeight=0,this._totalStretch=0,this._minPaneHeight=0,this._maxPaneHeight=0,this._pixelStretchFactor=0,this._chartWidget=t,this._paneA=t.paneWidgets()[e],this._paneB=t.paneWidgets()[i],this._rowElement=document.createElement("tr"),this._rowElement.style.height=Hi+"px",this._cell=document.createElement("td"),this._cell.style.padding="0",this._cell.setAttribute("colspan","3"),this._updateBorderColor(),this._rowElement.appendChild(this._cell),r)this._handle=null,this._mouseEventHandler=null;else{this._handle=document.createElement("div"),this._handle.style.position="absolute",this._handle.style.zIndex="50",this._handle.style.height="5px",this._handle.style.width="100%",this._handle.style.backgroundColor="rgba(255, 255, 255, 0.02)",this._handle.style.cursor="ns-resize",this._cell.appendChild(this._handle);var n={mouseDownEvent:this._mouseDownEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this)};this._mouseEventHandler=new Li(this._handle,n,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}}return t.prototype.destroy=function(){null!==this._mouseEventHandler&&this._mouseEventHandler.destroy()},t.prototype.getElement=function(){return this._rowElement},t.prototype.getImage=function(){var t=document.createElement("canvas"),e=this._paneA.getSize().w,i=Hi;Ti(t,new Ci(e,i));var r=z(Ne(t));return r.fillStyle=this._chartWidget.options().timeScale.borderColor,r.fillRect(0,0,e,i),t},t.prototype.update=function(){this._updateBorderColor()},t.prototype._updateBorderColor=function(){this._cell.style.background=this._chartWidget.options().timeScale.borderColor},t.prototype._mouseDownEvent=function(t){this._startY=t.pageY,this._deltaY=0,this._totalHeight=this._paneA.getSize().h+this._paneB.getSize().h,this._totalStretch=this._paneA.stretchFactor()+this._paneB.stretchFactor(),this._minPaneHeight=30,this._maxPaneHeight=this._totalHeight-this._minPaneHeight,this._pixelStretchFactor=this._totalStretch/this._totalHeight},t.prototype._pressedMouseMoveEvent=function(t){this._deltaY=t.pageY-this._startY;var e=this._paneA.getSize().h,i=Et(e+this._deltaY,this._minPaneHeight,this._maxPaneHeight)*this._pixelStretchFactor,r=this._totalStretch-i;this._paneA.setStretchFactor(i),this._paneB.setStretchFactor(r),this._chartWidget.adjustSize(),this._paneA.getSize().h!==e&&(this._startY=t.pageY)},t.prototype._mouseUpEvent=function(t){this._startY=0,this._deltaY=0,this._totalHeight=0,this._totalStretch=0,this._minPaneHeight=0,this._maxPaneHeight=0,this._pixelStretchFactor=0},t}(),Yi=200,ji=function(){function t(t,e,i,r){this._textWidthCache=new ue(Yi),this._fontSize=0,this._color="",this._font="",this._keys=[],this._hash=new Map,this._fontSize=t,this._color=e,this._font=je(t,i,r)}return t.prototype.destroy=function(){delete this._textWidthCache,this._keys=[],this._hash.clear()},t.prototype.paintTo=function(t,e,i,r,n){var s=this.getLabelImage(t,e);"left"!==n&&(i-=s.textWidth),r-=Math.floor(s.height/2),t.drawImage(s.canvas,i,r)},t.prototype.getLabelImage=function(t,e){var i;if(this._hash.has(e))i=L(this._hash.get(e));else{if(this._keys.length>=Yi){var r=L(this._keys.shift());this._hash.delete(r)}i={text:e,textWidth:0,width:0,height:0,canvas:document.createElement("canvas")};var n=Math.ceil(this._fontSize/4.5),s=Math.round(this._fontSize/10),o=Math.ceil(this._textWidthCache.measureText(t,e));i.textWidth=Math.round(Math.max(1,o)),i.width=Math.round(o+2*n),i.height=this._fontSize+2*n,0!==o&&(this._keys.push(i.text),this._hash.set(i.text,i)),i.canvas.width=i.width,i.canvas.height=i.height,(t=z(Ne(i.canvas))).font=this._font,t.fillStyle=this._color,t.fillText(e,0,i.height-n-s)}return i},t}();!function(t){t[t.Default=0]="Default",t[t.NsResize=1]="NsResize"}(Ni||(Ni={}));var Xi,qi,Gi=function(){function t(t,e,i,r){this._priceScale=null,this._size=null,this._updateTimeout=null,this._mousedown=!1,this._isVisible=!0,this._widthCache=new ue(50),this._tickMarksCache=new ji(11,"#000"),this._color=null,this._font=null,this._prevOptimalWidth=0,this._pane=t,this._options=e,this._rendererOptionsProvider=i,this._isLeft="left"===r,this._cell=document.createElement("div"),this._cell.style.height="100%",this._cell.style.overflow="hidden",this._cell.style.width="25px",this._cell.style.left="0",this._cell.style.position="relative",this._canvas=Pi(this._cell,new Ci(16,16)),this._canvas.style.position="absolute",this._canvas.style.zIndex="1",this._canvas.style.left="0",this._canvas.style.top="0",this._ctx=z(Ne(this._canvas)),this._topCanvas=Pi(this._cell,new Ci(16,16)),this._topCanvas.style.position="absolute",this._topCanvas.style.zIndex="2",this._topCanvas.style.left="0",this._topCanvas.style.top="0",this._topCtx=z(Ne(this._topCanvas));var n={mouseDownEvent:this._mouseDownEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseDownOutsideEvent:this._mouseDownOutsideEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseDoubleClickEvent:this._mouseDoubleClickEvent.bind(this),mouseEnterEvent:this._mouseEnterEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this)};this._mouseEventHandler=new Li(this._topCanvas,n,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}return t.prototype.destroy=function(){this._mouseEventHandler.destroy(),null!==this._priceScale&&(this._priceScale.onMarksChanged().unsubscribeAll(this),this._priceScale.optionsChanged().unsubscribeAll(this)),this._priceScale=null,null!==this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=null),this._tickMarksCache.destroy()},t.prototype.getElement=function(){return this._cell},t.prototype.backgroundColor=function(){return this._options.backgroundColor},t.prototype.lineColor=function(){return this._pane.chart().options().priceScale.borderColor},t.prototype.textColor=function(){return this._options.textColor},t.prototype.fontSize=function(){return this._options.fontSize},t.prototype.baseFont=function(){return je(this.fontSize(),this._options.fontFamily)},t.prototype.rendererOptions=function(){var t=this._rendererOptionsProvider.options(),e=this._color!==t.color,i=this._font!==t.font;return(e||i)&&(this._recreateTickMarksCache(t),this._color=t.color),i&&(this._widthCache.reset(),this._font=t.font),t},t.prototype.optimalWidth=function(){if(!this.isVisible()||null===this._priceScale)return 0;var t=34,e=this.rendererOptions(),i=this._ctx,r=this._priceScale.marks();i.font=this.baseFont(),r.length>0&&(t=Math.max(this._widthCache.measureText(i,r[0].label),this._widthCache.measureText(i,r[r.length-1].label)));for(var n=this._backLabels(),s=n.length;s--;){var o=this._widthCache.measureText(i,n[s].text());o>t&&(t=o)}return Math.ceil(e.offsetSize+e.borderSize+e.tickLength+e.paddingInner+e.paddingOuter+t)},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this._size&&this._size.equals(t)||(this._size=t,Ti(this._canvas,t),Ti(this._topCanvas,t),this._cell.style.width=t.w+"px",this._cell.style.height=t.h+"px",this._cell.style.minWidth=t.w+"px")},t.prototype.getWidth=function(){return z(this._size).w},t.prototype.setPriceScale=function(t){this._priceScale!==t&&(null!==this._priceScale&&(this._priceScale.onMarksChanged().unsubscribeAll(this),this._priceScale.optionsChanged().unsubscribeAll(this)),this._priceScale=t,t.onMarksChanged().subscribe(this._onMarksChanged.bind(this),this))},t.prototype.priceScale=function(){return this._priceScale},t.prototype.isVisible=function(){return this._isVisible},t.prototype.setVisible=function(t){t!==this._isVisible&&(this._cell.style.display=t?"table-cell":"none",this._isVisible=t)},t.prototype.setAutoScale=function(t){var e=this._pane.state();this._pane.chart().model().setPriceAutoScale(e,z(this.priceScale()),t)},t.prototype.reset=function(){var t=this._pane.state();this._pane.chart().model().resetPriceScale(t,z(this.priceScale()))},t.prototype.paint=function(t){this._isVisible&&null!==this._size&&(this._topCtx.clearRect(-.5,-.5,this._size.w,this._size.h),1!==t&&(this._alignLabels(),this._drawBackground(this._ctx),this._drawBorder(this._ctx),this._drawTickMarks(this._ctx),this._drawBackLabels(this._ctx)),this._drawCrosshairLabel(this._topCtx))},t.prototype.getImage=function(){return this._canvas},t.prototype.isLeft=function(){return this._isLeft},t.prototype._mouseDownEvent=function(t){if(null!==this._priceScale&&!this._priceScale.isEmpty()&&this._pane.chart().options().handleScale.axisPressedMouseMove){var e=this._pane.chart().model(),i=this._pane.state();this._mousedown=!0,e.startScalePrice(i,this._priceScale,t.localY)}},t.prototype._pressedMouseMoveEvent=function(t){if(null!==this._priceScale&&this._pane.chart().options().handleScale.axisPressedMouseMove){var e=this._pane.chart().model(),i=this._pane.state(),r=this._priceScale;e.scalePriceTo(i,r,t.localY)}},t.prototype._mouseDownOutsideEvent=function(){if(null!==this._priceScale&&this._pane.chart().options().handleScale.axisPressedMouseMove){var t=this._pane.chart().model(),e=this._pane.state(),i=this._priceScale;this._mousedown&&(this._mousedown=!1,t.endScalePrice(e,i))}},t.prototype._mouseUpEvent=function(t){if(null!==this._priceScale&&this._pane.chart().options().handleScale.axisPressedMouseMove){var e=this._pane.chart().model(),i=this._pane.state();this._mousedown=!1,e.endScalePrice(i,this._priceScale)}},t.prototype._mouseDoubleClickEvent=function(t){this.reset()},t.prototype._mouseEnterEvent=function(t){null!==this._priceScale&&(!this._pane.chart().model().options().handleScale.axisPressedMouseMove||this._priceScale.isPercentage()||this._priceScale.isIndexedTo100()||this._setCursor(1))},t.prototype._mouseLeaveEvent=function(t){this._setCursor(0)},t.prototype._backLabels=function(){var t=this,e=[],i=null===this._priceScale?void 0:this._priceScale;return function(r){for(var n=0;n<r.length;++n)for(var s=r[n].priceAxisViews(t._pane.state(),i),o=0;o<s.length;o++)e.push(s[o])}(this._pane.state().orderedSources()),e},t.prototype._drawBackground=function(t){null!==this._size&&Mi(t,0,0,this._size.w,this._size.h,this.backgroundColor())},t.prototype._drawBorder=function(t){if(null!==this._size&&null!==this._priceScale&&this._priceScale.options().borderVisible){t.save(),t.fillStyle=this.lineColor();var e,i=this.rendererOptions().borderSize;this._isLeft?(t.translate(-.5,-.5),e=this._size.w-i-1):(t.translate(.5,-.5),e=0),t.fillRect(e,0,i,this._size.h),t.restore()}},t.prototype._drawTickMarks=function(t){if(null!==this._size&&null!==this._priceScale){t.save(),t.strokeStyle=this.lineColor();var e=this._priceScale.marks();t.font=this.baseFont(),t.translate(-.5,-.5),t.fillStyle=this.lineColor();var i=this.rendererOptions(),r=this._priceScale.options().borderVisible,n=this._isLeft?this._size.w-i.offsetSize-i.borderSize-i.tickLength:i.borderSize+i.offsetSize,s=this._isLeft?n-i.paddingInner:n+i.tickLength+i.paddingInner,o=this._isLeft?"right":"left";if(r){t.beginPath();for(var a=0,h=e;a<h.length;a++){var l=h[a];t.rect(n,l.coord,i.tickLength,1)}t.fill()}t.fillStyle=this.textColor();for(var c=0,u=e;c<u.length;c++)l=u[c],this._tickMarksCache.paintTo(t,l.label,s,l.coord,o);t.restore()}},t.prototype._alignLabels=function(){if(null!==this._size&&null!==this._priceScale){var t=this._size.h/2,e=[],i=this._priceScale.orderedSources().slice(),r=this._pane.state(),n=this.rendererOptions();this._priceScale===r.defaultPriceScale()&&this._pane.state().orderedSources().forEach(function(t){r.isOverlay(t)&&i.push(t)});var s=this._priceScale.mainSource(),o=this._priceScale;i.forEach(function(i){var n=i.priceAxisViews(r,o);n.forEach(function(t){t.setFixedCoordinate(null),t.isVisible()&&e.push(t)}),s===i&&n.length>0&&(t=n[0].floatCoordinate())});var a=e.filter(function(e){return e.floatCoordinate()<=t}),h=e.filter(function(e){return e.floatCoordinate()>t});if(a.sort(function(t,e){return e.floatCoordinate()-t.floatCoordinate()}),a.length&&h.length&&h.push(a[0]),h.sort(function(t,e){return t.floatCoordinate()-e.floatCoordinate()}),e.forEach(function(t){return t.setFixedCoordinate(t.coordinate())}),this._priceScale.options().alignLabels){for(var l=1;l<a.length;l++){var c=a[l],u=(d=a[l-1]).height(n,!1);c.coordinate()>(_=d.getFixedCoordinate())-u&&c.setFixedCoordinate(_-u)}for(var p=1;p<h.length;p++){var d,_;c=h[p],u=(d=h[p-1]).height(n,!0),c.coordinate()<(_=d.getFixedCoordinate())+u&&c.setFixedCoordinate(_+u)}}}},t.prototype._drawBackLabels=function(t){var e=this;if(null!==this._size){var i=this._size,r=this._backLabels(),n=this.rendererOptions(),s=this._isLeft?"right":"left";r.forEach(function(r){if(r.isAxisLabelVisible()){var o=r.renderer();t.save(),o.draw(t,n,e._widthCache,i.w,s),t.restore()}})}},t.prototype._drawCrosshairLabel=function(t){var e=this;if(null!==this._size&&null!==this._priceScale){var i=this._size,r=this._pane.chart().model(),n=[],s=this._pane.state(),o=r.crosshairSource().priceAxisViews(s,this._priceScale);o.length&&n.push(o);var a=this.rendererOptions(),h=this._isLeft?"right":"left";n.forEach(function(r){r.forEach(function(r){t.save(),r.renderer().draw(t,a,e._widthCache,i.w,h),t.restore()})})}},t.prototype._setCursor=function(t){this._cell.style.cursor=1===t?"ns-resize":"default"},t.prototype._onMarksChanged=function(){var t=this,e=this.optimalWidth();if(this._prevOptimalWidth<e){var i=this._pane.chart();null===this._updateTimeout&&(this._updateTimeout=setTimeout(function(){i&&i.model().fullUpdate(),t._updateTimeout=null},100))}this._prevOptimalWidth=e},t.prototype._recreateTickMarksCache=function(t){this._tickMarksCache.destroy(),this._tickMarksCache=new ji(t.fontSize,t.color,t.fontFamily)},t}(),Zi=Vi,Ki=function(){function t(t,e){this._size=new Ci(0,0),this._priceAxisWidget=null,this._startScrollingPos=null,this._isScrolling=!1,this._priceAxisPosition="none",this._clicked=new Mt,this._prevPinchScale=0,this._longTap=!1,this._startTrackPoint=null,this._exitTrackingModeOnNextTry=!1,this._initCrosshairPosition=null,this._chart=t,this._state=e,this._state.onDestroyed().subscribe(this._onStateDestroyed.bind(this),this,!0),this._paneCell=document.createElement("td"),this._paneCell.style.padding="0",this._paneCell.style.position="relative";var i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="relative",i.style.overflow="hidden",this._leftAxisCell=document.createElement("td"),this._leftAxisCell.style.padding="0",this._rightAxisCell=document.createElement("td"),this._rightAxisCell.style.padding="0",this._paneCell.appendChild(i),this._canvas=Pi(i,new Ci(16,16)),this._canvas.style.position="absolute",this._canvas.style.zIndex="1",this._canvas.style.left="0",this._canvas.style.top="0",this._ctx=z(Ne(this._canvas)),this._topCanvas=Pi(i,new Ci(16,16)),this._topCanvas.style.position="absolute",this._topCanvas.style.zIndex="2",this._topCanvas.style.left="0",this._topCanvas.style.top="0",this._topCtx=z(Ne(this._topCanvas)),this._rowElement=document.createElement("tr"),this._rowElement.appendChild(this._leftAxisCell),this._rowElement.appendChild(this._paneCell),this._rowElement.appendChild(this._rightAxisCell),this._recreatePriceAxisWidgetImpl(),t.model().mainPriceScaleOptionsChanged().subscribe(this._recreatePriceAxisWidget.bind(this),this),this.updatePriceAxisWidget();var r=this.chart().options().handleScroll;this._mouseEventHandler=new Li(this._topCanvas,this,{treatVertTouchDragAsPageScroll:!r.vertTouchDrag,treatHorzTouchDragAsPageScroll:!r.horzTouchDrag})}return t.prototype.destroy=function(){null!==this._priceAxisWidget&&this._priceAxisWidget.destroy(),null!==this._state&&this._state.onDestroyed().unsubscribeAll(this),this._mouseEventHandler.destroy()},t.prototype.state=function(){return z(this._state)},t.prototype.stateOrNull=function(){return this._state},t.prototype.setState=function(e){null!==this._state&&this._state.onDestroyed().unsubscribeAll(this),this._state=e,null!==this._state&&this._state.onDestroyed().subscribe(t.prototype._onStateDestroyed.bind(this),this,!0),this.updatePriceAxisWidget()},t.prototype.chart=function(){return this._chart},t.prototype.getElement=function(){return this._rowElement},t.prototype.updatePriceAxisWidget=function(){if(null!==this._state&&null!==this._priceAxisWidget&&0!==this._model().serieses().length){var t=this._state.defaultPriceScale();this._priceAxisWidget.setPriceScale(z(t))}},t.prototype.stretchFactor=function(){return null!==this._state?this._state.stretchFactor():0},t.prototype.setStretchFactor=function(t){this._state&&this._state.setStretchFactor(t)},t.prototype.mouseEnterEvent=function(t){if(this._state){var e=t.localX,i=t.localY;Ri||this._setCrosshairPosition(e,i)}},t.prototype.mouseDownEvent=function(t){if(this._longTap=!1,this._exitTrackingModeOnNextTry=null!==this._startTrackPoint,this._state){if(document.activeElement!==document.body&&document.activeElement!==document.documentElement)z(document.activeElement).blur();else{var e=document.getSelection();null!==e&&e.removeAllRanges()}var i=this._model();if(!this._state.defaultPriceScale().isEmpty()&&!i.timeScale().isEmpty()){if(null!==this._startTrackPoint){var r=i.crosshairSource();this._initCrosshairPosition={x:r.appliedX(),y:r.appliedY()},this._startTrackPoint={x:t.localX,y:t.localY}}Ri||this._setCrosshairPosition(t.localX,t.localY)}}},t.prototype.mouseMoveEvent=function(t){if(this._state){var e=t.localX,i=t.localY;if(this._preventCrosshairMove()&&this._clearCrosshairPosition(),!Ri){this._setCrosshairPosition(e,i);var r=this.hitTest(e,i);this._model().setHoveredSource(r&&r.source),null!==r&&void 0!==r.view.moveHandler&&r.view.moveHandler(e,i)}}},t.prototype.mouseClickEvent=function(t){if(null!==this._state){var e=t.localX,i=t.localY,r=this.hitTest(e,i);if(null!==r&&void 0!==r.view.clickHandler&&r.view.clickHandler(e,i),this._clicked.hasListeners()){var n=this._model().crosshairSource().appliedIndex();this._clicked.fire(n,{x:e,y:i})}this._tryExitTrackingMode()}},t.prototype.pressedMouseMoveEvent=function(t){if(null!==this._state){var e=this._model(),i=t.localX,r=t.localY;if(null!==this._startTrackPoint){this._exitTrackingModeOnNextTry=!1;var n=z(this._initCrosshairPosition),s=n.x+(i-this._startTrackPoint.x),o=n.y+(r-this._startTrackPoint.y);this._setCrosshairPosition(s,o)}else this._preventCrosshairMove()||this._setCrosshairPosition(i,r);if(!e.timeScale().isEmpty()){var a=this._chart.options().handleScroll;if(a.pressedMouseMove&&"touch"!==t.type||(a.horzTouchDrag||a.vertTouchDrag)&&"mouse"!==t.type){var h=this._state.defaultPriceScale();null!==this._startScrollingPos||this._preventScroll()||(this._startScrollingPos={x:t.clientX,y:t.clientY}),null===this._startScrollingPos||this._startScrollingPos.x===t.clientX&&this._startScrollingPos.y===t.clientY||this._isScrolling||(h.isEmpty()||e.startScrollPrice(this._state,h,t.localY),e.startScrollTime(t.localX),this._isScrolling=!0),this._isScrolling&&(h.isEmpty()||e.scrollPriceTo(this._state,h,t.localY),e.scrollTimeTo(t.localX))}}}},t.prototype.mouseUpEvent=function(t){if(null!==this._state){this._longTap=!1;var e=this._model();if(this._isScrolling){var i=this._state.defaultPriceScale();e.endScrollPrice(this._state,i),e.endScrollTime(),this._startScrollingPos=null,this._isScrolling=!1}}},t.prototype.longTapEvent=function(t){if(this._longTap=!0,null===this._startTrackPoint&&Zi){var e={x:t.localX,y:t.localY};this._startTrackingMode(e,e)}},t.prototype.mouseLeaveEvent=function(t){null!==this._state&&(this._state.model().setHoveredSource(null),Vi||this._clearCrosshairPosition())},t.prototype.clicked=function(){return this._clicked},t.prototype.pinchStartEvent=function(){this._prevPinchScale=1},t.prototype.pinchEvent=function(t,e){if(this._chart.options().handleScale.pinch){var i=5*(e-this._prevPinchScale);this._prevPinchScale=e,this._model().zoomTime(t.x,i)}},t.prototype.hitTest=function(t,e){var i=this._state;if(null===i)return null;for(var r=0,n=i.orderedSources();r<n.length;r++){var s=n[r],o=this._hitTestPaneView(s.paneViews(i),t,e);if(null!==o)return{source:s,view:o}}return null},t.prototype.setPriceAxisSize=function(t){z(this._priceAxisWidget).setSize(new Ci(t,this._size.h))},t.prototype.getSize=function(){return this._size},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this._size.equals(t)||(this._size=t,Ti(this._canvas,t),Ti(this._topCanvas,t),this._ctx=z(Ne(this._canvas)),this._paneCell.style.width=t.w+"px",this._paneCell.style.height=t.h+"px")},t.prototype.recalculatePriceScale=function(){var t=z(this._state);t.recalculatePriceScale(t.defaultPriceScale());for(var e=0,i=t.dataSources();e<i.length;e++){var r=i[e];if(t.isOverlay(r)){var n=r.priceScale();null!==n&&t.recalculatePriceScale(n),r.updateAllViews()}}},t.prototype.getImage=function(){return this._canvas},t.prototype.paint=function(t){0!==t&&null!==this._state&&(t>1&&this.recalculatePriceScale(),null!==this._priceAxisWidget&&this._priceAxisWidget.paint(t),this._topCtx.clearRect(-.5,-.5,this._size.w,this._size.h),1!==t&&(this._drawBackground(this._ctx,this._backgroundColor()),this._state&&(this._drawGrid(this._ctx),this._drawWatermark(this._ctx),this._drawSources(this._ctx))),this._drawCrosshair(this._topCtx))},t.prototype.priceAxisWidget=function(){return this._priceAxisWidget},t.prototype._backgroundColor=function(){return this._chart.options().layout.backgroundColor},t.prototype._onStateDestroyed=function(){null!==this._state&&this._state.onDestroyed().unsubscribeAll(this),this._state=null},t.prototype._drawBackground=function(t,e){Mi(t,0,0,this._size.w,this._size.h,e)},t.prototype._drawGrid=function(t){for(var e=z(this._state),i=this._model().gridSource().paneViews(e),r=e.height(),n=e.width(),s=0,o=i;s<o.length;s++){var a=o[s];t.save();var h=a.renderer(r,n);null!==h&&h.draw(t,!1),t.restore()}},t.prototype._drawWatermark=function(t){var e=this._model().watermarkSource();if(null!==e){var i=z(this._state);if(i.containsSeries())for(var r=e.paneViews(),n=i.height(),s=i.width(),o=0,a=r;o<a.length;o++){var h=a[o];t.save();var l=h.renderer(n,s);null!==l&&l.draw(t,!1),t.restore()}}},t.prototype._drawCrosshair=function(t){this._drawSource(this._model().crosshairSource(),t)},t.prototype._drawSources=function(t){for(var e=z(this._state).orderedSources(),i=this._model().crosshairSource(),r=0,n=e;r<n.length;r++){var s=n[r];this._drawSourceBackground(s,t)}for(var o=0,a=e;o<a.length;o++)(s=a[o])!==i&&this._drawSource(s,t)},t.prototype._drawSource=function(t,e){for(var i=z(this._state),r=t.paneViews(i),n=i.height(),s=i.width(),o=i.model().hoveredSource()===t,a=0,h=r;a<h.length;a++){var l=h[a].renderer(n,s);null!==l&&(e.save(),l.draw(e,o),e.restore())}},t.prototype._drawSourceBackground=function(t,e){for(var i=z(this._state),r=t.paneViews(i),n=i.height(),s=i.width(),o=i.model().hoveredSource()===t,a=0,h=r;a<h.length;a++){var l=h[a].renderer(n,s);null!==l&&void 0!==l.drawBackground&&(e.save(),l.drawBackground(e,o),e.restore())}},t.prototype._hitTestPaneView=function(t,e,i){for(var r=0,n=t;r<n.length;r++){var s=n[r],o=s.renderer(this._size.h,this._size.w);if(null!==o&&o.hitTest&&o.hitTest(e,i))return s}return null},t.prototype._recreatePriceAxisWidget=function(){this._recreatePriceAxisWidgetImpl(),this._chart.adjustSize()},t.prototype._recreatePriceAxisWidgetImpl=function(){if(null!==this._state){var t=this._chart,e=this._state.defaultPriceScale().options().position;if(this._priceAxisPosition!==e){if(null!==this._priceAxisWidget&&(this._priceAxisWidget.isLeft()?this._leftAxisCell.removeChild(this._priceAxisWidget.getElement()):this._rightAxisCell.removeChild(this._priceAxisWidget.getElement()),this._priceAxisWidget.destroy(),this._priceAxisWidget=null),"none"!==e){var i=t.model().rendererOptionsProvider();this._priceAxisWidget=new Gi(this,t.options().layout,i,e),"left"===e&&this._leftAxisCell.appendChild(this._priceAxisWidget.getElement()),"right"===e&&this._rightAxisCell.appendChild(this._priceAxisWidget.getElement())}this._priceAxisPosition=e}}},t.prototype._preventCrosshairMove=function(){return Zi&&null===this._startTrackPoint},t.prototype._preventScroll=function(){return Zi&&this._longTap||null!==this._startTrackPoint},t.prototype._correctXCoord=function(t){return Math.max(0,Math.min(t,this._size.w-1))},t.prototype._correctYCoord=function(t){return Math.max(0,Math.min(t,this._size.h-1))},t.prototype._setCrosshairPosition=function(t,e){this._model().setAndSaveCurrentPosition(this._correctXCoord(t),this._correctYCoord(e),z(this._state))},t.prototype._clearCrosshairPosition=function(){this._model().clearCurrentPosition()},t.prototype._tryExitTrackingMode=function(){this._exitTrackingModeOnNextTry&&(this._startTrackPoint=null,this._clearCrosshairPosition())},t.prototype._startTrackingMode=function(t,e){this._startTrackPoint=t,this._exitTrackingModeOnNextTry=!1,this._setCrosshairPosition(e.x,e.y);var i=this._model().crosshairSource();this._initCrosshairPosition={x:i.appliedX(),y:i.appliedY()}},t.prototype._model=function(){return this._chart.model()},t}(),$i=function(){function t(t,e,i,r){this._invalidated=!0,this._size=new Ci(0,0),this._isLeft="left"===t,this._rendererOptionsProvider=i.rendererOptionsProvider,this._options=e,this._borderVisible=r,this._cell=document.createElement("div"),this._cell.style.width="25px",this._cell.style.height="100%",this._cell.style.overflow="hidden",this._canvas=Pi(this._cell,new Ci(16,16)),this._ctx=Ne(this._canvas)}return t.prototype.destroy=function(){},t.prototype.update=function(){this._invalidated=!0},t.prototype.getElement=function(){return this._cell},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this._size.equals(t)||(this._size=t,Ti(this._canvas,t),this._cell.style.width=t.w+"px",this._cell.style.minWidth=t.w+"px",this._cell.style.height=t.h+"px",this._invalidated=!0)},t.prototype.paint=function(t){t<3&&!this._invalidated||0!==this._size.w&&0!==this._size.h&&(this._invalidated=!1,this._drawBackground(),this._drawBorder())},t.prototype.getImage=function(){return this._canvas},t.prototype.getWidth=function(){return this._size.w},t.prototype.isLeft=function(){return this._isLeft},t.prototype._drawBorder=function(){if(this._borderVisible()){var t=this._size.w;this._ctx.save(),this._ctx.fillStyle=this._options.timeScale.borderColor;var e,i=this._rendererOptionsProvider.options().borderSize;this._isLeft?(this._ctx.translate(-.5,-.5),e=t-i-1):(this._ctx.translate(-.5,-.5),e=0),this._ctx.fillRect(e,0,2*i,1),this._ctx.restore()}},t.prototype._drawBackground=function(){Mi(this._ctx,0,0,this._size.w,this._size.h,this._options.layout.backgroundColor)},t}();function Ji(t,e){return t.span>e.span?t:e}!function(t){t[t.BorderSize=1]="BorderSize",t[t.TickLength=3]="TickLength"}(Xi||(Xi={})),function(t){t[t.Default=0]="Default",t[t.EwResize=1]="EwResize"}(qi||(qi={}));var Qi,tr=function(){function t(t){this._stub=null,this._minVisibleSpan=70,this._rendererOptions=null,this._mouseDown=!1,this._size=new Ci(0,0),this._priceAxisPosition="none",this._chart=t,this._options=t.options().layout,this._element=document.createElement("tr"),this._leftStubCell=document.createElement("td"),this._leftStubCell.style.padding="0",this._rightStubCell=document.createElement("td"),this._rightStubCell.style.padding="0",this._cell=document.createElement("td"),this._cell.style.height="25px",this._cell.style.padding="0",this._dv=document.createElement("div"),this._dv.style.width="100%",this._dv.style.height="100%",this._dv.style.position="relative",this._dv.style.overflow="hidden",this._cell.appendChild(this._dv),this._canvas=Pi(this._dv,new Ci(16,16)),this._canvas.style.position="absolute",this._canvas.style.zIndex="1",this._canvas.style.left="0",this._canvas.style.top="0",this._canvasContext=z(Ne(this._canvas)),this._topCanvas=Pi(this._dv,new Ci(16,16)),this._topCanvas.style.position="absolute",this._topCanvas.style.zIndex="2",this._topCanvas.style.left="0",this._topCanvas.style.top="0",this._topCanvasContext=z(Ne(this._topCanvas)),this._element.appendChild(this._leftStubCell),this._element.appendChild(this._cell),this._element.appendChild(this._rightStubCell),this._recreateStub(),this._chart.model().mainPriceScaleOptionsChanged().subscribe(this._recreateStub.bind(this),this),this._mouseEventHandler=new Li(this._topCanvas,this,{treatVertTouchDragAsPageScroll:!0,treatHorzTouchDragAsPageScroll:!1})}return t.prototype.destroy=function(){this._mouseEventHandler.destroy(),null!==this._stub&&this._stub.destroy()},t.prototype.getElement=function(){return this._element},t.prototype.stub=function(){return this._stub},t.prototype.mouseDownEvent=function(t){if(!this._mouseDown){this._mouseDown=!0;var e=this._chart.model();!e.timeScale().isEmpty()&&this._chart.options().handleScale.axisPressedMouseMove&&e.startScaleTime(t.localX)}},t.prototype.mouseDownOutsideEvent=function(){var t=this._chart.model();!t.timeScale().isEmpty()&&this._mouseDown&&(this._mouseDown=!1,this._chart.options().handleScale.axisPressedMouseMove&&t.endScaleTime())},t.prototype.pressedMouseMoveEvent=function(t){var e=this._chart.model();!e.timeScale().isEmpty()&&this._chart.options().handleScale.axisPressedMouseMove&&e.scaleTimeTo(t.localX)},t.prototype.mouseUpEvent=function(t){this._mouseDown=!1;var e=this._chart.model();e.timeScale().isEmpty()&&!this._chart.options().handleScale.axisPressedMouseMove||e.endScaleTime()},t.prototype.mouseDoubleClickEvent=function(){this._chart.model().resetTimeScale()},t.prototype.mouseEnterEvent=function(t){this._chart.model().options().handleScale.axisPressedMouseMove&&this._setCursor(1)},t.prototype.mouseLeaveEvent=function(t){this._setCursor(0)},t.prototype.setSizes=function(t,e){this._size&&this._size.equals(t)||(this._size=t,Ti(this._canvas,t),Ti(this._topCanvas,t),Ne(this._canvas),Ne(this._topCanvas),this._cell.style.width=t.w+"px",this._cell.style.height=t.h+"px"),null!==this._stub&&this._stub.setSize(new Ci(e,t.h))},t.prototype.width=function(){return this._size.w},t.prototype.height=function(){return this._size.h},t.prototype.optimalHeight=function(){var t=this._getRendererOptions();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.update=function(){var t=this,e=this._chart.model().timeScale().marks();e&&(this._minVisibleSpan=70,e.forEach(function(e){t._minVisibleSpan=Math.min(e.span,t._minVisibleSpan)}))},t.prototype.getImage=function(){return this._canvas},t.prototype.paint=function(t){if(0!==t){if(1!==t){var e=this._canvasContext;this._drawBackground(e),this._drawBorder(e),this._drawTickMarks(e),this._drawBackLabels(e),null!==this._stub&&this._stub.paint(t)}this._drawCrosshairLabel(this._topCanvasContext)}},t.prototype._drawBackground=function(t){Mi(t,0,0,this._size.w,this._size.h,this._backgroundColor())},t.prototype._drawBorder=function(t){this._chart.options().timeScale.borderVisible&&(t.save(),t.fillStyle=this._lineColor(),t.translate(-.5,-.5),t.fillRect(0,0,this._size.w,1),t.restore())},t.prototype._drawTickMarks=function(t){var e=this._chart.model().timeScale().marks();if(e&&0!==e.length){var i=e.reduce(Ji,e[0]).span;i>30&&i<40&&(i=30),t.save(),t.strokeStyle=this._lineColor();var r=this._getRendererOptions(),n=r.borderSize+r.tickLength+r.paddingTop+r.fontSize-r.baselineOffset;if(t.textAlign="center",t.translate(.5,-.5),t.fillStyle=this._lineColor(),this._chart.model().timeScale().options().borderVisible){t.beginPath();for(var s=e.length;s--;)t.rect(e[s].coord,1,1,r.tickLength);t.fill()}t.fillStyle=this._textColor(),t.font=this._baseFont();for(var o=0,a=e;o<a.length;o++)(c=a[o]).span<i&&t.fillText(c.label,c.coord,n);t.font=this._baseBoldFont();for(var h=0,l=e;h<l.length;h++){var c;(c=l[h]).span>=i&&t.fillText(c.label,c.coord,n)}t.restore()}},t.prototype._drawBackLabels=function(t){t.save();var e=new Set,i=this._chart.model(),r=i.dataSources();e.add(i.crosshairSource());for(var n=this._getRendererOptions(),s=0,o=r;s<o.length;s++){var a=o[s];if(!e.has(a))for(var h=0,l=a.timeAxisViews();h<l.length;h++)l[h].renderer().draw(t,n)}t.restore()},t.prototype._drawCrosshairLabel=function(t){this._topCanvasContext.clearRect(-.5,-.5,this._size.w,this._size.h);var e=[],i=this._chart.model().crosshairSource().timeAxisViews();e.push(i);var r=this._getRendererOptions();e.forEach(function(e){e.forEach(function(e){t.save(),e.renderer().draw(t,r),t.restore()})})},t.prototype._backgroundColor=function(){return this._options.backgroundColor},t.prototype._lineColor=function(){return this._chart.options().timeScale.borderColor},t.prototype._textColor=function(){return this._options.textColor},t.prototype._fontSize=function(){return this._options.fontSize},t.prototype._baseFont=function(){return je(this._fontSize(),this._options.fontFamily)},t.prototype._baseBoldFont=function(){return je(this._fontSize(),this._options.fontFamily,"bold")},t.prototype._getRendererOptions=function(){null===this._rendererOptions&&(this._rendererOptions={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new ue});var t=this._rendererOptions,e=this._baseFont();if(t.font!==e){var i=this._fontSize();t.fontSize=i,t.font=e,t.paddingTop=Math.ceil(i/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(i/2),t.baselineOffset=Math.round(this._fontSize()/5),t.widthCache.reset()}return this._rendererOptions},t.prototype._setCursor=function(t){this._cell.style.cursor=1===t?"ew-resize":"default"},t.prototype._recreateStub=function(){var t=this._chart.model().mainPriceScale().options().position;if(t!==this._priceAxisPosition){if(null!==this._stub&&(this._stub.isLeft()?this._leftStubCell.removeChild(this._stub.getElement()):this._rightStubCell.removeChild(this._stub.getElement()),this._stub.destroy(),this._stub=null),"none"!==t){var e={rendererOptionsProvider:this._chart.model().rendererOptionsProvider()},i=this._chart.model();this._stub=new $i(t,this._chart.options(),e,function(){return i.mainPriceScale().options().borderVisible&&i.timeScale().options().borderVisible}),("left"===t?this._leftStubCell:this._rightStubCell).appendChild(this._stub.getElement())}this._priceAxisPosition=t}},t}(),er=function(){function t(t,e){var i=this;this._paneWidgets=[],this._paneSeparators=[],this._drawRafId=0,this._priceAxisWidthChanged=new Mt,this._height=0,this._width=0,this._priceAxisWidth=0,this._invalidateMask=null,this._drawPlanned=!1,this._clicked=new Mt,this._crosshairMoved=new Mt,this._options=e,this._element=document.createElement("div"),this._element.classList.add("tv-lightweight-charts"),this._element.style.overflow="hidden",this._element.style.width="100%",this._element.style.height="100%",this._tableElement=document.createElement("table"),this._tableElement.setAttribute("cellspacing","0"),this._element.appendChild(this._tableElement),this._onWheelBound=this._onMousewheel.bind(this),this._element.addEventListener("wheel",this._onWheelBound,{passive:!1}),this._model=new xi(this._invalidateHandler.bind(this),this._options),this.model().crosshairMoved().subscribe(this._onPaneWidgetCrosshairMoved.bind(this),this),this._timeAxisWidget=new tr(this),this._tableElement.appendChild(this._timeAxisWidget.getElement());var r=this._options.width,n=this._options.height;if(0===r&&0===n){var s=t.getBoundingClientRect();r=s.width,n=s.height}r=Math.max(70,r),n=Math.max(50,n),this.resize(n,r),this._syncGuiWithModel(),t.appendChild(this._element),this._updateTimeAxisVisibility(),this._model.timeScale().optionsApplied().subscribe(function(){i._updateTimeAxisVisibility(),i.adjustSize()},this)}return t.prototype.model=function(){return this._model},t.prototype.options=function(){return this._options},t.prototype.paneWidgets=function(){return this._paneWidgets},t.prototype.destroy=function(){this._element.removeEventListener("wheel",this._onWheelBound),0!==this._drawRafId&&window.cancelAnimationFrame(this._drawRafId),this._model.crosshairMoved().unsubscribeAll(this),this._model.timeScale().optionsApplied().unsubscribeAll(this),this._model.destroy();for(var t=0,e=this._paneWidgets;t<e.length;t++){var i=e[t];this._tableElement.removeChild(i.getElement()),i.clicked().unsubscribeAll(this),i.destroy()}this._paneWidgets=[];for(var r=0,n=this._paneSeparators;r<n.length;r++){var s=n[r];this._destroySeparator(s)}this._paneSeparators=[],z(this._timeAxisWidget).destroy(),null!==this._element.parentElement&&this._element.parentElement.removeChild(this._element),this._crosshairMoved.destroy(),this._clicked.destroy(),delete this._element},t.prototype.resize=function(t,e,i){if(void 0===i&&(i=!1),this._height!==t||this._width!==e){this._height=t,this._width=e;var r=t+"px",n=e+"px";z(this._element).style.height=r,z(this._element).style.width=n,this._tableElement.style.height=r,this._tableElement.style.width=n,i?this._drawImpl(new $e(3)):this._model.fullUpdate()}},t.prototype.paint=function(t){void 0===t&&(t=new $e(3));for(var e=0;e<this._paneWidgets.length;e++)this._paneWidgets[e].paint(t.invalidateForPane(e).level);this._timeAxisWidget.paint(t.fullInvalidation())},t.prototype.adjustSize=function(){this._adjustSizeImpl(),this._model.fullUpdate()},t.prototype.applyOptions=function(t){this._model.applyOptions(t),this._updateTimeAxisVisibility();var e=t.width||this._width,i=t.height||this._height;this.resize(i,e)},t.prototype.clicked=function(){return this._clicked},t.prototype.crosshairMoved=function(){return this._crosshairMoved},t.prototype.takeScreenshot=function(){var t=this;null!==this._invalidateMask&&(this._drawImpl(this._invalidateMask),this._invalidateMask=null);var e=this._paneWidgets[0],i=this._width,r=this._height,n=document.createElement("canvas");Ti(n,new Ci(i,r));var s=z(Ne(n));s.translate(-.5,-.5);var o=0,a=0,h=function(){for(var e=0;e<t._paneWidgets.length;e++){var i=t._paneWidgets[e],r=z(i.priceAxisWidget()).getImage();s.drawImage(r,o,a),a+=i.getSize().h,e<t._paneWidgets.length-1&&(a+=Hi)}};"left"===this._options.priceScale.position&&(h(),o=z(e.priceAxisWidget()).getWidth()),a=0;for(var l=0;l<this._paneWidgets.length;l++){var c=this._paneWidgets[l],u=c.getImage();if(s.drawImage(u,o,a),a+=c.getSize().h,l<this._paneWidgets.length-1){var p=this._paneSeparators[l].getImage();s.drawImage(p,o,a),a+=Hi}}o+=e.getSize().w,"right"===this._options.priceScale.position&&(a=0,h());var d=function(){var e=z(t._timeAxisWidget.stub()).getImage();s.drawImage(e,o,a)};return this._options.timeScale.visible&&(o=0,"left"===this._options.priceScale.position&&(d(),o=z(e.priceAxisWidget()).getWidth()),u=this._timeAxisWidget.getImage(),s.drawImage(u,o,a),"right"===this._options.priceScale.position&&(o=e.getSize().w,d(),s.restore())),n},t.prototype._adjustSizeImpl=function(){for(var t=0,e=0,i=0,r=this._paneWidgets;i<r.length;i++){var n=r[i];"none"!==this._options.priceScale.position&&(e=Math.max(e,z(n.priceAxisWidget()).optimalWidth())),t+=n.stretchFactor()}for(var s=this._width,o=this._height,a=Math.max(s-e,0),h=this._paneSeparators.length,l=Hi*h,c=this._options.timeScale.visible?this._timeAxisWidget.optimalHeight():0,u=l+c,p=o<u?0:o-u,d=p/t,_=0,f=0;f<this._paneWidgets.length;++f){(n=this._paneWidgets[f]).setState(this._model.panes()[f]);var m,v;v=f===this._paneWidgets.length-1?p-_:Math.round(n.stretchFactor()*d),_+=m=Math.max(v,2),n.setSize(new Ci(a,m)),"none"!==this._options.priceScale.position&&n.setPriceAxisSize(e),n.state()&&this._model.setPaneHeight(n.state(),m)}this._timeAxisWidget.setSizes(new Ci(a,c),e),this._model.setWidth(a),this._priceAxisWidth!==e&&(this._priceAxisWidth=e,this._priceAxisWidthChanged.fire(e))},t.prototype._onMousewheel=function(t){var e=t.deltaX/100,i=-t.deltaY/100;if(0!==e&&this._options.handleScroll.mouseWheel||0!==i&&this._options.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120,i*=120;break;case t.DOM_DELTA_LINE:e*=32,i*=32}if(0!==i&&this._options.handleScale.mouseWheel){var r=Math.sign(i)*Math.min(1,Math.abs(i)),n=t.clientX-this._element.getBoundingClientRect().left;this.model().zoomTime(n,r)}0!==e&&this._options.handleScroll.mouseWheel&&this.model().scrollChart(-80*e)}},t.prototype._drawImpl=function(t){var e=t.fullInvalidation();if(3===e&&this._updateGui(),3===e||2===e){for(var i=this._model.panes(),r=0;r<i.length;r++)t.invalidateForPane(r).autoScale&&i[r].momentaryAutoScale();t.getFitContent()&&this._model.timeScale().fitContent();var n=t.getTargetTimeRange();null!==n&&this._model.timeScale().setTimePointsRange(n),this._timeAxisWidget.update()}this.paint(t)},t.prototype._invalidateHandler=function(t){var e=this;null!==this._invalidateMask?this._invalidateMask.merge(t):this._invalidateMask=t,this._drawPlanned||(this._drawPlanned=!0,this._drawRafId=window.requestAnimationFrame(function(){e._drawPlanned=!1,e._drawRafId=0,null!==e._invalidateMask&&(e._drawImpl(e._invalidateMask),e._invalidateMask=null)}))},t.prototype._updateGui=function(){this._syncGuiWithModel()},t.prototype._destroySeparator=function(t){this._tableElement.removeChild(t.getElement()),t.destroy()},t.prototype._syncGuiWithModel=function(){for(var t=this._model.panes(),e=t.length,i=this._paneWidgets.length,r=e;r<i;r++){var n=L(this._paneWidgets.pop());this._tableElement.removeChild(n.getElement()),n.clicked().unsubscribeAll(this),n.destroy(),void 0!==(s=this._paneSeparators.pop())&&this._destroySeparator(s)}for(r=i;r<e;r++){if((n=new Ki(this,t[r])).clicked().subscribe(this._onPaneWidgetClicked.bind(this),this),this._paneWidgets.push(n),r>1){var s=new Ui(this,r-1,r,!0);this._paneSeparators.push(s),this._tableElement.insertBefore(s.getElement(),this._timeAxisWidget.getElement())}this._tableElement.insertBefore(n.getElement(),this._timeAxisWidget.getElement())}for(r=0;r<e;r++){var o=t[r];(n=this._paneWidgets[r]).state()!==o?n.setState(o):n.updatePriceAxisWidget()}this._updateTimeAxisVisibility(),this._adjustSizeImpl()},t.prototype._getMouseEventParamsImpl=function(t,e){var i,r=new Map;if(null!==t&&this._model.serieses().forEach(function(e){var i=e.dataAt(t);null!==i&&r.set(e,i)}),null!==t){var n=this._model.timeScale().indexToUserTime(t);null!==n&&(i=n)}return{time:i,point:e||void 0,seriesPrices:r}},t.prototype._onPaneWidgetClicked=function(t,e){var i=this;this._clicked.fire(function(){return i._getMouseEventParamsImpl(t,e)})},t.prototype._onPaneWidgetCrosshairMoved=function(t,e){var i=this;this._crosshairMoved.fire(function(){return i._getMouseEventParamsImpl(t,e)})},t.prototype._updateTimeAxisVisibility=function(){var t=this._options.timeScale.visible?"":"none";this._timeAxisWidget.getElement().style.display=t},t}();function ir(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}!function(t){t[t.LastPriceAndPercentageValue=0]="LastPriceAndPercentageValue",t[t.LastValueAccordingToScale=1]="LastValueAccordingToScale"}(Qi||(Qi={}));var rr=function(){function t(t,e){this._series=t,this._dataUpdatesConsumer=e}return t.prototype.destroy=function(){delete this._series,delete this._dataUpdatesConsumer},t.prototype.priceFormatter=function(){return this._series.formatter()},t.prototype.series=function(){return this._series},t.prototype.priceToCoordinate=function(t){var e=this._series.firstValue();return null===e?null:this._series.priceScale().priceToCoordinate(t,e)},t.prototype.setData=function(t){this._dataUpdatesConsumer.applyNewData(this._series,t)},t.prototype.update=function(t){this._dataUpdatesConsumer.updateData(this._series,t)},t.prototype.applyOptions=function(t){this._series.applyOptions(t)},t.prototype.options=function(){return Y(this._series.options())},t}(),nr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return A(e,t),e.prototype.applyOptions=function(e){ir(e),t.prototype.applyOptions.call(this,e)},e}(rr);function sr(t){if(!Oe(t))throw new Error("time must be of type BusinessDay");var e=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(e.getTime()/1e3),businessDay:t}}function or(t){if(!Le(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function ar(t){return 0===t.length?null:Oe(t[0].time)?sr:or}function hr(t){return Oe(t)?sr(t):or(t)}function lr(t,e){if("value"in t){var i=t.value,r=0;if("color"in t){var n=t;void 0!==n.color&&(r=L(e).addColor(n.color))}return[i,i,i,i,r]}var s=t;return[s.open,s.high,s.low,s.close,0]}function cr(t){return 60*t*60*1e3}function ur(t){return 60*t*1e3}var pr,dr=[{divisor:1,span:20},{divisor:(pr=1,1e3*pr),span:19},{divisor:ur(1),span:20},{divisor:ur(5),span:21},{divisor:ur(30),span:22},{divisor:cr(1),span:30},{divisor:cr(3),span:31},{divisor:cr(6),span:32},{divisor:cr(12),span:33}];function _r(t,e){if(null!==e){var i=new Date(1e3*e.timestamp),r=new Date(1e3*t.timestamp);if(r.getUTCFullYear()!==i.getUTCFullYear())return 70;if(r.getUTCMonth()!==i.getUTCMonth())return 60;if(r.getUTCDate()!==i.getUTCDate())return 50;for(var n=dr.length-1;n>=0;--n)if(Math.floor(i.getTime()/dr[n].divisor)!==Math.floor(r.getTime()/dr[n].divisor))return dr[n].span}return 20}function fr(t,e){return t.timestamp<e.timestamp}function mr(t){H(t.time)&&(t.time=function(t){var e=new Date(t);if(isNaN(e.getTime()))throw new Error("Invalid date string="+t+", expected format=yyyy-mm-dd");return{day:e.getUTCDate(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}}(t.time))}var vr,gr=function(){function t(){this._pointDataByTimePoint=new Map,this._timePointsByIndex=new Map,this._sortedTimePoints=[]}return t.prototype.destroy=function(){this._pointDataByTimePoint.clear(),this._timePointsByIndex.clear(),this._sortedTimePoints=[]},t.prototype.setSeriesData=function(t,e,i){var r=this;e.forEach(mr),this._pointDataByTimePoint.forEach(function(e){return e.mapping.delete(t)});var n=ar(e);null!==n&&e.forEach(function(e){var i=n(e.time),s=r._pointDataByTimePoint.get(i.timestamp)||{index:0,mapping:new Map,timePoint:i};s.mapping.set(t,e),r._pointDataByTimePoint.set(i.timestamp,s)});var s=new Map;return this._pointDataByTimePoint.forEach(function(t,e){t.mapping.size>0&&s.set(e,t)}),this._setNewPoints(s,i)},t.prototype.removeSeries=function(t){return this.setSeriesData(t,[])},t.prototype.updateSeriesData=function(t,e,i){mr(e);var r=t.data().bars();if(r.size()>0)if(void 0!==z(r.last()).time.businessDay){if(!Oe(e.time))throw new Error("time must be of type BusinessDay")}else if(!Le(e.time))throw new Error("time must be of type isUTCTimestamp");var n=z(ar([e]))(e.time),s=this._pointDataByTimePoint.get(n.timestamp)||{index:0,mapping:new Map,timePoint:n},o=0===s.mapping.size;s.mapping.set(t,e);var a=!1;if(o){var h=this._pointDataByTimePoint.size;this._sortedTimePoints.length>0&&this._sortedTimePoints[this._sortedTimePoints.length-1].timestamp>n.timestamp?(h=Xt(this._sortedTimePoints,n,fr),this._sortedTimePoints.splice(h,0,n),this._incrementIndicesFrom(h),a=!0):this._sortedTimePoints.push(n),s.index=h,this._timePointsByIndex.set(s.index,n)}this._pointDataByTimePoint.set(n.timestamp,s);var l=new Map,c=function(e){var r=L(u._timePointsByIndex.get(e));L(u._pointDataByTimePoint.get(r.timestamp)).mapping.forEach(function(n,s){if(a||s===t){var o=l.get(s)||{update:[]},h={index:e,time:r,value:lr(n,i)};o.update.push(h),l.set(s,o)}})},u=this;for(h=s.index;h<this._pointDataByTimePoint.size;++h)c(h);var p=o?this._generateMarksSinceIndex(s.index):[],d=o?this._sortedTimePoints.slice(s.index):[];return{timeScaleUpdate:{seriesUpdates:l,changes:d,index:s.index,marks:p}}},t.prototype._setNewPoints=function(t,e){var i=this;this._pointDataByTimePoint=t,this._sortedTimePoints=Array.from(this._pointDataByTimePoint.values()).map(function(t){return t.timePoint}),this._sortedTimePoints.sort(function(t,e){return t.timestamp-e.timestamp});var r=new Map;this._sortedTimePoints.forEach(function(t,n){var s=L(i._pointDataByTimePoint.get(t.timestamp));s.index=n,s.mapping.forEach(function(i,s){var o=r.get(s)||{update:[]},a={index:n,time:t,value:lr(i,e)};o.update.push(a),r.set(s,o)})});var n=null,s=this._sortedTimePoints.map(function(t,e){var i=_r(t,n);return n=t,{span:i,time:t,index:e}}),o={seriesUpdates:r,changes:this._sortedTimePoints.slice(),index:0,marks:s};return this._rebuildTimePointsByIndex(),{timeScaleUpdate:o}},t.prototype._incrementIndicesFrom=function(t){for(var e=this._timePointsByIndex.size-1;e>=t;--e){var i=L(this._timePointsByIndex.get(e)),r=e+1;L(this._pointDataByTimePoint.get(i.timestamp)).index=r,this._timePointsByIndex.delete(e),this._timePointsByIndex.set(r,i)}},t.prototype._rebuildTimePointsByIndex=function(){var t=this;this._timePointsByIndex.clear(),this._pointDataByTimePoint.forEach(function(e,i){t._timePointsByIndex.set(e.index,e.timePoint)})},t.prototype._generateMarksSinceIndex=function(t){for(var e=[],i=this._timePointsByIndex.get(t-1)||null,r=t;r<this._timePointsByIndex.size;++r){var n=L(this._timePointsByIndex.get(r)),s=_r(n,i);i=n,e.push({span:s,time:n,index:r})}return e},t}(),yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return A(e,t),e.prototype.setData=function(t){var e,i,r,n=(e=t,i=this._series.options().color,(r=new ye).addColor(i),e.forEach(function(t){void 0!==t.color&&r.addColor(t.color)}),r);this._dataUpdatesConsumer.applyNewData(this._series,t,n)},e}(rr),br={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Sr={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},wr={color:"#2196f3",lineStyle:0,lineWidth:3,crosshairMarkerVisible:!0,crosshairMarkerRadius:4},xr={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,crosshairMarkerVisible:!0,crosshairMarkerRadius:4},Cr={color:"#26a69a",base:0,lineWidth:2},Tr={title:"",lastValueVisible:!0,priceLineVisible:!0,priceLineWidth:1,priceLineColor:"",priceLineStyle:1,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},Mr=function(){function t(t){this._chartModel=t}return t.prototype.destroy=function(){delete this._chartModel},t.prototype.applyOptions=function(t){this._chartModel.applyOptions({priceScale:t})},t.prototype.options=function(){return this._priceScale().options()},t.prototype._priceScale=function(){return this._chartModel.mainPriceScale()},t}();!function(t){t[t.AnimationDurationMs=1e3]="AnimationDurationMs"}(vr||(vr={}));var Pr=function(){function t(t){this._model=t}return t.prototype.destroy=function(){delete this._model},t.prototype.scrollPosition=function(){return this._timeScale().rightOffset()},t.prototype.scrollToPosition=function(t,e){e?this._timeScale().scrollToOffsetAnimated(t,1e3):this._timeScale().setRightOffset(t)},t.prototype.scrollToRealTime=function(){this._timeScale().scrollToRealTime()},t.prototype.getVisibleRange=function(){var t=this._timeScale().visibleBars();if(null===t)return null;var e=this._model.timeScale().points(),i=z(e.firstIndex()),r=z(e.lastIndex());return{from:kr(z(e.valueAt(Math.max(i,t.firstBar())))),to:kr(z(e.valueAt(Math.min(r,t.lastBar()))))}},t.prototype.setVisibleRange=function(t){var e={from:hr(t.from),to:hr(t.to)};this._model.setTargetTimeRange(e)},t.prototype.resetTimeScale=function(){this._model.resetTimeScale()},t.prototype.fitContent=function(){this._model.fitContent()},t.prototype.applyOptions=function(t){this._timeScale().applyOptions(t)},t.prototype.options=function(){return Y(this._timeScale().options())},t.prototype._timeScale=function(){return this._model.timeScale()},t}();function kr(t){return t.businessDay||t.timestamp}function Er(t){void 0!==t&&void 0!==t.minMove&&void 0===t.precision&&(t.precision=function(t){if(t>=1)return 0;for(var e=0;e<8;e++){var i=Math.round(t);if(Math.abs(i-t)<1e-8)return e;t*=10}return e}(t.minMove))}var Dr=function(){function t(t,e){var i=this;this._dataLayer=new gr,this._timeRangeChanged=new Mt,this._seriesMap=new Map,this._seriesMapReversed=new Map,this._clickedDelegate=new Mt,this._crosshairMovedDelegate=new Mt,this._chartWidget=new er(t,e),this._chartWidget.model().timeScale().visibleBarsChanged().subscribe(this._onVisibleBarsChanged.bind(this)),this._chartWidget.clicked().subscribe(function(t){i._clickedDelegate.hasListeners()&&i._clickedDelegate.fire(i._convertMouseParams(t()))},this),this._chartWidget.crosshairMoved().subscribe(function(t){i._crosshairMovedDelegate.hasListeners()&&i._crosshairMovedDelegate.fire(i._convertMouseParams(t()))},this);var r=this._chartWidget.model();this._priceScaleApi=new Mr(r),this._timeScaleApi=new Pr(r)}return t.prototype.remove=function(){this._chartWidget.model().timeScale().visibleBarsChanged().unsubscribeAll(this),this._chartWidget.clicked().unsubscribeAll(this),this._chartWidget.crosshairMoved().unsubscribeAll(this),this._priceScaleApi.destroy(),this._timeScaleApi.destroy(),this._chartWidget.destroy(),delete this._chartWidget,this._seriesMap.forEach(function(t,e){e.destroy()}),this._seriesMap.clear(),this._seriesMapReversed.clear(),this._timeRangeChanged.destroy(),this._clickedDelegate.destroy(),this._crosshairMovedDelegate.destroy(),this._dataLayer.destroy(),delete this._dataLayer},t.prototype.resize=function(t,e,i){this._chartWidget.resize(t,e,i)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),Er(t.priceFormat);var e=W(Y(Tr),xr,t),i=this._chartWidget.model().createSeries("Area",e),r=new rr(i,this);return this._seriesMap.set(r,i),this._seriesMapReversed.set(i,r),r},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),Er(t.priceFormat);var e=W(Y(Tr),Sr,t),i=this._chartWidget.model().createSeries("Bar",e),r=new rr(i,this);return this._seriesMap.set(r,i),this._seriesMapReversed.set(i,r),r},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),ir(t),Er(t.priceFormat);var e=W(Y(Tr),br,t),i=this._chartWidget.model().createSeries("Candlestick",e),r=new nr(i,this);return this._seriesMap.set(r,i),this._seriesMapReversed.set(i,r),r},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),Er(t.priceFormat);var e=W(Y(Tr),Cr,t),i=this._chartWidget.model().createSeries("Histogram",e),r=new yr(i,this);return this._seriesMap.set(r,i),this._seriesMapReversed.set(i,r),r},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),Er(t.priceFormat);var e=W(Y(Tr),wr,t),i=this._chartWidget.model().createSeries("Line",e),r=new rr(i,this);return this._seriesMap.set(r,i),this._seriesMapReversed.set(i,r),r},t.prototype.removeSeries=function(t){var e=t,i=L(this._seriesMap.get(e)),r=this._dataLayer.removeSeries(i),n=this._chartWidget.model();n.removeSeries(i);var s=r.timeScaleUpdate;n.updateTimeScale(s.index,s.changes,s.marks,!0),s.seriesUpdates.forEach(function(t,e){e.setData(t.update,!1)}),n.updateTimeScaleBaseIndex(0),this._seriesMap.delete(e),this._seriesMapReversed.delete(i)},t.prototype.applyNewData=function(t,e,i){var r=this._dataLayer.setSeriesData(t,e,i),n=this._chartWidget.model(),s=r.timeScaleUpdate;n.updateTimeScale(s.index,s.changes,s.marks,!0),s.seriesUpdates.forEach(function(e,r){r.setData(e.update,t===r,i)}),n.updateTimeScaleBaseIndex(0)},t.prototype.updateData=function(t,e){var i=t.palette(),r=this._dataLayer.updateSeriesData(t,e,i),n=this._chartWidget.model(),s=r.timeScaleUpdate;n.updateTimeScale(s.index,s.changes,s.marks,!1),s.seriesUpdates.forEach(function(t,e){e.updateData(t.update)}),n.updateTimeScaleBaseIndex(0)},t.prototype.subscribeClick=function(t){this._clickedDelegate.subscribe(t)},t.prototype.unsubscribeClick=function(t){this._clickedDelegate.unsubscribe(t)},t.prototype.subscribeCrosshairMove=function(t){this._crosshairMovedDelegate.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this._crosshairMovedDelegate.unsubscribe(t)},t.prototype.subscribeVisibleTimeRangeChange=function(t){this._timeRangeChanged.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this._timeRangeChanged.unsubscribe(t)},t.prototype.priceScale=function(){return this._priceScaleApi},t.prototype.timeScale=function(){return this._timeScaleApi},t.prototype.applyOptions=function(t){this._chartWidget.applyOptions(t)},t.prototype.options=function(){return this._chartWidget.options()},t.prototype.takeScreenshot=function(){return this._chartWidget.takeScreenshot()},t.prototype._onVisibleBarsChanged=function(){this._timeRangeChanged.hasListeners()&&this._timeRangeChanged.fire(this.timeScale().getVisibleRange())},t.prototype._mapSeriesToApi=function(t){return L(this._seriesMapReversed.get(t))},t.prototype._convertMouseParams=function(t){var e=this,i=new Map;return t.seriesPrices.forEach(function(t,r){i.set(e._mapSeriesToApi(r),t)}),{time:t.time&&(t.time.businessDay||t.time.timestamp),point:t.point,seriesPrices:i}},t}(),Rr={width:0,height:0,layout:{backgroundColor:"#FFFFFF",textColor:"#191919",fontSize:11,fontFamily:Ye},crosshair:{vertLine:{color:"#758696",width:1,style:2,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:2,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},priceScale:{autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,position:"right",borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,scaleMargins:{bottom:.1,top:.2}},timeScale:{rightOffset:0,barSpacing:6,fixLeftEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0},watermark:{color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,text:"",horzAlign:"center",vertAlign:"center"},localization:{locale:navigator.language,dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}};function Ir(t,e){var i=z(H(t)?document.getElementById(t):t),r=void 0===e?Y(Rr):W(Y(Rr),e);return new Dr(i,r)}let Ar=f,Vr={};const Or=()=>{let t=Ar.memory.buffer;Vr.heapi32s&&0===!Vr.heapi32s.length||(Vr.heapi32s=new Int32Array(t),Vr.heapi32u=new Uint32Array(t),Vr.heapi16s=new Int16Array(t),Vr.heapi16u=new Uint16Array(t),Vr.heapi8s=new Int8Array(t),Vr.heapi8u=new Uint8Array(t),Vr.heapf32=new Float32Array(t),Vr.heapf64=new Float64Array(t))},Lr=t=>Vr.heapi32u[t/4],zr=t=>Vr.heapf32[t/4];class Br{constructor(t){this.ptr=t}get time(){return Lr(this.ptr)}get value(){return zr(this.ptr+4)}}let Wr={env:{createChart:(t,e)=>Ar.addObject(Ir(Ar.objects[t],{width:400,height:300})),Chart_addLineSeries:(t,e)=>Ar.addObject(Ar.objects[t].addLineSeries(e)),lineSeries_setData:(t,e,i)=>{Or();let r=[];for(var n=0;n<e;n++)r.push(new Br(i+8*n));Ar.objects[t].setData(r)}}};const Fr=[r,s,n];r.spasm.init(Fr)}]);</script></body>
</html>
